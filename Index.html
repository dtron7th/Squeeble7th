<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eden Economy</title>

    <link rel="stylesheet" href="CSS/UI.css">

</head>
<body>
    <style>
        body {
            background-color: rgb(0, 0, 0);
            width: 100dvw;
            height: 100dvh;
            
        }
    </style>
    <div class="Dot_Grid">
        <style aria-label="Dot_Grid_Style">
        /* 10px x 10px dot grid background */
        .Dot_Grid {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;

            --dot-color: var(--Dot_Grid);
            --dot-size: 1px;
            --grid-spacing: 20px;

            background-image: radial-gradient(circle, var(--dot-color) var(--dot-size), transparent calc(var(--dot-size) + 0.5px));
            background-size: var(--grid-spacing) var(--grid-spacing);
        }
        </style>
    </div>
    <div class="Start">
        <div class="Top_UI">
            <div class="Clock">
                <p class="Clock_HMSM">12:00:00 PM</p>
                <p class="Clock_DMY">DD/MM/YYYY</p>
            </div>
            <div class="Device_Location">
                <p class="Device_Location_Point">[Location]</p>
            </div>
        </div>
        <style>
            .Top_UI {
                position: absolute;
                top: 10px;
                right: 10px;
            }

            .Top_UI > .Clock > .Clock_HMSM {
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text_4);
            }

            .Top_UI > .Clock > .Clock_DMY {
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text_2);
            }

            .Top_UI > .Device_Location > .Device_Location_Point {
                position: absolute;
                top: 60px;
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text_2);
            }
        </style>

        <script aria-label="Top_UI_Script">

            /* ============================================================================ */
            /* SET CLOCK */
            /* ============================================================================ */
            (() => {
                const el = document.querySelector('.Clock_HMSM');
                if (!el) return;

                const pad = (n, d = 2) => String(n).padStart(d, '0');

                function update() {
                    const now = new Date();
                    let h = now.getHours();
                    const ampm = h >= 12 ? 'PM' : 'AM';
                    h = h % 12 || 12;
                    const m = pad(now.getMinutes());
                    const s = pad(now.getSeconds());
                    const ms = String(now.getMilliseconds()).padStart(3, '0');
                    el.textContent = `${pad(h)}:${m}:${s}.${ms} ${ampm}`;
                    requestAnimationFrame(update);
                }

                requestAnimationFrame(update);
            })();

            /* ============================================================================ */
            /* SET DATE */
            /* ============================================================================ */

            (() => {
                const el = document.querySelector('.Clock_DMY');
                if (!el) return;

                const pad = (n, d = 2) => String(n).padStart(d, '0');

                function update() {
                    const now = new Date();
                    const d = pad(now.getDate());
                    const m = pad(now.getMonth() + 1);
                    const y = now.getFullYear();
                    el.textContent = `${d}/${m}/${y}`;
                }

                update();
            })();

            /* ============================================================================ */
            /* GET DEVICE LOCATION */
            /* ============================================================================ */

            (() => {
                const el = document.querySelector('.Device_Location_Point');
                if (!el) return;

                if (!navigator.geolocation) {
                    el.textContent = '[Geolocation Not Supported]';
                    return;
                }

                let watchId = null;
                const showPosition = (pos) => {
                    const lat = pos.coords.latitude.toFixed(4);
                    const lon = pos.coords.longitude.toFixed(4);
                    const acc = pos.coords.accuracy ? `${Math.round(pos.coords.accuracy)}m` : 'n/a';
                    el.textContent = `[${lat}, ${lon}] (±${acc})`;
                };
                const showError = (err) => {
                    switch (err.code) {
                        case err.PERMISSION_DENIED: el.textContent = '[Permission denied]'; break;
                        case err.POSITION_UNAVAILABLE: el.textContent = '[Position unavailable]'; break;
                        case err.TIMEOUT: el.textContent = '[Timeout]'; break;
                        default: el.textContent = '[Location error]'; break;
                    }
                };

                const startWatch = () => {
                    if (watchId !== null) return;
                    watchId = navigator.geolocation.watchPosition(showPosition, showError, {
                        enableHighAccuracy: true,
                        maximumAge: 5000,
                        timeout: 10000
                    });
                };

                // Prefer Permissions API to react to permission changes
                if (navigator.permissions && navigator.permissions.query) {
                    navigator.permissions.query({ name: 'geolocation' }).then((status) => {
                        if (status.state === 'denied') {
                            el.textContent = '[Permission denied]';
                            return;
                        }
                        // request immediately and then watch for updates
                        navigator.geolocation.getCurrentPosition(showPosition, showError, { enableHighAccuracy: true, timeout: 10000 });
                        startWatch();
                        status.onchange = () => {
                            if (status.state === 'denied') {
                                if (watchId !== null) navigator.geolocation.clearWatch(watchId);
                                el.textContent = '[Permission denied]';
                            } else {
                                startWatch();
                            }
                        };
                    }).catch(() => {
                        // fallback if Permissions API unavailable/unexpected error
                        navigator.geolocation.getCurrentPosition(showPosition, showError, { enableHighAccuracy: true, timeout: 10000 });
                        startWatch();
                    });
                } else {
                    // no Permissions API — request once and start watching
                    navigator.geolocation.getCurrentPosition(showPosition, showError, { enableHighAccuracy: true, timeout: 10000 });
                    startWatch();
                }

                // cleanup when page is unloaded/hidden
                window.addEventListener('pagehide', () => {
                    if (watchId !== null) navigator.geolocation.clearWatch(watchId);
                });
            })();
        </script>

        <div class="Window Start_Window" style="width:280px; height:220px;">
            <div class="Window_Header">
                <p class="Title">Start</p>
                <button class="Close_Button"></button>
            </div>
            <div class="Content">
                <div class="Paragraph">
                    <p>Welcome to Eden Economy! Please select your platform to continue.</p>
                </div>
                <div class="Start_Navigator">
                    <button class="Start_Navigator_Button" id="Start_Using_IOS_System">[IOS Device]</button>
                    <button class="Start_Navigator_Button" id="Start_Using_APK_System">[APK Device]</button>
                </div>
            </div>
        </div>
        <style aria-label="Start_Window_Style">
            .Start {
                width: 100dvw;
                height: 100dvh;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .Start_Window {
                position: absolute;
                
            }

            .Start_Window > .Content > .Paragraph {
                position: absolute;
                top: 40px;
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text_2);
                text-align: center;
                width: 240px;
            }

            .Start_Window > .Content > .Start_Navigator {
                position: absolute;
                bottom: 20px;
                width: 100%;
                display: flex;
                flex-direction: row;
                gap: 20px;
                justify-content: center;
            }

            .Start_Window > .Content > .Start_Navigator > .Start_Navigator_Button {
                font-size: var(--Main_Text_2);
            }
        </style>

        <div class="Sub_Windows">
            <div class="Window Download_APK_Window" id="Download_APK_Window" style="width:180px; height:140px; display: none;">
                <div class="Window_Header">
                    <p class="Title">Download APK</p>
                    <button class="Close_Button">[Close]</button>
                </div>
                <div class="Content">
                    <div class="Title">
                        <p>Download the APK file.</p>
                    </div>
                    <div class="Download_Button">
                        <button class="Download_APK_Button">[Download]</button>
                    </div>
                </div>
            </div>
            
            <style>
                .Download_APK_Window > .Content {
                    width: 100%;
                    display: flex;
                    justify-content: center;
                }

                .Download_APK_Window > .Content > .Title {
                    width: 100%;
                    display: flex;
                    justify-content: center;
                }

                .Download_APK_Window > .Content > .Title > p {
                    position: absolute;
                    top: 20px;
                    color: var(--Main_Text_Color_1);
                    font-size: var(--Main_Text_1);
                    text-align: center;
                    width: 120px;
                }

                .Download_APK_Window > .Content > .Download_Button {
                    position: absolute;
                    bottom: 20px;
                    width: 100%;
                    display: flex;
                    justify-content: center;
                }

                .Download_APK_Window > .Content > .Download_Button > button {
                    font-size: var(--Main_Text_2);
                }
            </style>

            <script aria-label="Open_Close_Funtions">
                (() => {
                    const btn = document.getElementById('Start_Using_APK_System');
                    const win = document.getElementById('Download_APK_Window');
                    if (!btn || !win) return;

                    btn.addEventListener('click', () => {
                        win.style.display = 'flex';
                        const computed = getComputedStyle(win);
                        if (computed.position === 'static') win.style.position = 'absolute';

                        // Position the window at top:10px left:10px (account for page scroll)
                        requestAnimationFrame(() => {
                            win.style.left = (window.scrollX + 10) + 'px';
                            win.style.top = (window.scrollY + 10) + 'px';
                        });
                    });

                    const close = win.querySelector('.Close_Button');
                    if (close) close.addEventListener('click', () => {
                        win.style.display = 'none';
                    });
                })();
            </script>
        </div>
    </div>
    
    <script aria-label="Essentials_Script">

        /* ============================================================================ */
        /* DRAGGING ALL WINDOWS AND PANELS */
        /* ============================================================================ */

        // Enable dragging of any element with class "Window" by its child ".Window_Header"

        (() => {
            const headers = document.querySelectorAll('.Window_Header');
            headers.forEach(header => {
                // visual affordance
                header.style.cursor = 'grab';
                header.style.touchAction = 'none'; // allow pointer events without scrolling

                header.addEventListener('pointerdown', (ev) => {
                    const win = header.closest('.Window');
                    if (!win) return;

                    // ensure the window can be moved by absolute positioning
                    const rect = win.getBoundingClientRect();
                    const docLeft = rect.left + window.scrollX;
                    const docTop = rect.top + window.scrollY;
                    const computed = getComputedStyle(win);
                    if (computed.position === 'static') {
                        win.style.position = 'absolute';
                        win.style.left = `${docLeft}px`;
                        win.style.top = `${docTop}px`;
                    } else {
                        // make sure left/top are numbers we can use
                        if (!win.style.left) win.style.left = `${docLeft}px`;
                        if (!win.style.top) win.style.top = `${docTop}px`;
                    }

                    header.setPointerCapture(ev.pointerId);
                    header.style.cursor = 'grabbing';

                    const startX = ev.clientX;
                    const startY = ev.clientY;
                    const startLeft = parseFloat(win.style.left || docLeft);
                    const startTop = parseFloat(win.style.top || docTop);

                    function onPointerMove(e) {
                        const dx = e.clientX - startX;
                        const dy = e.clientY - startY;
                        win.style.left = `${Math.round(startLeft + dx)}px`;
                        win.style.top = `${Math.round(startTop + dy)}px`;
                    }

                    function onPointerUp(e) {
                        header.releasePointerCapture(e.pointerId);
                        header.style.cursor = 'grab';
                        document.removeEventListener('pointermove', onPointerMove);
                        document.removeEventListener('pointerup', onPointerUp);
                    }

                    document.addEventListener('pointermove', onPointerMove);
                    document.addEventListener('pointerup', onPointerUp);
                });
            });
        })();

        (() => {
            const GRID_X = 10;
            const GRID_Y = 10;

            function snapElementToGrid(el, gx = GRID_X, gy = GRID_Y) {
                if (!el) return;
                const rect = el.getBoundingClientRect();
                const docLeft = rect.left + window.scrollX;
                const docTop = rect.top + window.scrollY;

                let left = parseFloat(el.style.left);
                let top = parseFloat(el.style.top);
                if (!Number.isFinite(left)) left = docLeft;
                if (!Number.isFinite(top)) top = docTop;

                const snappedLeft = Math.round(left / gx) * gx;
                const snappedTop = Math.round(top / gy) * gy;

                el.style.left = snappedLeft + 'px';
                el.style.top = snappedTop + 'px';
            }

            // Track which window is being dragged
            let draggingWindow = null;
            document.querySelectorAll('.Window_Header').forEach(header => {
                header.addEventListener('pointerdown', () => {
                    draggingWindow = header.closest('.Window');
                });
            });

            // Snap when pointer is released — snap the dragged window and ensure all windows align
            document.addEventListener('pointerup', () => {
                if (draggingWindow) {
                    snapElementToGrid(draggingWindow);
                    draggingWindow = null;
                }
                document.querySelectorAll('.Window').forEach(w => snapElementToGrid(w));
            });

            // Optional: live snapping while dragging (throttled with requestAnimationFrame)
            let rafId = null;
            document.addEventListener('pointermove', () => {
                if (!draggingWindow) return;
                if (rafId) return;
                rafId = requestAnimationFrame(() => {
                    snapElementToGrid(draggingWindow);
                    rafId = null;
                });
            });
        })();

        (() => {
            // Clamp windows so they remain fully visible inside the viewport
            function clampWindowToViewport(win) {
                if (!win) return;
                const rect = win.getBoundingClientRect();
                const docLeft = rect.left + window.scrollX;
                const docTop = rect.top + window.scrollY;
                const width = rect.width;
                const height = rect.height;

                const vw = document.documentElement.clientWidth;
                const vh = document.documentElement.clientHeight;

                // document-scoped min/max (account for page scroll)
                const minLeft = window.scrollX;
                const minTop = window.scrollY;
                const maxLeft = Math.max(minLeft, window.scrollX + vw - width);
                const maxTop = Math.max(minTop, window.scrollY + vh - height);

                let left = parseFloat(win.style.left);
                let top = parseFloat(win.style.top);
                if (!Number.isFinite(left)) left = docLeft;
                if (!Number.isFinite(top)) top = docTop;

                const clampedLeft = Math.min(Math.max(left, minLeft), maxLeft);
                const clampedTop = Math.min(Math.max(top, minTop), maxTop);

                if (clampedLeft !== left) win.style.left = Math.round(clampedLeft) + 'px';
                if (clampedTop !== top) win.style.top = Math.round(clampedTop) + 'px';
            }

            // Throttle with rAF for smoothness
            let raf = null;
            function clampAllWindows() {
                if (raf) return;
                raf = requestAnimationFrame(() => {
                    document.querySelectorAll('.Window').forEach(clampWindowToViewport);
                    raf = null;
                });
            }

            // Keep windows inside viewport while dragging and when releasing/resizing/loading
            document.addEventListener('pointermove', clampAllWindows, { passive: true });
            document.addEventListener('pointerup', clampAllWindows);
            window.addEventListener('resize', clampAllWindows);
            window.addEventListener('load', clampAllWindows);
        })();

    </script>

</body>
</html>


