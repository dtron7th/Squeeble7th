<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eden Economy</title>

    <link rel="stylesheet" href="CSS/UI.css">

</head>
<body>
    <style>
        body {
            background-color: rgb(0, 0, 0);
            width: 100dvw;
            height: 100dvh;
            
        }
    </style>
    <div class="Dot_Grid">
        <style aria-label="Dot_Grid_Style">
        /* 10px x 10px dot grid background */
        .Dot_Grid {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 0;

            --dot-color: var(--Dot_Grid);
            --dot-size: 1px;
            --grid-spacing: 20px;

            background-image: radial-gradient(circle, var(--dot-color) var(--dot-size), transparent calc(var(--dot-size) + 0.5px));
            background-size: var(--grid-spacing) var(--grid-spacing);
        }
        </style>
    </div>
    <div class="Start">
        <div class="Window Start_Window" style="width:280px; height:220px;">
            <div class="Window_Header">
                <p class="Title">Start</p>
                <button class="Close_Button"></button>
            </div>
            <div class="Content">
                <div class="Paragraph">
                    <p>Welcome to Eden Economy! Please select your platform to continue.</p>
                </div>
                <div class="Start_Navigator">
                    <button class="Start_Navigator_Button" id="Start_Using_Desktop_System" style="width: 100%; height: 20px;">[Desktop]</button>
                    <button class="Start_Navigator_Button" id="Start_Using_Phone_System" style="width: 100%; height: 20px;">[Phone]</button>
                </div>
            </div>
        </div>
        <style aria-label="Start_Window_Style">
            .Start {
                width: 100dvw;
                height: 100dvh;
                display: flex;
                justify-content: center;
                align-items: center;
            }

            .Start_Window {
                position: absolute;
                
            }

            .Start_Window > .Content > .Paragraph {
                position: absolute;
                top: 40px;
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text_2);
                text-align: center;
                width: 240px;
            }

            .Start_Window > .Content > .Start_Navigator {
                position: absolute;
                bottom: 10px;
                width: 100%;
                display: flex;
                flex-direction: row;
                gap: 10px;
            }

            .Start_Window > .Content > .Start_Navigator > .Start_Navigator_Button {
                font-size: var(--Main_Text_1);
            }
        </style>
    </div>

    <div class="Get_Data">
        <style>
            .Get_Data {
                display: none;
                width: 100dvw;
                height: 100dvh;
            }
        </style>
        <div class="Using_Phone_System">
            <script aria-label="Phone_Start_Handler">
                (() => {
                    function clearStartAndDots() {
                        const start = document.querySelector('.Start');
                        const dots = document.querySelector('.Dot_Grid');
                        if (start) start.remove();
                        if (dots) dots.remove();
                    }

                    function init() {
                        const btn = document.getElementById('Start_Using_Phone_System');
                        if (!btn) return;
                        btn.addEventListener('click', clearStartAndDots, { once: true });
                    }

                    if (document.readyState === 'loading') {
                        document.addEventListener('DOMContentLoaded', init);
                    } else {
                        init();
                    }
                })();

                (function () {
                    function enterFullscreen() {
                        const docEl = document.documentElement;
                        const req = docEl.requestFullscreen || docEl.webkitRequestFullscreen || docEl.mozRequestFullScreen || docEl.msRequestFullscreen;
                        if (!req) return;
                        try {
                            const p = req.call(docEl);
                            if (p && typeof p.catch === 'function') p.catch(() => { /* ignore */ });
                        } catch (e) { /* ignore */ }
                    }

                    const phoneBtn = document.getElementById('Start_Using_Phone_System');
                    if (phoneBtn) phoneBtn.addEventListener('click', enterFullscreen, { once: true });
                })();

                (function () {
                    function openGetData() {
                        const gd = document.querySelector('.Get_Data');
                        if (!gd) return;
                        gd.style.display = 'block';
                        const focusable = gd.querySelector('input, button, [tabindex]:not([tabindex="-1"])');
                        if (focusable) focusable.focus();
                    }

                    const phoneBtn = document.getElementById('Start_Using_Phone_System');
                    if (phoneBtn) phoneBtn.addEventListener('click', openGetData, { once: true });
                })();
            </script>
            <script aria-label="Get_Phone_Data">

            (() => {
                const START_ID = 'Start_Using_Phone_SYSTEM';
                // Base boot text
                const bootBase = [
                    'IBM PC Compatible BIOS Version 1.0',
                    'Copyright (C) 1981-1990',
                    '',
                    'Initializing system hardware . . .',
                    'Detecting floppy disk drive A: 1.44MB',
                    'Detecting hard disk drive 0: 20.0GB',
                    'Loading device drivers . . .',
                    'Checking memory: 64K ok, 576K ok, 640K total',
                    'Detecting keyboard . . .',
                    'Initializing network interface . . .',
                    '',
                    'Bootloader: EdenOS v0.7',
                    'Loading kernel modules . . .',
                    'Starting services . . .'
                ];

                function createBootScreen() {
                    const container = document.createElement('div');
                    container.className = 'dos-boot-screen';
                    Object.assign(container.style, {
                        position: 'fixed',
                        inset: '0',
                        background: '#000',
                        color: '#33ff33',
                        fontFamily: 'monospace, monospace',
                        fontSize: '14px',
                        lineHeight: '1.3',
                        padding: '18px',
                        zIndex: '9999',
                        display: 'flex',
                        flexDirection: 'column',
                        justifyContent: 'flex-start',
                        alignItems: 'flex-start',
                        overflow: 'auto',
                        whiteSpace: 'pre-wrap'
                    });

                    const text = document.createElement('pre');
                    text.style.margin = '0';
                    text.setAttribute('aria-live', 'polite');

                    const progressWrap = document.createElement('div');
                    Object.assign(progressWrap.style, {
                        width: '80%',
                        maxWidth: '600px',
                        height: '18px',
                        border: '1px solid #33ff33',
                        marginTop: '18px',
                        background: 'rgba(51,255,51,0.03)'
                    });
                    const progressBar = document.createElement('div');
                    Object.assign(progressBar.style, {
                        height: '100%',
                        width: '0%',
                        background: 'linear-gradient(90deg, #33ff33, #aaffaa)'
                    });
                    progressWrap.appendChild(progressBar);

                    const hint = document.createElement('div');
                    hint.textContent = 'Press ESC to skip boot sequence';
                    Object.assign(hint.style, {
                        marginTop: '10px',
                        color: '#77ff77',
                        fontSize: '12px',
                        opacity: '0.9'
                    });

                    container.appendChild(text);
                    container.appendChild(progressWrap);
                    container.appendChild(hint);

                    document.body.appendChild(container);
                    return { container, text, progressBar };
                }

                function typeLine(elem, line, speed = 8) {
                    return new Promise((res) => {
                        let i = 0;
                        const t = () => {
                            if (i <= line.length) {
                                elem.textContent += line.slice(i, i + 1);
                                i++;
                                setTimeout(t, 1000 / (speed * (1 + Math.random())));
                            } else {
                                elem.textContent += '\n';
                                setTimeout(res, 120 + Math.random() * 200);
                            }
                        };
                        t();
                    });
                }

                // Helpers for simulated system info
                function fmtBytes(bytes) {
                    if (bytes >= 1e9) return (bytes / 1e9).toFixed(1) + ' GB';
                    if (bytes >= 1e6) return (bytes / 1e6).toFixed(1) + ' MB';
                    return bytes + ' B';
                }
                function rnd(min, max) { return Math.floor(min + Math.random() * (max - min + 1)); }
                function randomMac() {
                    const hex = '0123456789ABCDEF';
                    let m = [];
                    for (let i = 0; i < 6; i++) {
                        m.push(hex[Math.floor(Math.random() * 16)] + hex[Math.floor(Math.random() * 16)]);
                    }
                    return m.join(':');
                }

                async function getPublicIP(timeoutMs = 1200) {
                    if (!('fetch' in window)) return 'Unknown';
                    try {
                        const p = fetch('https://api.ipify.org?format=json', { cache: 'no-store' });
                        const res = await Promise.race([
                            p,
                            new Promise((_, rej) => setTimeout(() => rej(new Error('timeout')), timeoutMs))
                        ]);
                        const j = await res.json();
                        return j.ip || 'Unknown';
                    } catch (e) {
                        return 'Unknown';
                    }
                }

                function memoryLines() {
                    // Prefer navigator.deviceMemory if available (GB)
                    const devMemGB = navigator.deviceMemory || null;
                    const totalMB = devMemGB ? Math.round(devMemGB * 1024) : 2048 + rnd(0, 2048);
                    const usedMB = Math.round(totalMB * (0.18 + Math.random() * 0.46));
                    const freeMB = totalMB - usedMB;
                    return [
                        '',
                        '--- Memory Info ---',
                        `Total Physical Memory: ${totalMB} MB`,
                        `Memory In Use: ${usedMB} MB (${Math.round((usedMB / totalMB) * 100)}%)`,
                        `Available Memory: ${freeMB} MB`,
                        `CPU Cores (logical): ${navigator.hardwareConcurrency || 'Unknown'}`
                    ];
                }

                function driveLines() {
                    // Simulate a couple of drives
                    const drives = [
                        { id: '0', type: 'NVMe SSD', sizeGB: 128, usedPct: rnd(6, 70) },
                        { id: '1', type: 'HDD', sizeGB: 1024, usedPct: rnd(12, 90) }
                    ];
                    const lines = ['','--- Storage Devices ---'];
                    drives.forEach(d => {
                        const usedGB = (d.sizeGB * d.usedPct / 100).toFixed(1);
                        lines.push(`Drive ${d.id}: ${d.type} ${d.sizeGB} GB — Used ${usedGB} GB (${d.usedPct}%) — Health: ${d.usedPct > 92 ? 'Degraded' : 'Good'}`);
                        lines.push(`  Partition 1: ${Math.round(d.sizeGB * 0.6)} GB (${Math.round(d.usedPct * 0.6)}% used)`);
                    });
                    return lines;
                }

                async function networkLines() {
                    const lines = ['','--- Network ---'];
                    const conn = navigator.connection || navigator.mozConnection || navigator.webkitConnection || null;
                    if (conn) {
                        lines.push(`Connection type: ${conn.type || 'unknown'} (${conn.effectiveType || 'unknown'})`);
                        if ('downlink' in conn) lines.push(`Link speed (approx): ${conn.downlink} Mbps`);
                        if ('rtt' in conn) lines.push(`RTT (approx): ${conn.rtt} ms`);
                    } else {
                        lines.push('Connection type: Unknown');
                    }

                    // Try to get public IP (best-effort)
                    const ip = await getPublicIP();
                    lines.push(`Public IP: ${ip}`);
                    // Local details (simulated)
                    lines.push(`Local IP: 192.168.${rnd(0, 255)}.${rnd(2, 254)}`);
                    lines.push(`MAC Address: ${randomMac()}`);
                    lines.push(`Gateway: 192.168.${rnd(0, 255)}.1`);
                    lines.push(`DNS: 1.1.1.1, 8.8.8.8`);
                    return lines;
                }

                async function runBootSequence(onComplete) {
                    const { container, text, progressBar } = createBootScreen();

                    let aborted = false;
                    function abort() { aborted = true; }
                    const escHandler = (e) => { if (e.key === 'Escape') abort(); };
                    document.addEventListener('keydown', escHandler);

                    // Build lines dynamically (memory, drives, network may be async)
                    const lines = [].concat(bootBase, memoryLines(), driveLines());
                    const net = await networkLines();
                    lines.push(...net);

                    // Type lines
                    for (let i = 0; i < lines.length; i++) {
                        if (aborted) break;
                        const speed = 12 - Math.min(8, Math.floor(i / 6));
                        await typeLine(text, lines[i], speed);
                        const pct = Math.round(((i + 1) / (lines.length + 3)) * 100);
                        progressBar.style.width = pct + '%';
                    }

                    // Simulate loading final steps with progress to 100%
                    let pct = parseInt(progressBar.style.width) || 0;
                    while (pct < 100 && !aborted) {
                        pct = Math.min(100, pct + Math.ceil(Math.random() * 6));
                        progressBar.style.width = pct + '%';
                        text.textContent += (pct % 10 === 0) ? '.' : '';
                        await new Promise(r => setTimeout(r, 120 + Math.random() * 200));
                    }

                    // Final messages
                    if (!aborted) {
                        text.textContent += '\nSystem initialized successfully.\n';
                        text.textContent += 'Welcome to Eden Economy.\n';
                    } else {
                        text.textContent += '\nBoot sequence aborted by user.\n';
                    }

                    // Small pause then fade out
                    await new Promise(r => setTimeout(r, 700));
                    container.style.transition = 'opacity 450ms ease';
                    container.style.opacity = '0';
                    setTimeout(() => {
                        document.removeEventListener('keydown', escHandler);
                        container.remove();
                        if (typeof onComplete === 'function') onComplete(!aborted);
                    }, 500);
                }

                function attachToStartButton() {
                    const btn = document.getElementById(START_ID);
                    if (!btn) {
                        // Try common ID case used in document
                        const alt = document.getElementById('Start_Using_Phone_System');
                        if (alt) alt.addEventListener('click', () => runBootSequence(), { once: true });
                        return;
                    }
                    btn.addEventListener('click', () => {
                        runBootSequence();
                    }, { once: true });
                }

                if (document.readyState === 'loading') {
                    document.addEventListener('DOMContentLoaded', attachToStartButton);
                } else {
                    attachToStartButton();
                }
            })();

            </script>
        </div>
    </div>

    <div class="Login" style="display: none;">
        <div class="Window Menu_Window" style="width:160px; height:140px;">
            <div class="Window_Header">
                <p class="Title">Menu </p>
            </div>
            <div class="Content">
                <div class="Menu_List">
                    <button class="Menu_Item">[Login]</button>
                    <button class="Menu_Item">[Sign Up]</button>
                    <button class="Menu_Item">[Character Sheet]</button>
                    <button class="Menu_Item">[Theme]</button>
                </div>
                <style aria-label="Menu_List_Style">
                    .Menu_List {
                        position: absolute;
                        top: 10px;
                        left: 0px;
                        display: flex;
                        flex-direction: column;
                        gap: 10px;
                    }

                    .Menu_List > .Menu_Item {
                        text-align: left;
                    }

                    .Menu_List > .Menu_Item > .Menu_Item:hover {
                        background-color: var(--UI-Buttons-Fields-Color-2);
                    }
                </Style>
            </div>
            
            <Script aria-label="Menu_Window_Script">
                (() => {
                    const win = document.querySelector('.Menu_Window');
                    if (!win) return;
                    const computed = getComputedStyle(win);
                    if (computed.position === 'static') win.style.position = 'absolute';
                    // Only set defaults if not already positioned
                    if (!win.style.left) win.style.left = '10px';
                    if (!win.style.top) win.style.top = '10px';
                })();
            </Script>
        </div>
    </div>
        </div>
    </div>
    <div class="Home_Main_1">

    </div>
    <div class="Home_Main_2">

    </div>
    <div class="Home_Main_3">

    </div>
    
    <script aria-label="Essentials_Script">

        /* ============================================================================ */
        /* DRAGGING ALL WINDOWS AND PANELS */
        /* ============================================================================ */

        // Enable dragging of any element with class "Window" by its child ".Window_Header"

        (() => {
            const headers = document.querySelectorAll('.Window_Header');
            headers.forEach(header => {
                // visual affordance
                header.style.cursor = 'grab';
                header.style.touchAction = 'none'; // allow pointer events without scrolling

                header.addEventListener('pointerdown', (ev) => {
                    const win = header.closest('.Window');
                    if (!win) return;

                    // ensure the window can be moved by absolute positioning
                    const rect = win.getBoundingClientRect();
                    const docLeft = rect.left + window.scrollX;
                    const docTop = rect.top + window.scrollY;
                    const computed = getComputedStyle(win);
                    if (computed.position === 'static') {
                        win.style.position = 'absolute';
                        win.style.left = `${docLeft}px`;
                        win.style.top = `${docTop}px`;
                    } else {
                        // make sure left/top are numbers we can use
                        if (!win.style.left) win.style.left = `${docLeft}px`;
                        if (!win.style.top) win.style.top = `${docTop}px`;
                    }

                    header.setPointerCapture(ev.pointerId);
                    header.style.cursor = 'grabbing';

                    const startX = ev.clientX;
                    const startY = ev.clientY;
                    const startLeft = parseFloat(win.style.left || docLeft);
                    const startTop = parseFloat(win.style.top || docTop);

                    function onPointerMove(e) {
                        const dx = e.clientX - startX;
                        const dy = e.clientY - startY;
                        win.style.left = `${Math.round(startLeft + dx)}px`;
                        win.style.top = `${Math.round(startTop + dy)}px`;
                    }

                    function onPointerUp(e) {
                        header.releasePointerCapture(e.pointerId);
                        header.style.cursor = 'grab';
                        document.removeEventListener('pointermove', onPointerMove);
                        document.removeEventListener('pointerup', onPointerUp);
                    }

                    document.addEventListener('pointermove', onPointerMove);
                    document.addEventListener('pointerup', onPointerUp);
                });
            });
        })();

        (() => {
            const GRID_X = 10;
            const GRID_Y = 10;

            function snapElementToGrid(el, gx = GRID_X, gy = GRID_Y) {
                if (!el) return;
                const rect = el.getBoundingClientRect();
                const docLeft = rect.left + window.scrollX;
                const docTop = rect.top + window.scrollY;

                let left = parseFloat(el.style.left);
                let top = parseFloat(el.style.top);
                if (!Number.isFinite(left)) left = docLeft;
                if (!Number.isFinite(top)) top = docTop;

                const snappedLeft = Math.round(left / gx) * gx;
                const snappedTop = Math.round(top / gy) * gy;

                el.style.left = snappedLeft + 'px';
                el.style.top = snappedTop + 'px';
            }

            // Track which window is being dragged
            let draggingWindow = null;
            document.querySelectorAll('.Window_Header').forEach(header => {
                header.addEventListener('pointerdown', () => {
                    draggingWindow = header.closest('.Window');
                });
            });

            // Snap when pointer is released — snap the dragged window and ensure all windows align
            document.addEventListener('pointerup', () => {
                if (draggingWindow) {
                    snapElementToGrid(draggingWindow);
                    draggingWindow = null;
                }
                document.querySelectorAll('.Window').forEach(w => snapElementToGrid(w));
            });

            // Optional: live snapping while dragging (throttled with requestAnimationFrame)
            let rafId = null;
            document.addEventListener('pointermove', () => {
                if (!draggingWindow) return;
                if (rafId) return;
                rafId = requestAnimationFrame(() => {
                    snapElementToGrid(draggingWindow);
                    rafId = null;
                });
            });
        })();

        (() => {
            // Clamp windows so they remain fully visible inside the viewport
            function clampWindowToViewport(win) {
                if (!win) return;
                const rect = win.getBoundingClientRect();
                const docLeft = rect.left + window.scrollX;
                const docTop = rect.top + window.scrollY;
                const width = rect.width;
                const height = rect.height;

                const vw = document.documentElement.clientWidth;
                const vh = document.documentElement.clientHeight;

                // document-scoped min/max (account for page scroll)
                const minLeft = window.scrollX;
                const minTop = window.scrollY;
                const maxLeft = Math.max(minLeft, window.scrollX + vw - width);
                const maxTop = Math.max(minTop, window.scrollY + vh - height);

                let left = parseFloat(win.style.left);
                let top = parseFloat(win.style.top);
                if (!Number.isFinite(left)) left = docLeft;
                if (!Number.isFinite(top)) top = docTop;

                const clampedLeft = Math.min(Math.max(left, minLeft), maxLeft);
                const clampedTop = Math.min(Math.max(top, minTop), maxTop);

                if (clampedLeft !== left) win.style.left = Math.round(clampedLeft) + 'px';
                if (clampedTop !== top) win.style.top = Math.round(clampedTop) + 'px';
            }

            // Throttle with rAF for smoothness
            let raf = null;
            function clampAllWindows() {
                if (raf) return;
                raf = requestAnimationFrame(() => {
                    document.querySelectorAll('.Window').forEach(clampWindowToViewport);
                    raf = null;
                });
            }

            // Keep windows inside viewport while dragging and when releasing/resizing/loading
            document.addEventListener('pointermove', clampAllWindows, { passive: true });
            document.addEventListener('pointerup', clampAllWindows);
            window.addEventListener('resize', clampAllWindows);
            window.addEventListener('load', clampAllWindows);
        })();

    </script>

</body>
</html>


