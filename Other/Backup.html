<style>
        /* ============================================================================ */
        /* BODY & WALLPAPER */
        /* ============================================================================ */
        body {
            background-color: rgb(255, 255, 255);
            overflow: hidden;
            width: 100dvw;
            height: 100dvh;
            display: flex;
            justify-content: center;
        }

        .Wallpaper {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: -1;
            background-size: contain;
        }

        .Wallpaper > .Img_List {
            display: flex;
        }

        .Wallpaper > .Img_List > img {
            width: 100dvw;
            height: 100dvh;
            background-size: cover;
        }

        /* ============================================================================ */
        /* DISCLAIMER */
        /* ============================================================================ */
        .Disclaimer {
            position: absolute;
            width: 100%;
            height: 100%;
            backdrop-filter: var(--Back_drop);
            background-color: var(--Main_Window_Color-2);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
        }

        .Disclaimer > .Disclaimer_Window {
            position: absolute;
            width: 300px;
            height: 200px;
            background-color: var(--Main_Window_Color-1);
            border-radius: var(--Border-Radius);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ============================================================================ */
        /* POWER BUTTON */
        /* ============================================================================ */
        .On_Button {
            position: absolute;
            width: auto;
            height: auto;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .On_Button > button {
            position: absolute;
            width: auto;
            height: auto;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            z-index: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: var(--Back_drop);
        }

        .On_Button > button > img {
            height: 20px;
        }

        /* ============================================================================ */
        /* PROGRESS BAR */
        /* ============================================================================ */
        .Progress_Bar {
            position: absolute;
            bottom: 10px;
            width: calc(100% - 20px);
            height: 30px;
            background-color: var(--Text_Input_Field);
            backdrop-filter: blur(20px);
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .Progress_Fill {
            position: absolute;
            left: 0px;
            height: 30px;
            width: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: width 0.3s ease-in-out;
        }

        .Progress_Label {
            position: absolute;
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
        }

        /* ============================================================================ */
        /* LOGIN CONTAINER */
        /* ============================================================================ */
        .Login {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
        }

        .Login > .Login_Window > .Content > .Main {
            position: absolute;
            top: 100px;
            width: calc(100% - 40px);
            display: flex;
            justify-content: center;
            flex-direction: column;
        }

        .Login > .Login_Window > .Content > .Main > .Inputs {
            display: flex;
            justify-content: center;
            flex-direction: column;
            gap: 10px;
        }

        .Login > .Login_Window > .Content > .Main > .Inputs > .Field {
            width: 100%;
            height: 30px;
            background-color: var(--UI-Buttons-Fields-Color-1);
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
            gap: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-indent: 10px;
            overflow: hidden;
        }

        .Login > .Login_Window > .Content > .Main > .Inputs > .Login_SHA-256_Output {
            width: 100%;
            height: 30px;
            gap: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-indent: 10px;
            overflow: hidden;
        }

        .Login > .Login_Window > .Content > .Main > .Buttons {
            position: absolute;
            top: 90px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Login > .Login_Window > .Content > .Manual {
            position: absolute;
            bottom: 20px;
            width: calc(100% - 40px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .Login > .Login_Window > .Content > .Manual > .Hash_Name {
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Login > .Login_Window > .Content > p {
            width: calc(100% - 40px);
        }

        /* ============================================================================ */
        /* CLOSE LOGIN MENU */
        /* ============================================================================ */
        .Login > .Close_Login_Menu {
            position: absolute;
            width: 100%;
            height: 100%;
            background-color: var(--Menu_Background);
            backdrop-filter: var(--Back_drop);
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
        }

        .Login > .Close_Login_Menu > .Menu_Container {
            position: absolute;
            width: 200px;
            height: auto;
            background-color: var(--Main_Window_Color-2);
        }

        /* ============================================================================ */
        /* VERIFICATION WINDOW */
        /* ============================================================================ */
        .Login > .Verification_Window {
            display: none;
        }

        .Login > .Verification_Window > .Content {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .Login > .Verification_Window > .Content > .Verification_Window_Profile {
            position: absolute;
            top: 30px;
            width: 70px;
            height: 70px;
            overflow: hidden;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .Login > .Verification_Window > .Content > .Verification_Window_Profile > img {
            width: 100%;
            background-size: contain;
        }

        .Login > .Verification_Window > .Content > .Data {
            position: absolute;
            bottom: 80px;
            width: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .Login > .Verification_Window > .Content > .Data > span {
            width: 150px;
            text-align: center;
            font-size: var(--Main_Text_1);
            color: var(--Main_Text_Color);
        }

        .Login > .Verification_Window > .Content > .Buttons {
            width: 100%;
            position: absolute;
            bottom: 20px;
            display: flex;
            justify-content: center;
        }

        /* ============================================================================ */
        /* SIGNUP WINDOW */
        /* ============================================================================ */
        .Signup_Window {
            position: relative;
            display: none;
            overflow: hidden;
            overflow-y: scroll;
        }

        .Signup_Window > .Window_Header {
            position: sticky;
            z-index: 1;
        }

        .Signup_Window > .Content {
            position: relative;
            display: flex;
            justify-content: center;
            align-self: center;
        }

        .Signup_Window > .Content > .Main_Title {
            position: absolute;
            top: 20px;
            left: 20px;
        }

        .Signup_Window > .Content > .Main_Title > p {
            font-size: 16px;
            color: var(--Main_Text_Color);
        }

        /* Profile Section */
        .Signup_Window > .Content > .Signup_Profile {
            position: absolute;
            top: 20px;
            right: 20px;
            width: calc(100% - 120px);
        }

        .Signup_Window > .Content > .Signup_Profile > .Signup_Profile_Bubble {
            position: absolute;
            right: 0px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
        }

        .Signup_Window > .Content > .Signup_Profile > .Signup_Profile_Bubble > img {
            width: 70px;
            height: 70px;
            background-color: var(--Profile_Pic_Background);
        }

        .Signup_Window > .Content > .Signup_Profile > .Signup_Profile_Name {
            position: absolute;
            top: 0px;
            right: 80px;
            width: 50%;
            font-size: 16px;
            color: var(--Main_Text_Color);
            text-align: right;
        }

        .Signup_Window > .Content > .Signup_Profile > .Signup_Profile_Name > p {
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
        }

        /* Wallpaper Section */
        .Signup_Window > .Content > .Signup_Wallpaper {
            position: absolute;
            top: 110px;
            width: calc(100% - 40px);
            height: 130px;
        }

        .Signup_Window > .Content > .Signup_Wallpaper > .Signup_Wallpaper_Container {
            width: 100%;
            height: 100%;
            border-radius: var(--Border-Radius_Button);
            overflow: hidden;
        }

        .Signup_Window > .Content > .Signup_Wallpaper > .Signup_Wallpaper_Container > img {
            width: 100%;
            background-size: contain;
        }

        .Signup_Window > .Content > .Signup_Wallpaper > .Get_Signup_Wallpaper {
            margin-top: 10px;
        }

        /* Input Fields */
        .Signup_Window > .Content > .Inputs {
            width: calc(100% - 40px);
            overflow-y: scroll;
        }

        .Signup_Window > .Content > .Inputs > .First_Basic_Inputs {
            position: absolute;
            top: 310px;
            width: calc(100% - 40px);
        }

        .Signup_Window > .Content > .Inputs > .First_Basic_Inputs > .Hash_Output {
            position: absolute;
            top: 50px;
            width: 100%;
        }

        .Signup_Window > .Content > .Inputs > .First_Basic_Inputs > .Hash_Output > .Signup_SHA-256_Output {
            width: 100%;
            height: 30px;
            gap: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-indent: 10px;
            overflow: hidden;
        }

        .Signup_Window > .Content > .Inputs > .First_Basic_Inputs > .Name {
            position: absolute;
            top: 100px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Signup_Window > .Content > .Inputs > .First_Basic_Inputs > .Signup_Password {
            position: absolute;
            top: 140px;
            width: 100%;
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs {
            position: absolute;
            top: 510px;
            width: calc(100% - 40px);
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs > .Hash_Output {
            position: absolute;
            top: 50px;
            width: 100%;
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs > .Hash_Output > .Signup_SHA-256_Output {
            width: 100%;
            height: 30px;
            background-color: var(--Text_Input_Field);
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
            gap: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-indent: 10px;
            overflow: hidden;
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs > .Name {
            position: absolute;
            top: 100px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs > .Information_1 {
            position: absolute;
            top: 140px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Signup_Window > .Content > .Inputs > .Second_Basic_Inputs > .Information_2 {
            position: absolute;
            top: 180px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
            padding-bottom: 20px;
        }

        /* Fake Account Overlay */
        .Fake_Account {
            position: absolute;
            top: 30px;
            left: 0px;
            width: 100%;
            height: calc(100% - 30px);
            background-color: rgba(66, 66, 66, 0.7);
            backdrop-filter: blur(20px);
            z-index: 1;
        }

        .Fake_Account .Content {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .Fake_Account .Content > .User_Information {
            width: 200px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }

        .Fake_Account .Content > .User_Information > p {
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_1);
        }

        .Fake_Account .Content > .User_Information > .Information {
            margin-top: 30px;
        }

        /* ============================================================================ */
        /* PROFILE DROPDOWN */
        /* ============================================================================ */
        .Signup_Profile_Options_Dropdown {
            width: 150px;
            height: auto;
        }

        /* ============================================================================ */
        /* UPLOAD PROFILE DIALOG */
        /* ============================================================================ */
        .Signup_Upload_Profile_Dialog {
            display: none;
        }

        .Signup_Upload_Profile_Dialog > .Content {
            display: flex;
            justify-content: center;
        }

        .Signup_Upload_Profile_Dialog > .Content > .Signup_Upload_Profile_Dialog_Profile_Pic {
            position: absolute;
            top: 20px;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            overflow: hidden;
        }

        .Signup_Upload_Profile_Dialog > .Content > .Signup_Upload_Profile_Dialog_Profile_Pic > img {
            width: 70px;
            height: 70px;
            background-color: var(--Profile_Pic_Background);
        }

        .Signup_Upload_Profile_Dialog > .Content > .Buttons {
            position: absolute;
            bottom: 10px;
            width: calc(100% - 20px);
            display: flex;
            gap: 10px;
        }

        /* ============================================================================ */
        /* FORGOT PASSWORD DIALOG */
        /* ============================================================================ */
        .Forgot_Password_Dialog {
            display: none;
        }

        .Forgot_Password_Dialog > .Content > .Description {
            position: absolute;
            top: 30px;
            width: calc(100% - 40px);
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Output_Hash {
            position: absolute;
            top: 80px;
            width: calc(100% - 40px);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Output_Hash > .Forgotpassword_SHA-256_Output {
            width: 100%;
            height: 30px;
            background-color: var(--Text_Input_Field);
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
            gap: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-indent: 10px;
            overflow: hidden;
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Inputs {
            position: absolute;
            top: 180px;
            width: calc(100% - 40px);
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Inputs > .Name {
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Inputs > .Information_1 {
            margin-top: 10px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        .Forgot_Password_Dialog > .Content > .Forgotpassword_Inputs > .Information_2 {
            margin-top: 10px;
            width: 100%;
            display: flex;
            flex-direction: row;
            gap: 10px;
        }

        /* ============================================================================ */
        /* FORGOT PASSWORD SHOW PASSWORD DIALOG */
        /* ============================================================================ */
        .Forgot_Password_Show_Password_Dialog {
            display: flex;
            justify-content: center;
            align-items: center;
            display: none;
        }

        .Forgot_Password_Show_Password_Dialog > .Fields {
            position: absolute;
            top: 400px;
            display: flex;
            justify-content: center;
            text-align: center;
            flex-direction: column;
            gap: 20px;
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color);
        }

        .Forgot_Password_Show_Password_Dialog > .Fields > .Recovered_Password {
            font-size: 14px;
        }

        .Forgot_Password_Show_Password_Dialog > .Close_Button {
            position: absolute;
            top: 480px;
        }
    </style>
</head>

<body id="Main_Body">
    <!-- ============================================================================ -->
    <!-- WALLPAPER BACKGROUND -->
    <!-- ============================================================================ -->
    <div class="Wallpaper">
        <div class="Img_List">
            <img src="/Images/Background Img/Login_wallpaper-1.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-2.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-3.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-4.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-5.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-6.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-7.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-8.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-9.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-10.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-11.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-12.jpg" alt="">
            <img src="/Images/Background Img/Login_wallpaper-13.jpg" alt="">
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- DISCLAIMER MODAL -->
    <!-- ============================================================================ -->
    <div class="Disclaimer" id="Disclaimer">
        <div class="Disclaimer_Window">
            <p style="position: absolute; top: 40px; width: 250px; color: var(--Main_Text_Color); font-size: 12px; text-align: center;">
                This web app is meant for phones and some tablets, but mostly phones. The UI nor the website wouldn't work on desktops and laptops
            </p>
            <button id="Close_Disclaimer" style="position: absolute; bottom: 20px; width: 150px; height: 30px; font-size: var(--Main_Text); border-radius: var(--Border-Radius_Button);">
                Accept
            </button>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- PROGRESS BAR -->
    <!-- ============================================================================ -->
    <div class="Progress_Bar" id="Progress_Bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
        <div id="Progress_Fill" class="Progress_Fill"></div>
        <span id="Progress_Label" class="Progress_Label">0%</span>
    </div>

    <!-- ============================================================================ -->
    <!-- LOGIN CONTAINER -->
    <!-- ============================================================================ -->
    <div class="Login" id="Login">
        <!-- Login Window -->
        <div class="Window Login_Window" style="width: 300px; height: 460px;">
            <div class="Window_Header">
                <p class="Title">Log in</p>
                <button class="Close_Button" id="Close_Login_Button"></button>
            </div>
            <div class="Content">
                <p style="color: var(--Main_Text_Color); position: absolute; top: 40px; left: 20px; font-size: var(--Main_Text);">
                    This uses the crypto hash SHA-256 algoritm to secure your account, just use your email address and name below to login.
                </p>

                <div class="Main">
                    <div class="Inputs">
                        <output class="Login_SHA-256_Output" id="Login_SHA-256_Output" aria-placeholder="Sha-256 Hash"></output>
                        <output class="Field" id="Printed_Text" type="text" style="width: 100%; height: 30px;" placeholder="Credentials"></output>
                    </div>
                    <div class="Buttons">
                        <button id="Open_Verification_Window" style="width: 100%; height: 30px;">Login</button>
                        <button id="Open_Signup_Window" style="width: 100%; height: 30px;">Sign Up</button>
                    </div>
                </div>

                <div class="Manual">
                    <div class="Hash_Name">
                        <input id="Hash_First_Name" class="Field" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                        <input id="Hash_Last_Name" class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                    </div>
                    <input id="Hash_Password" class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Password">
                    <button id="Open_Forgot_Password" style="width: 100%; height:30px;">Forgot Password?</button>
                </div>
            </div>
        </div>

        <!-- Close Login Menu -->
        <div class="Fullscreen_Dialog Close_Login_Menu" id="Close_Login_Menu">
            <div class="Buttons">
                <button class="Fullscreen_Dialog_Button" id="Exit_Page" style="width: 100%; height: 30px;">Exit page</button>
                <button class="Fullscreen_Dialog_Button" id="Revert_Back_To_Login" style="width: 100%; height: 30px;">Revert back to login</button>
            </div>
        </div>

        <!-- Signup Window -->
        <div class="Window Signup_Window" style="width: 300px; height: 600px;">
            <div class="Window_Header">
                <p class="Title">Sign up</p>
                <button class="Close_Button" id="Close_Signup_Window"></button>
                <button class="Max_Size_Button" id="Maximize_Signup_Window"></button>
            </div>

            <!-- Fake Account Overlay -->
            <div class="Fake_Account">
                <div class="Content">
                    <div class="User_Information">
                        <p class="First_Name">First Name: Fake</p>
                        <p class="Last_Name">Last Name: Acccount</p>
                        <p class="Password">Password: Titanic</p>
                        <p class="Information">Make sure you are using capital letters when you are Using the Fake Account</p>
                    </div>
                </div>
            </div>

            <div class="Content">
                <!-- Profile Section -->
                <div class="Main_Title">
                    <p>Sign up</p>
                </div>
                <div class="Signup_Profile">
                    <div class="Signup_Profile_Bubble">
                        <img id="Signup_Profile_Options_Button" src="/Images/Profile Pics/man-user-circle-icon.png" alt="">
                    </div>
                    <div class="Signup_Profile_Name">
                        <p>John Doe</p>
                    </div>
                </div>

                <!-- Wallpaper Section -->
                <div class="Signup_Wallpaper">
                    <div class="Signup_Wallpaper_Container">
                        <img src="/Images/Wallpaper/1bf2a5457e255dba1b0e2e37076b4342.jpg" alt="">
                    </div>
                    <button class="Get_Signup_Wallpaper" id="Get_Signup_Wallpaper" style="width: 100%; height: 30px;">Upload Wallpaper</button>
                </div>

                <!-- Input Fields -->
                <div class="Inputs">
                    <!-- Primary Account Information -->
                    <div class="First_Basic_Inputs">
                        <div class="Title">
                            <p style="color: var(--Main_Text_Color); font-size: var(--Main_Text);">
                                Use the fields below to create your account, the SHA-256 hash will be generated from the data you input.
                            </p>
                        </div>
                        <div class="Hash_Output">
                            <output class="Signup_SHA-256_Output" id="Signup_SHA-256_Output" aria-placeholder="Sha-256 Hash"></output>
                        </div>
                        <div class="Name">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                        </div>
                        <div class="Signup_Password">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Password">
                        </div>
                    </div>

                    <!-- Backup Information -->
                    <div class="Second_Basic_Inputs">
                        <div class="Title">
                            <p style="color: var(--Main_Text_Color); font-size: var(--Main_Text);">
                                This is your backup data, incase you lose your password, you can rely on your secondary information to find your password.
                            </p>
                        </div>
                        <div class="Hash_Output">
                            <output class="Signup_SHA-256_Output" aria-placeholder="Sha-256 Hash"></output>
                        </div>
                        <div class="Name">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                        </div>
                        <div class="Information_1">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Data of birth">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Place of birth">
                        </div>
                        <div class="Information_2">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Information_1">
                            <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Information_2">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Verification Window -->
        <div class="Window Verification_Window" id="Verification_Window" style="width: 200px; height: 300px;">
            <div class="Window_Header">
                <p class="Title">Verification</p>
                <button class="Close_Button" id="Close_Verification_Window"></button>
            </div>
            <div class="Content">
                <div class="Verification_Window_Profile">
                    <img src="/Images/Profile Pics/man-user-circle-icon.png" alt="">
                </div>
                <div class="Data">
                    <span>Verification Success</span>
                    <span style="font-size: var(--Main_Text);">04 : 30</span>
                </div>
                <div class="Buttons">
                    <button id="Go_Home_Button" style="width: calc(100% - 40px); height: 30px;">Go on</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- DROPDOWNS -->
    <!-- ============================================================================ -->
    <div class="Dropdowns">
        <div class="Signup_Profile_Options">
            <div class="Dropdown_Window Signup_Profile_Options_Dropdown">
                <button class="Dropdown_Window_Button" style="width: 100%; height: 30px;">View Picture</button>
                <button class="Dropdown_Window_Button" id="Open_Signup_Upload_Profile_Dialog" style="width: 100%; height: 30px;">Edit Picture</button>
            </div>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- POPUP DIALOGS LAYER 1 -->
    <!-- ============================================================================ -->
    <div class="Popup_Dialogs_Layer1">
        <!-- Upload Profile Picture Dialog -->
        <div class="Window Signup_Upload_Profile_Dialog" style="width: 200px; height: 200px;">
            <div class="Window_Header">
                <p class="Title">Upload Profile Picture</p>
                <button class="Close_Button" id="Close_Signup_Upload_Profile_Dialog"></button>
            </div>
            <div class="Content">
                <div class="Signup_Upload_Profile_Dialog_Profile_Pic">
                    <img src="/Images/Profile Pics/man-user-circle-icon.png" alt="">
                </div>
                <div class="Buttons">
                    <button id="Signup_Get_Picture_From_Computer" style="width: 100%; height: 30px;">Get Profile</button>
                    <button id="Signup_Set_Picture" style="width: 100%; height: 30px;">Set Profile</button>
                </div>
            </div>
        </div>

        <!-- Forgot Password Dialog -->
        <div class="Window Forgot_Password_Dialog" style="width: 300px; height: 340px;">
            <div class="Window_Header">
                <p class="Title">Forgot Password</p>
                <button class="Close_Button" id="Close_Forgot_Password_Dialog"></button>
            </div>
            <div class="Content">
                <div class="Description">
                    <p>Fill out the bottom fields to help recover your password. This uses a Sha-256 hash to hide your password</p>
                </div>
                <div class="Forgotpassword_Output_Hash">
                    <output class="Forgotpassword_SHA-256_Output" id="Forgotpassword_SHA-256_Output" aria-placeholder="Sha-256 Hash"></output>
                    <button id="Open_Forgot_Password_Show_Password_Dialog" style="width: 100%; height: 30px;">Get Password</button>
                </div>
                <div class="Forgotpassword_Inputs">
                    <div class="Name">
                        <input class="Field" id="Forgotpassword_First_Name" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                        <input class="Field" id="Forgotpassword_Last_Name" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                    </div>
                    <div class="Information_1">
                        <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                        <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                    </div>
                    <div class="Information_2">
                        <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="First Name">
                        <input class="Field" type="text" style="width: 100%; height: 30px;" placeholder="Last Name">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- POPUP DIALOGS LAYERS 2-5 (RESERVED) -->
    <!-- ============================================================================ -->
    <div class="Popup_Dialogs_Layer2"></div>
    <div class="Popup_Dialogs_Layer3"></div>
    <div class="Popup_Dialogs_Layer4"></div>
    <div class="Popup_Dialogs_Layer5"></div>

    <!-- ============================================================================ -->
    <!-- FULLSCREEN DIALOGS LAYER 1 -->
    <!-- ============================================================================ -->
    <div class="Fullscreen_Dialogs_Layer1">
        <div class="Fullscreen_Dialog Revert_To_Fullscreen_Dialog" style="display: none;">
            <div class="Buttons">
                <button class="Fullscreen_Dialog_Button" id="Exit_App_Page" style="width: 100%; height: 30px;">Exit page</button>
                <button class="Fullscreen_Dialog_Button" id="Revert_To_Fullscreen" style="width: 100%; height: 30px;">Revert to fullscreen</button>
            </div>
        </div>
        <div class="Fullscreen_Dialog Maps_Dialog" style="display: none;"></div>
    </div>

    <!-- ============================================================================ -->
    <!-- FULLSCREEN DIALOGS LAYER 2 -->
    <!-- ============================================================================ -->
    <div class="Fullscreen_Dialogs_Layer2">
        <div class="Fullscreen_Dialog Forgot_Password_Show_Password_Dialog">
            <div class="Fields">
                <p>Your password is:</p>
                <p class="Recovered_Password" id="Recovered_Password">Password</p>
            </div>
            <div class="Close_Button">
                <button id="Close_Forgot_Password_Show_Password_Dialog" style="width: 200px; height: 30px;">Close</button>
            </div>
        </div>
    </div>

    <!-- ============================================================================ -->
    <!-- FULLSCREEN DIALOGS LAYER 3 (RESERVED) -->
    <!-- ============================================================================ -->
    <div class="Fullscreen_Dialogs_Layer3"></div>

    <!-- ============================================================================ -->
    <!-- FAKE ACCOUNT OVERLAY SCRIPT -->
    <!-- ============================================================================ -->
    <script>
        (function(){
            const signupWindow = document.querySelector('.Signup_Window');
            const fakeAccount = document.querySelector('.Fake_Account');
            if (!signupWindow || !fakeAccount) return;
            
            function updateScrollBehavior() {
                const isFakeVisible = window.getComputedStyle(fakeAccount).display !== 'none';
                signupWindow.style.overflow = isFakeVisible ? 'hidden' : '';
            }
            
            updateScrollBehavior();
            const observer = new MutationObserver(updateScrollBehavior);
            observer.observe(fakeAccount, { attributes: true, attributeFilter: ['style', 'class'] });
        })();
    </script>
</body>
</html>

<!-- This is where you add the behaviors of the elements -->

<script>

    // ============================================================================
    // EXTERNAL CONTENT INJECTION
    // ============================================================================

    // ============================================================================
    // FULLSCREEN FUNCTIONALITY
    // ============================================================================

    (function(){
        const fsBtn = document.getElementById('Close_Disclaimer');
        const docEl = document.documentElement;
        if (!fsBtn) return;

        async function enterFullscreen() {
            try {
                if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                    return;
                }
                if (docEl.requestFullscreen) {
                    await docEl.requestFullscreen();
                } else if (docEl.webkitRequestFullscreen) {
                    await docEl.webkitRequestFullscreen();
                } else if (docEl.msRequestFullscreen) {
                    await docEl.msRequestFullscreen();
                }
            } catch (err) {
                console.warn('Failed to enter fullscreen:', err);
            }
        }

        fsBtn.addEventListener('click', (e) => {
            enterFullscreen();
        });
    })();

    // ============================================================================
    // PROGRESS BAR
    // ============================================================================

    (function(){
        const bar = document.getElementById('Progress_Bar');
        const fill = document.getElementById('Progress_Fill');
        const label = document.getElementById('Progress_Label');
        const btn = document.getElementById('Close_Disclaimer');
        if (!bar || !fill || !label) return;

        const originalBtnDisplay = btn ? (btn.style.display || '') : '';
        bar.style.display = 'none';

        window.setProgress = function(percent){
            const p = Math.max(0, Math.min(100, Math.round(percent)));
            fill.style.width = p + '%';
            bar.setAttribute('aria-valuenow', p);
            label.textContent = p + '%';
        };

        let progressInterval = null;

        function startProgressDemo() {
            clearProgress();
            if (btn) btn.style.display = 'none';

            bar.style.display = 'flex';
            let demo = 0;
            window.setProgress(0);
            progressInterval = setInterval(() => {
                demo += 8;
                window.setProgress(demo);
                if (demo >= 100) {
                    clearInterval(progressInterval);
                    progressInterval = null;
                    window.setProgress(100);
                    if (btn) btn.style.display = originalBtnDisplay;
                    return;
                }
            }, 100);
        }

        function clearProgress() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
        }

        function stopAndHideProgress() {
            clearProgress();
            window.setProgress(0);
            bar.style.display = 'none';
            if (btn) btn.style.display = originalBtnDisplay;
        }

        if (btn) {
            btn.addEventListener('click', () => {
                startProgressDemo();
            });
        }

        function onFullscreenChange() {
            const isFs = !!(document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement);
            if (!isFs) {
                stopAndHideProgress();
            }
        }

        document.addEventListener('fullscreenchange', onFullscreenChange);
        document.addEventListener('webkitfullscreenchange', onFullscreenChange);
        document.addEventListener('msfullscreenchange', onFullscreenChange);

        window._progressControl = { start: startProgressDemo, stop: stopAndHideProgress };
    })();

    // Progress Bar - Auto-open Login Window
    (function(){
        const progressBar = document.getElementById('Progress_Bar');
        if (!progressBar) return;
        const fsBtn = document.getElementById('Close_Disclaimer');

        function openLoginWindow() {
            const loginContainer = document.querySelector('.Login');
            const loginWindow = document.querySelector('.Login_Window');
            if (!loginContainer || !loginWindow) return;

            loginContainer.style.display = 'flex';
            loginWindow.style.display = 'flex';
            loginWindow.style.position = 'absolute';

            const winRect = loginWindow.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            loginWindow.style.left = Math.max(0, (bodyRect.width - winRect.width) / 2) + 'px';
            loginWindow.style.top = Math.max(0, (bodyRect.height - winRect.height) / 2) + 'px';

            const first = loginWindow.querySelector('input, button, [tabindex]');
            if (first && typeof first.focus === 'function') first.focus();

            if (fsBtn) fsBtn.style.display = 'none';
        }

        if (typeof window.setProgress === 'function') {
            const origSet = window.setProgress;
            window.setProgress = function(percent) {
                try {
                    origSet(percent);
                } catch (e) {
                    try { origSet(Number(percent)); } catch (_) {}
                }
                const p = Math.max(0, Math.min(100, Math.round(Number(percent) || 0)));
                if (p >= 100) openLoginWindow();
            };
        }

        const obs = new MutationObserver(muts => {
            for (const m of muts) {
                if (m.type === 'attributes' && m.attributeName === 'aria-valuenow') {
                    const v = Number(progressBar.getAttribute('aria-valuenow') || 0);
                    if (v >= 100) {
                        openLoginWindow();
                        obs.disconnect();
                        break;
                    }
                }
            }
        });
        obs.observe(progressBar, { attributes: true });
    })();

    // Progress Bar - Auto-hide at 100%
    (function(){
        const bar = document.getElementById('Progress_Bar');
        if (!bar) return;

        const origSet = window.setProgress;
        window.setProgress = function(percent) {
            try { if (typeof origSet === 'function') origSet(percent); } catch (e) {}
            const p = Math.max(0, Math.min(100, Math.round(Number(percent) || 0)));
            if (p >= 100) {
                setTimeout(() => { bar.style.display = 'none'; }, 350);
            }
        };
    })();

    // ============================================================================
    // WALLPAPER SLIDESHOW
    // ============================================================================

    (function(){
        const imgList = Array.from(document.querySelectorAll('.Wallpaper .Img_List img'));
        if (!imgList.length) return;

        const container = document.querySelector('.Wallpaper .Img_List');
        if (container) container.style.position = 'relative';

        imgList.forEach((img, i) => {
            img.style.position = 'absolute';
            img.style.top = '0';
            img.style.left = '0';
            img.style.width = '100dvw';
            img.style.height = '100dvh';
            img.style.objectFit = 'cover';
            img.style.opacity = i === 0 ? '1' : '0';
            img.style.transition = 'opacity 3000ms ease';
            img.style.zIndex = i === 0 ? '2' : '1';
            img.style.pointerEvents = 'none';
            if (img.decode) img.decode().catch(()=>{});
        });

        function shuffleImages(images) {
            for (let i = images.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                if (i === j) continue;
                const a = images[i], b = images[j];
                const parent = a.parentNode;
                parent.insertBefore(b, a);
                [images[i], images[j]] = [images[j], images[i]];
            }
        }

        shuffleImages(imgList);

        let currentIndex = 0;
        const fadeDuration = 1000;
        const displayDuration = 9000;
        let timeoutId = null;
        let running = true;

        function crossfadeTo(nextIndex) {
            if (!running || nextIndex === currentIndex) return;
            const current = imgList[currentIndex];
            const next = imgList[nextIndex];

            next.style.zIndex = (parseInt(current.style.zIndex || '1') + 1).toString();
            next.style.opacity = '0';
            void next.offsetWidth;
            next.style.opacity = '1';

            setTimeout(() => {
                current.style.opacity = '0';
                current.style.zIndex = '1';
                next.style.zIndex = '2';
                currentIndex = nextIndex;
            }, fadeDuration);
        }

        function scheduleNext() {
            timeoutId = setTimeout(() => {
                const nextIndex = (currentIndex + 1) % imgList.length;
                crossfadeTo(nextIndex);
                scheduleNext();
            }, displayDuration);
        }

        scheduleNext();

        window._wallpaperSlideshow = {
            stop() { running = false; clearTimeout(timeoutId); },
            start() { if (!running) { running = true; scheduleNext(); } },
            next() { clearTimeout(timeoutId); crossfadeTo((currentIndex + 1) % imgList.length); scheduleNext(); },
            prev() { clearTimeout(timeoutId); crossfadeTo((currentIndex - 1 + imgList.length) % imgList.length); scheduleNext(); }
        };
    })();

    // Wallpaper Shuffle
    (function(){
        const container = document.querySelector('.Wallpaper .Img_List');
        if (!container) return;

        function fisherYatesShuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        function shuffleWallpaperImagesRandomly() {
            const imgs = Array.from(container.querySelectorAll('img'));
            if (imgs.length <= 1) return;

            fisherYatesShuffle(imgs);

            imgs.forEach((img, idx) => {
                container.appendChild(img);
                img.style.opacity = idx === 0 ? '1' : '0';
                img.style.zIndex = idx === 0 ? '2' : '1';
            });

            try {
                if (window._wallpaperSlideshow) {
                    window._wallpaperSlideshow.stop?.();
                    setTimeout(() => window._wallpaperSlideshow.start?.(), 50);
                }
            } catch (e) {}
        }

        window.shuffleWallpaperImagesRandomly = shuffleWallpaperImagesRandomly;
        shuffleWallpaperImagesRandomly();
        container.addEventListener('dblclick', () => shuffleWallpaperImagesRandomly());
    })();

    // ============================================================================
    // DISCLAIMER
    // ============================================================================

    document.getElementById('Close_Disclaimer').addEventListener('click', function() {
        document.getElementById('Disclaimer').style.display = 'none';
    });

    // ============================================================================
    // LOGIN WINDOW
    // ============================================================================

    // Close Login Menu
    (function(){
        const closeLoginBtn = document.getElementById('Close_Login_Button');
        const closeMenu = document.getElementById('Close_Login_Menu');
        const revertBtn = document.getElementById('Revert_Back_To_Login');
        const exitBtn = document.getElementById('Exit_Page');

        if (!closeLoginBtn || !closeMenu) return;

        closeLoginBtn.addEventListener('click', () => {
            closeMenu.style.display = 'flex';
            try { if (typeof bringToFront === 'function') bringToFront(closeMenu); } catch(e){}
            const first = closeMenu.querySelector('button');
            if (first && typeof first.focus === 'function') first.focus();
        });

        if (revertBtn) {
            revertBtn.addEventListener('click', () => {
                closeMenu.style.display = 'none';
                const loginWin = document.querySelector('.Login_Window');
                if (loginWin) try { if (typeof bringToFront === 'function') bringToFront(loginWin); } catch(e){}
            });
        }

        async function exitFullscreenIfNeeded() {
            try {
                if (document.fullscreenElement || document.webkitFullscreenElement || document.msFullscreenElement) {
                    if (document.exitFullscreen) await document.exitFullscreen();
                    else if (document.webkitExitFullscreen) await document.webkitExitFullscreen();
                    else if (document.msExitFullscreen) await document.msExitFullscreen();
                }
            } catch (e) {}
        }

        if (exitBtn) {
            exitBtn.addEventListener('click', async () => {
                await exitFullscreenIfNeeded();
                try { closeMenu.style.display = 'none'; } catch(e){}
                try { window.close(); } catch (e) {}
            });
        }
    })();

    // Exit Page Actions
    (function(){
        const exitBtn = document.getElementById('Exit_Page');
        const login = document.getElementById('Login');
        const fsBtn = document.getElementById('Full_Screen_Button');
        if (!exitBtn) return;

        exitBtn.addEventListener('click', () => {
            if (login) login.style.display = 'none';
            if (fsBtn) fsBtn.style.display = '';
            
            window.close();
            setTimeout(() => {
                if (!window.closed) {
                    window.location.href = 'about:blank';
                }
            }, 100);
        });
    })();

    // ============================================================================
    // LOGIN - SHA-256 HASH
    // ============================================================================

    // Sync Printed Text Field
    (function(){
        function syncPrinted() {
            const printed = document.getElementById('Printed_Text');
            const first = document.getElementById('Hash_First_Name');
            const last = document.getElementById('Hash_Last_Name');
            const pass = document.getElementById('Hash_Password');
            if (!printed || !first || !last || !pass) return;
            const combined = [first.value || '', last.value || '', pass.value || ''].join(' ').trim();
            printed.value = combined;
            try { printed.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
            try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
        }

        ['Hash_First_Name','Hash_Last_Name','Hash_Password'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('input', syncPrinted);
            const mo = new MutationObserver(syncPrinted);
            mo.observe(el, { attributes: true, attributeFilter: ['value'] });
        });

        setTimeout(syncPrinted, 0);
    })();

    // Calculate SHA-256 Hash
    (function(){
        async function computeSHA256Hex(str) {
            const enc = new TextEncoder();
            const data = enc.encode(str);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        async function updateSHAField() {
            const out = document.getElementById('Login_SHA-256_Output');
            if (!out) return;

            const printed = document.getElementById('Printed_Text')?.value || '';
            const first = document.getElementById('Hash_First_Name')?.value || '';
            const last  = document.getElementById('Hash_Last_Name')?.value || '';
            const pass  = document.getElementById('Hash_Password')?.value || '';

            const combined = `${printed}|${first}|${last}|${pass}`;

            try {
                const hex = await computeSHA256Hex(combined);
                out.textContent = hex;
            } catch (e) {
                out.textContent = 'hash-error';
                console.error('SHA-256 failed', e);
            }
        }

        window.updateSHAField = updateSHAField;

        ['Printed_Text','Hash_First_Name','Hash_Last_Name','Hash_Password'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.addEventListener('input', updateSHAField);
            const mo = new MutationObserver(updateSHAField);
            mo.observe(el, { attributes: true, attributeFilter: ['value'] });
        });

        setTimeout(updateSHAField, 0);
    })();

    // Truncate SHA-256 Display
    (function(){
        const out = document.getElementById('Login_SHA-256_Output');
        if (!out) return;

        const orig = window.updateSHAField || (async function(){});

        window.updateSHAField = async function(...args) {
            await orig.apply(this, args);
            const full = (out.textContent || '').toString();
            out.dataset.full = full;
            out.textContent = full.slice(0, 32).toUpperCase();
        };

        setTimeout(() => { try { window.updateSHAField(); } catch(e){} }, 0);
    })();

    // ============================================================================
    // VERIFICATION WINDOW
    // ============================================================================

    (function(){
        const openBtn = document.getElementById('Open_Verification_Window');
        const verification = document.getElementById('Verification_Window');
        const loginWindow = document.querySelector('.Login_Window');
        const loginContainer = document.querySelector('.Login');

        if (!openBtn || !verification) return;

        function centerAndShow(el) {
            el.style.display = 'flex';
            el.style.position = 'absolute';
            const rect = el.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            el.style.left = Math.max(0, (bodyRect.width - rect.width) / 2) + 'px';
            el.style.top = Math.max(0, (bodyRect.height - rect.height) / 2) + 'px';
            try { if (typeof bringToFront === 'function') bringToFront(el); } catch(e){}
        }

        openBtn.addEventListener('click', (e) => {
            centerAndShow(verification);
            if (loginContainer) loginContainer.style.display = 'flex';
            try { if (typeof bringToFront === 'function') bringToFront(verification); } catch(e){}
        });

        const closeVerBtn = document.getElementById('Close_Verification_Window');
        if (closeVerBtn) {
            closeVerBtn.addEventListener('click', () => {
                verification.style.display = 'none';
                try { if (loginWindow) { loginWindow.style.display = 'flex'; bringToFront(loginWindow); } } catch(e){}
            });
        }
    })();

    // Real-time Clock
    (function(){
        function formatTime(d){
            return d.toLocaleTimeString();
        }

        const timeEl = document.querySelector('.Login .Verification_Window .Data span:nth-of-type(2)');
        function refresh() {
            if (timeEl) timeEl.textContent = formatTime(new Date());
        }

        window.getCurrentTime = function() {
            const now = new Date();
            return { date: now, formatted: formatTime(now), iso: now.toISOString() };
        };

        refresh();
        setInterval(refresh, 1000);
    })();

    // ============================================================================
    // SIGNUP WINDOW
    // ============================================================================

    // Open Signup Window
    (function(){
        const openBtn = document.getElementById('Open_Signup_Window');
        const signupWin = document.querySelector('.Signup_Window');
        const loginWin = document.querySelector('.Login_Window');

        if (!openBtn || !signupWin) return;

        function centerAndShow(el) {
            el.style.display = 'flex';
            el.style.position = 'absolute';
            const rect = el.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            el.style.left = Math.max(0, (bodyRect.width - rect.width) / 2) + 'px';
            el.style.top = Math.max(0, (bodyRect.height - rect.height) / 2) + 'px';
            try { if (typeof bringToFront === 'function') bringToFront(el); } catch (e) {}
        }

        openBtn.addEventListener('click', () => {
            centerAndShow(signupWin);
            try { if (typeof bringToFront === 'function') bringToFront(signupWin); } catch (e) {}

            try {
                const first = signupWin.querySelector('input, button, [tabindex]');
                if (first && typeof first.focus === 'function') first.focus();
            } catch (e) {}
        });
    })();

    // Close Signup Window
    (function(){
        const closeBtn = document.getElementById('Close_Signup_Window');
        const signupWin = document.querySelector('.Signup_Window');
        const loginWin = document.querySelector('.Login_Window');

        if (!closeBtn) return;

        closeBtn.addEventListener('click', () => {
            if (signupWin) signupWin.style.display = 'none';
            if (loginWin) {
                loginWin.style.display = 'flex';
                try { bringToFront(loginWin); } catch (e) {}
            }
        });
    })();

    // Maximize Signup Window
    (function(){
        const btn = document.getElementById('Maximize_Signup_Window');
        const win = document.querySelector('.Signup_Window');
        if (!btn || !win) return;

        btn.addEventListener('click', () => {
            const isMax = win.dataset.maximized === '1';

            if (!isMax) {
                const rect = win.getBoundingClientRect();
                win.dataset.prevLeft = win.style.left || rect.left + 'px';
                win.dataset.prevTop = win.style.top || rect.top + 'px';
                win.dataset.prevWidth = win.style.width || rect.width + 'px';
                win.dataset.prevHeight = win.style.height || rect.height + 'px';
                win.dataset.prevPosition = win.style.position || getComputedStyle(win).position;

                win.style.position = 'fixed';
                win.style.left = '0';
                win.style.top = '0';
                win.style.width = '100vw';
                win.style.height = '100vh';
                win.style.margin = '0';
                win.dataset.maximized = '1';

                btn.style.background = 'rgb(255,255,255)';
                try { bringToFront(win); } catch(e){}
            } else {
                win.style.position = win.dataset.prevPosition || '';
                win.style.left = win.dataset.prevLeft || '';
                win.style.top = win.dataset.prevTop || '';
                win.style.width = win.dataset.prevWidth || '';
                win.style.height = win.dataset.prevHeight || '';
                win.style.margin = '';

                delete win.dataset.prevLeft;
                delete win.dataset.prevTop;
                delete win.dataset.prevWidth;
                delete win.dataset.prevHeight;
                delete win.dataset.prevPosition;
                win.dataset.maximized = '0';

                btn.style.background = '';
                try { bringToFront(win); } catch(e){}
            }
        });
    })();

    // ============================================================================
    // SIGNUP - PROFILE PICTURE
    // ============================================================================

    // Profile Options Dropdown
    (function(){
        const dropdown = document.querySelector('.Signup_Profile_Options_Dropdown');
        const bubble = document.querySelector('.Signup_Profile_Bubble');
        const toggleBtn = document.getElementById('Signup_Profile_Options_Button') || bubble;

        if (!dropdown || !bubble || !toggleBtn) return;

        dropdown.style.position = 'absolute';
        dropdown.style.display = dropdown.style.display || 'none';
        dropdown.style.zIndex = dropdown.style.zIndex || '9999';

        function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

        function positionDropdown() {
            const bRect = bubble.getBoundingClientRect();
            const ddRect = dropdown.getBoundingClientRect();
            const vw = document.documentElement.clientWidth;
            const vh = document.documentElement.clientHeight;

            let left = bRect.right - ddRect.width;
            let top  = bRect.bottom + 8;

            if (top + ddRect.height > vh) {
                top = bRect.top - ddRect.height - 8;
            }

            left = clamp(left, 8, Math.max(8, vw - ddRect.width - 8));
            top  = clamp(top, 8, Math.max(8, vh - ddRect.height - 8));

            dropdown.style.left = left + window.scrollX + 'px';
            dropdown.style.top  = top  + window.scrollY + 'px';
        }

        function showDropdown() {
            dropdown.style.display = 'block';
            positionDropdown();
            dropdown.setAttribute('aria-hidden','false');
            document.addEventListener('click', onDocClick, true);
            window.addEventListener('resize', positionDropdown, { passive:true });
            window.addEventListener('scroll', positionDropdown, { passive:true });
        }

        function hideDropdown() {
            dropdown.style.display = 'none';
            dropdown.setAttribute('aria-hidden','true');
            document.removeEventListener('click', onDocClick, true);
            window.removeEventListener('resize', positionDropdown);
            window.removeEventListener('scroll', positionDropdown);
        }

        function toggleDropdown(e){
            e && e.stopPropagation && e.stopPropagation();
            if (dropdown.style.display === 'block') hideDropdown();
            else showDropdown();
        }

        function onDocClick(e){
            const t = e.target;
            if (t && (t.closest('.Signup_Profile_Bubble') || t.closest('.Signup_Profile_Options_Dropdown') || t === toggleBtn)) return;
            hideDropdown();
        }

        if (window.ResizeObserver) {
            const ro = new ResizeObserver(() => {
                if (dropdown.style.display === 'block') positionDropdown();
            });
            ro.observe(bubble);
        }

        toggleBtn.addEventListener('click', toggleDropdown, { passive: true });

        window.profileOptions = {
            show: showDropdown,
            hide: hideDropdown,
            toggle: toggleDropdown,
            position: positionDropdown
        };
    })();

    // Close Dropdown on Outside Click
    (function(){
        function hideIfOpen(e){
            const dd = document.querySelector('.Signup_Profile_Options_Dropdown');
            if (!dd) return;
            if (dd.style.display !== 'block') return;

            if (e.target && (e.target.closest('.Signup_Profile_Options_Dropdown') || e.target.closest('.Signup_Profile_Bubble') || e.target.closest('#Signup_Profile_Options_Button'))) {
                return;
            }

            try { if (window.profileOptions && typeof window.profileOptions.hide === 'function') { window.profileOptions.hide(); return; } } catch(e){}

            dd.style.display = 'none';
        }

        document.addEventListener('click', hideIfOpen, true);
        document.addEventListener('touchstart', hideIfOpen, { passive: true, capture: true });
    })();

    // Upload Profile Dialog
    (function(){
        const openBtn = document.getElementById('Open_Signup_Upload_Profile_Dialog');
        const dialog = document.querySelector('.Signup_Upload_Profile_Dialog');
        if (!openBtn || !dialog) return;

        function centerAndShow(el){
            el.style.display = 'flex';
            el.style.position = 'absolute';
            const rect = el.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            el.style.left = Math.max(0, (bodyRect.width - rect.width) / 2) + 'px';
            el.style.top  = Math.max(0, (bodyRect.height - rect.height) / 2) + 'px';
            try { if (typeof bringToFront === 'function') bringToFront(el); } catch(e){}
        }

        openBtn.addEventListener('click', (ev) => {
            ev.stopPropagation();
            centerAndShow(dialog);
            try {
                const first = dialog.querySelector('button, input, [tabindex]');
                if (first && typeof first.focus === 'function') first.focus();
            } catch(e){}
        }, { passive: true });

        const closeBtn = document.getElementById('Close_Signup_Upload_Profile_Dialog');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                dialog.style.display = 'none';
            });
        }
    })();

    // Hide Dropdown When Dialog Opens
    (function(){
        const dialog = document.querySelector('.Signup_Upload_Profile_Dialog');
        const dropdown = document.querySelector('.Signup_Profile_Options_Dropdown');
        if (!dialog || !dropdown) return;

        function hideDropdown() {
            try {
                if (dropdown.style.display === 'block' || getComputedStyle(dropdown).display !== 'none') {
                    dropdown.style.display = 'none';
                    dropdown.setAttribute('aria-hidden', 'true');
                }
            } catch (e) {}
        }

        const mo = new MutationObserver(() => {
            const isVisible = getComputedStyle(dialog).display !== 'none';
            if (isVisible) hideDropdown();
        });
        mo.observe(dialog, { attributes: true, attributeFilter: ['style', 'class', 'aria-hidden'] });

        const openBtn = document.getElementById('Open_Signup_Upload_Profile_Dialog');
        if (openBtn) openBtn.addEventListener('click', hideDropdown, { passive: true });

        document.addEventListener('profileUploadDialogOpened', hideDropdown, { passive: true });
    })();

    // Get Profile Picture from Computer
    (function(){
        const btn = document.getElementById('Signup_Get_Picture_From_Computer');
        if (!btn) return;

        btn.addEventListener('click', (ev) => {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.display = 'none';
            document.body.appendChild(input);

            input.addEventListener('change', () => {
                const file = input.files && input.files[0];
                if (!file) {
                    input.remove();
                    return;
                }
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    input.remove();
                    return;
                }

                const reader = new FileReader();
                reader.onload = () => {
                    const dataUrl = reader.result;

                    const dialogImg = document.querySelector('.Signup_Upload_Profile_Dialog img');
                    if (dialogImg) {
                        dialogImg.src = dataUrl;
                        dialogImg.alt = file.name || 'Profile picture';
                        dialogImg.dataset.selected = '1';
                    }

                    const bubbleBtnImg = document.getElementById('Signup_Profile_Options_Button') ||
                                         document.querySelector('.Signup_Profile_Bubble img');
                    if (bubbleBtnImg) {
                        bubbleBtnImg.src = dataUrl;
                        bubbleBtnImg.alt = file.name || 'Profile picture';
                        bubbleBtnImg.dataset.selected = '1';
                    }

                    try {
                        const evt = new CustomEvent('profilePictureChosen', { detail: { file, dataUrl } });
                        document.dispatchEvent(evt);
                    } catch (e) {}

                    input.remove();
                };

                reader.onerror = () => {
                    alert('Failed to read image file.');
                    input.remove();
                };

                reader.readAsDataURL(file);
            }, { once: true });

            input.click();
        });
    })();

    // Prevent Profile Image Stretching
    (function(){
        const s = document.createElement('style');
        s.textContent = `
            .Signup_Profile_Bubble img,
            .Signup_Upload_Profile_Dialog img,
            .Verification_Window_Profile img,
            .Signup_Upload_Profile_Dialog_Profile_Pic img {
                width: 100% !important;
                height: 100% !important;
                object-fit: cover !important;
                object-position: center center !important;
                display: block !important;
            }
        `;
        document.head.appendChild(s);

        function enforceNoStretch(sel) {
            document.querySelectorAll(sel).forEach(img => {
                try{
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.objectFit = 'cover';
                    img.style.objectPosition = 'center';
                    img.style.display = 'block';
                }catch(e){}
            });
        }

        ['.Signup_Profile_Bubble img',
         '.Signup_Upload_Profile_Dialog img',
         '.Verification_Window_Profile img',
         '.Signup_Upload_Profile_Dialog_Profile_Pic img'
        ].forEach(enforceNoStretch);

        document.addEventListener('profilePictureChosen', () => {
            ['#Signup_Profile_Options_Button',
             '.Signup_Profile_Bubble img',
             '.Signup_Upload_Profile_Dialog img',
             '.Verification_Window_Profile img'
            ].forEach(enforceNoStretch);
        });

        const mo = new MutationObserver((muts) => {
            muts.forEach(m => {
                if (m.addedNodes && m.addedNodes.length) {
                    m.addedNodes.forEach(n => {
                        if (n.nodeType === 1) {
                            if (n.matches && n.matches('img')) {
                                enforceNoStretch('img');
                            } else {
                                enforceNoStretch('.Signup_Profile_Bubble img');
                                enforceNoStretch('.Signup_Upload_Profile_Dialog img');
                                enforceNoStretch('.Verification_Window_Profile img');
                            }
                        }
                    });
                }
            });
        });
        mo.observe(document.body, { childList: true, subtree: true });
    })();

    // Set Profile Picture
    (function(){
        let btn = document.getElementById('Signup_Set_Picture');
        if (!btn) {
            const dialog = document.querySelector('.Signup_Upload_Profile_Dialog');
            if (dialog) {
                btn = Array.from(dialog.querySelectorAll('button')).find(b => (b.id && b.id.startsWith('Signup_Set_Picture')) || b.textContent.trim().toLowerCase() === 'set profile');
            }
            if (!btn) btn = document.querySelector('button[id^="Signup_Set_Picture"]') || null;
        }
        if (!btn) return;

        btn.addEventListener('click', (ev) => {
            ev.preventDefault();
            const dialog = document.querySelector('.Signup_Upload_Profile_Dialog');
            if (!dialog) return;

            const dialogImg = dialog.querySelector('img');
            if (!dialogImg || !dialogImg.src) {
                dialog.style.display = 'none';
                return;
            }

            const bubbleBtnImg = document.getElementById('Signup_Profile_Options_Button') || document.querySelector('.Signup_Profile_Bubble img');
            if (bubbleBtnImg) {
                bubbleBtnImg.src = dialogImg.src;
                bubbleBtnImg.alt = dialogImg.alt || 'Profile picture';
                bubbleBtnImg.dataset.selected = '1';
            }

            const verificationImg = document.querySelector('.Verification_Window_Profile img');
            if (verificationImg) {
                verificationImg.src = dialogImg.src;
                verificationImg.alt = dialogImg.alt || '';
                verificationImg.dataset.selected = '1';
            }

            document.querySelectorAll('.Signup_Profile_Bubble img, .Signup_Upload_Profile_Dialog img, #Signup_Profile_Options_Button, .Verification_Window_Profile img')
                .forEach(img => {
                    try {
                        if (img !== dialogImg && img.tagName === 'IMG') {
                            img.src = dialogImg.src;
                        }
                    } catch(e){}
                });

            dialog.style.display = 'none';

            try { document.dispatchEvent(new CustomEvent('profilePictureChosen', { detail: { src: dialogImg.src } })); } catch(e){}
            try { document.dispatchEvent(new CustomEvent('profilePictureConfirmed', { detail: { src: dialogImg.src } })); } catch(e){}
        }, { passive: true });
    })();

    // ============================================================================
    // SIGNUP - WALLPAPER
    // ============================================================================

    (function(){
        const btn = document.getElementById('Get_Signup_Wallpaper');
        if (!btn) return;

        btn.addEventListener('click', (ev) => {
            ev.preventDefault();
            
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.style.display = 'none';
            document.body.appendChild(input);

            input.addEventListener('change', () => {
                const file = input.files && input.files[0];
                if (!file) {
                    input.remove();
                    return;
                }
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file.');
                    input.remove();
                    return;
                }

                const reader = new FileReader();
                reader.onload = () => {
                    const dataUrl = reader.result;

                    const wallpaperImg = document.querySelector('.Signup_Wallpaper_Container img');
                    if (wallpaperImg) {
                        wallpaperImg.src = dataUrl;
                        wallpaperImg.alt = file.name || 'Custom wallpaper';
                    }

                    try {
                        const evt = new CustomEvent('signupWallpaperChosen', { detail: { file, dataUrl } });
                        document.dispatchEvent(evt);
                    } catch (e) {}

                    input.remove();
                };

                reader.onerror = () => {
                    alert('Failed to read image file.');
                    input.remove();
                };

                reader.readAsDataURL(file);
            }, { once: true });

            input.click();
        });
    })();

    // ============================================================================
    // FORGOT PASSWORD
    // ============================================================================

    // Open Forgot Password Dialog
    (function(){
        const openBtn = document.getElementById('Open_Forgot_Password');
        const dialog = document.querySelector('.Forgot_Password_Dialog');
        if (!openBtn || !dialog) return;

        function centerAndShow(el){
            el.style.display = 'flex';
            el.style.position = 'absolute';
            const rect = el.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            el.style.left = Math.max(0, (bodyRect.width - rect.width) / 2) + 'px';
            el.style.top  = Math.max(0, (bodyRect.height - rect.height) / 2) + 'px';
            try { if (typeof bringToFront === 'function') bringToFront(el); } catch(e){}
            const first = el.querySelector('input, button, [tabindex]');
            if (first && typeof first.focus === 'function') first.focus();
        }

        openBtn.addEventListener('click', (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            centerAndShow(dialog);
        }, false);

        const closeBtn = document.getElementById('Close_Forgot_Password_Dialog');
        if (closeBtn) closeBtn.addEventListener('click', () => { dialog.style.display = 'none'; });
    })();

    // Show Password Dialog
    (function(){
        const openBtn = document.getElementById('Open_Forgot_Password_Show_Password_Dialog');
        const dialog = document.querySelector('.Forgot_Password_Show_Password_Dialog');
        const closeBtn = document.getElementById('Close_Forgot_Password_Show_Password_Dialog');
        if (!openBtn || !dialog) return;

        function showDialog() {
            dialog.style.display = 'flex';
            dialog.style.position = 'fixed';
            dialog.style.left = '50%';
            dialog.style.top = '50%';
            dialog.style.transform = 'translate(-50%, -50%)';
            dialog.style.zIndex = '99999';
            try { if (typeof bringToFront === 'function') bringToFront(dialog); } catch (e) {}
            const focusTarget = dialog.querySelector('button, [tabindex], input');
            if (focusTarget && typeof focusTarget.focus === 'function') focusTarget.focus();
        }

        function hideDialog() {
            dialog.style.display = 'none';
        }

        openBtn.addEventListener('click', (ev) => {
            ev.preventDefault();
            ev.stopPropagation();
            showDialog();
        }, false);

        if (closeBtn) {
            closeBtn.addEventListener('click', () => hideDialog(), false);
        }

        document.addEventListener('keydown', (ev) => {
            if (ev.key === 'Escape' && getComputedStyle(dialog).display !== 'none') hideDialog();
        });
    })();

    // ============================================================================
    // NAVIGATION
    // ============================================================================

    (function(){
        const goHomeBtn = document.getElementById('Go_Home_Button');
        if (!goHomeBtn) return;

        goHomeBtn.addEventListener('click', (ev) => {
            ev.preventDefault();
            window.location.href = 'Home.html';
        });
    })();
    
    </script>
    
    <!-- ============================================================================ -->
    <!-- VIRTUAL KEYBOARD -->
    <!-- ============================================================================ -->
    <div class="Keyboard">
            <!-- ============================================================ -->
            <!-- STYLES -->
            <!-- ============================================================ -->
            <style>
                /* Virtual Keyboard Container */
                .VirtualKeyboard {
                    position: fixed;
                    left: 10px;
                    right: 10px;
                    bottom: 10px;
                    background: var(--VirtualKeyboard_Background);
                    border-radius: var(--Border-Radius_1);
                    backdrop-filter: var(--Back_drop);
                    padding: 10px;
                    z-index: 9999;
                    box-shadow: var(--Box_Shadow);
                    user-select: none;
                    -webkit-user-select: none;
                    display: none;
                    touch-action: none;
                }

                /* Keyboard Rows */
                .vk-row {
                    display: flex;
                    gap: 6px;
                    margin-bottom: 6px;
                    justify-content: center;
                }

                /* Key Buttons */
                .vk-key {
                    flex: 1 0 0;
                    min-width: 30px;
                    padding: 10px 10px;
                    text-align: center;
                    background: var(--VirtualKeyboard_Keys);
                    color: var(--Main_Text_Color);
                    font-size: calc(var(--Main_Text));
                    border-radius: var(--Border-Radius_1);
                    outline: none;
                    touch-action: manipulation;
                    -webkit-appearance: none;
                    appearance: none;
                }

                .vk-key.wide { flex: 2.4; min-width: 60px; }
                .vk-key.extra { flex: 1.6; min-width: 48px; }
                .vk-key:active { transform: translateY(1px); background: var(--Active_Key); }
                .vk-key.active { 
                    transform: translateY(1px) !important; 
                    background: var(--Text_Input_Field-Actove, var(--Active_Key)) !important; 
                }
                .vk-hidden { display: none !important; }

                /* Input Field Styles */
                input.Field, #Printed_Text, #Hash_Name, #Password, textarea.Field {
                    caret-color: var(--Main_Text_Color);
                    -webkit-text-fill-color: var(--Main_Text_Color);
                    user-select: text;
                }

                input.Field:focus, #Printed_Text:focus, #Hash_Name:focus, #Password:focus, textarea.Field:focus {
                    outline: none;
                    border: 1px solid var(--Active_Border);
                }

                input.Field:focus-visible, #Printed_Text:focus-visible, #Hash_Name:focus-visible, #Password:focus-visible, textarea.Field:focus-visible {
                    border: 1px solid var(--Active_Border);
                }

                /* Animations */
                @keyframes vk-scale-in {
                    from {
                        transform: scale(0.95);
                        opacity: 0;
                    }
                    to {
                        transform: scale(1);
                        opacity: 1;
                    }
                }
                
                .VirtualKeyboard.vk-animating {
                    animation: vk-scale-in 0.2s cubic-bezier(0.4, 0, 0.2, 1) forwards;
                }
            </style>

            <!-- ============================================================ -->
            <!-- KEYBOARD HTML STRUCTURE -->
            <!-- ============================================================ -->
            <div class="VirtualKeyboard" id="VirtualKeyboard" aria-hidden="true" role="application">
                <div class="vk-row" id="vk-row-1">
                    <button class="vk-key" data-key="q">q</button>
                    <button class="vk-key" data-key="w">w</button>
                    <button class="vk-key" data-key="e">e</button>
                    <button class="vk-key" data-key="r">r</button>
                    <button class="vk-key" data-key="t">t</button>
                    <button class="vk-key" data-key="y">y</button>
                    <button class="vk-key" data-key="u">u</button>
                    <button class="vk-key" data-key="i">i</button>
                    <button class="vk-key" data-key="o">o</button>
                    <button class="vk-key" data-key="p">p</button>
                </div>

                <div class="vk-row" id="vk-row-2">
                    <button class="vk-key" data-key="a">a</button>
                    <button class="vk-key" data-key="s">s</button>
                    <button class="vk-key" data-key="d">d</button>
                    <button class="vk-key" data-key="f">f</button>
                    <button class="vk-key" data-key="g">g</button>
                    <button class="vk-key" data-key="h">h</button>
                    <button class="vk-key" data-key="j">j</button>
                    <button class="vk-key" data-key="k">k</button>
                    <button class="vk-key" data-key="l">l</button>
                </div>

                <div class="vk-row" id="vk-row-3">
                    <button class="vk-key extra" data-action="shift" id="vk-shift">Shift</button>
                    <button class="vk-key" data-key="z">z</button>
                    <button class="vk-key" data-key="x">x</button>
                    <button class="vk-key" data-key="c">c</button>
                    <button class="vk-key" data-key="v">v</button>
                    <button class="vk-key" data-key="b">b</button>
                    <button class="vk-key" data-key="n">n</button>
                    <button class="vk-key" data-key="m">m</button>
                    <button class="vk-key extra" data-action="backspace"></button>
                </div>

                <div class="vk-row" id="vk-row-4">
                    <button class="vk-key wide" data-action="numbers" id="vk-numbers">123</button>
                    <button class="vk-key" data-key=",">,</button>
                    <button class="vk-key" data-key=".">.</button>
                    <button class="vk-key wide" data-action="space">Space</button>
                    <button class="vk-key" data-action="enter"></button>
                    <button class="vk-key" data-action="hide" id="vk-hide">Hide</button>
                </div>
            </div>

            <audio id="vk-sound" preload="auto">
                <source src="/Sounds/Scifi/ui-sounds-pack-3-11-359714.mp3" type="audio/mpeg" />
            </audio>
            </audio>

            <!-- ============================================================ -->
            <!-- JAVASCRIPT -->
            <!-- ============================================================ -->

            <script>
            // ============================================================
            // CONSTANTS & CONFIG
            // ============================================================
            const VK_CONFIG = {
                selector: 'input.Field, #Printed_Text, #Hash_Name, #Password, textarea.Field',
                soundVolume: 0.18,
                soundPoolSize: 4,
                repeatDelay: 350,
                repeatInterval: 80,
                touchPadding: 16
            };

            // ============================================================
            // NATIVE KEYBOARD BLOCKING
            // ============================================================
            (function() {
                const inputs = Array.from(document.querySelectorAll(VK_CONFIG.selector));
                if (!inputs.length) return;

                inputs.forEach(el => {
                    try {
                        el.setAttribute('inputmode', 'none');
                        el.readOnly = true;
                        el.setAttribute('aria-readonly', 'true');
                    } catch (e) {}

                    el.addEventListener('touchstart', (ev) => {
                        ev.preventDefault();
                        try { el.focus(); } catch(e) {}
                    }, { passive: false });

                    el.addEventListener('mousedown', () => {
                        try { el.focus(); } catch(e) {}
                    });
                });

                window._nativeKeyboardControl = {
                    disable() {
                        document.querySelectorAll(VK_CONFIG.selector).forEach(el => {
                            try { 
                                el.setAttribute('inputmode','none'); 
                                el.readOnly = true; 
                                el.setAttribute('aria-readonly','true'); 
                            } catch(e){}
                        });
                    },
                    enable() {
                        document.querySelectorAll(VK_CONFIG.selector).forEach(el => {
                            try { 
                                el.removeAttribute('inputmode'); 
                                el.readOnly = false; 
                                el.removeAttribute('aria-readonly'); 
                            } catch(e){}
                        });
                    }
                };
            })();

            // ============================================================
            // CORE KEYBOARD FUNCTIONALITY
            // ============================================================
            (function() {
                const keyboard = document.getElementById('VirtualKeyboard');
                const keys = keyboard.querySelectorAll('.vk-key');
                
                let shift = false;
                let numbersMode = false;
                let activeInput = null;

                // Initialize base keys
                keyboard.querySelectorAll('.vk-key[data-key]').forEach(btn => {
                    const k = btn.getAttribute('data-key') || '';
                    if (!btn.dataset.base) btn.dataset.base = k.toLowerCase();
                });

                // --------------------------------------------------------
                // Helper Functions
                // --------------------------------------------------------
                function dispatchInput(el) {
                    try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
                }

                function insertAtCursor(el, text) {
                    if (!el) return;
                    if (typeof el.selectionStart === 'number') {
                        const start = el.selectionStart;
                        const end = el.selectionEnd;
                        const value = el.value || '';
                        el.value = value.slice(0, start) + text + value.slice(end);
                        const pos = start + text.length;
                        el.selectionStart = el.selectionEnd = pos;
                        dispatchInput(el);
                    } else {
                        el.value = (el.value || '') + text;
                        dispatchInput(el);
                    }
                    try { el.focus(); } catch(e){}
                }

                function performBackspace(el) {
                    if (!el) return;
                    if (typeof el.selectionStart === 'number') {
                        const start = el.selectionStart;
                        const end = el.selectionEnd;
                        if (start === end && start > 0) {
                            const value = el.value || '';
                            el.value = value.slice(0, start - 1) + value.slice(end);
                            el.selectionStart = el.selectionEnd = start - 1;
                        } else if (start !== end) {
                            const value = el.value || '';
                            el.value = value.slice(0, start) + value.slice(end);
                            el.selectionStart = el.selectionEnd = start;
                        }
                        dispatchInput(el);
                    } else {
                        el.value = (el.value || '').slice(0, -1);
                        dispatchInput(el);
                    }
                    try { el.focus(); } catch(e){}
                }

                function toggleShift() {
                    shift = !shift;
                    updateKeys();
                    document.getElementById('vk-shift').style.background = shift ? 'rgba(255,255,255,0.06)' : '';
                }

                function toggleNumbers() {
                    numbersMode = !numbersMode;
                    if (numbersMode) shift = false;
                    updateKeys();
                    document.getElementById('vk-numbers').textContent = numbersMode ? 'ABC' : '123';
                }

                function updateKeys() {
                    const letterButtons = keyboard.querySelectorAll('.vk-key[data-key]');
                    const numberMap = {
                        'q':'1','w':'2','e':'3','r':'4','t':'5','y':'6','u':'7','i':'8','o':'9','p':'0',
                        'a':'@','s':'_','d':'-','f':'/','g':':','h':';','j':'(', 'k':')','l':'$',
                        'z':'&','x':'*','c':'"','v':'\'','b':'%','n':'+','m':'='
                    };

                    letterButtons.forEach(btn => {
                        const base = (btn.dataset.base || btn.getAttribute('data-key') || '').toLowerCase();
                        if (!base) return;

                        if (!numbersMode) {
                            const display = shift ? base.toUpperCase() : base.toLowerCase();
                            btn.textContent = display;
                            btn.setAttribute('data-key', display);
                        } else {
                            const display = numberMap[base] || base;
                            btn.textContent = display;
                            btn.setAttribute('data-key', display);
                        }
                    });
                }

                updateKeys();

                // --------------------------------------------------------
                // Event Listeners
                // --------------------------------------------------------
                document.addEventListener('focusin', (e) => {
                    if (e.target && e.target.matches && e.target.matches(VK_CONFIG.selector)) {
                        activeInput = e.target;
                        keyboard.style.display = 'block';
                        keyboard.setAttribute('aria-hidden','false');
                    }
                });

                keyboard.addEventListener('touchstart', (ev) => {
                    ev.preventDefault();
                }, { passive: false });

                keyboard.addEventListener('click', (e) => {
                    const btn = e.target.closest('.vk-key');
                    if (!btn) return;
                    const action = btn.getAttribute('data-action');
                    const key = btn.getAttribute('data-key');

                    if (!activeInput || !document.body.contains(activeInput)) {
                        activeInput = document.getElementById('Printed_Text') || document.querySelector('input.Field');
                    }

                    if (action === 'shift') {
                        toggleShift();
                        return;
                    }

                    if (action === 'numbers') {
                        toggleNumbers();
                        return;
                    }

                    if (action === 'backspace') {
                        performBackspace(activeInput);
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (action === 'space') {
                        insertAtCursor(activeInput, ' ');
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (action === 'enter') {
                        const goBtn = document.getElementById('Open_Verification_Window');
                        if (goBtn && (activeInput && activeInput.id === 'Printed_Text')) {
                            goBtn.click();
                        } else {
                            insertAtCursor(activeInput, '\n');
                        }
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (action === 'hide') {
                        keyboard.style.display = 'none';
                        keyboard.setAttribute('aria-hidden','true');
                        return;
                    }

                    if (key) {
                        insertAtCursor(activeInput, key);
                        if (shift && !numbersMode) {
                            shift = false;
                            updateKeys();
                            document.getElementById('vk-shift').style.background = '';
                        }
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }
                });

                document.addEventListener('click', (e) => {
                    const el = e.target;
                    if (el.closest && (el.closest(VK_CONFIG.selector) || el.closest('#VirtualKeyboard'))) return;
                    keyboard.style.display = 'none';
                    keyboard.setAttribute('aria-hidden','true');
                    activeInput = null;
                });

                // --------------------------------------------------------
                // Public API
                // --------------------------------------------------------
                window._virtualKeyboard = {
                    show() { 
                        keyboard.style.display = 'block'; 
                        keyboard.setAttribute('aria-hidden','false'); 
                    },
                    hide() { 
                        keyboard.style.display = 'none'; 
                        keyboard.setAttribute('aria-hidden','true'); 
                    },
                    toggle() { 
                        keyboard.style.display = (keyboard.style.display === 'none' || keyboard.style.display === '') ? 'block' : 'none'; 
                    }
                };
            })();

            // ============================================================
            // KEYBOARD ANIMATION
            // ============================================================
            (function() {
                const vk = document.getElementById('VirtualKeyboard');
                if (!vk) return;

                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                            const isVisible = window.getComputedStyle(vk).display !== 'none';
                            if (isVisible && !vk.classList.contains('vk-animating')) {
                                vk.classList.add('vk-animating');
                                setTimeout(() => vk.classList.remove('vk-animating'), 200);
                            }
                        }
                    });
                });

                observer.observe(vk, { attributes: true, attributeFilter: ['style'] });
            })();

            // ============================================================
            // SOUND EFFECTS
            // ============================================================
            (function() {
                const soundTemplate = document.getElementById('vk-sound');
                if (!soundTemplate) return;

                const pool = [];
                for (let i = 0; i < VK_CONFIG.soundPoolSize; i++) {
                    const a = soundTemplate.cloneNode(true);
                    a.volume = VK_CONFIG.soundVolume;
                    pool.push(a);
                }
                let idx = 0;

                const keyboard = document.getElementById('VirtualKeyboard');
                if (!keyboard) return;

                keyboard.addEventListener('click', (e) => {
                    const key = e.target.closest('.vk-key');
                    if (!key || key.getAttribute('data-action') === 'hide') return;

                    const audio = pool[idx];
                    idx = (idx + 1) % VK_CONFIG.soundPoolSize;
                    try {
                        audio.currentTime = 0;
                        audio.play().catch(()=>{});
                    } catch (err) {}
                });
            })();

            // ============================================================
            // TOUCH INTERACTIONS
            // ============================================================
            (function() {
                const keyboard = document.getElementById('VirtualKeyboard');
                if (!keyboard) return;

                let activeKey = null;
                let repeatTimeout = null;
                let repeatInterval = null;
                let repeatStarted = false;

                function clearRepeat() {
                    if (repeatTimeout) { clearTimeout(repeatTimeout); repeatTimeout = null; }
                    if (repeatInterval) { clearInterval(repeatInterval); repeatInterval = null; }
                    repeatStarted = false;
                }

                keyboard.addEventListener('pointerdown', (ev) => {
                    const btn = ev.target.closest('.vk-key');
                    if (!btn) return;
                    ev.preventDefault();

                    activeKey = btn;
                    btn.classList.add('active');
                    try { btn.setPointerCapture && btn.setPointerCapture(ev.pointerId); } catch(e){}

                    if (btn.getAttribute('data-action') === 'backspace') {
                        repeatTimeout = setTimeout(() => {
                            repeatStarted = true;
                            repeatInterval = setInterval(() => {
                                btn.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true }));
                            }, VK_CONFIG.repeatInterval);
                        }, VK_CONFIG.repeatDelay);
                    }
                }, { passive: false });

                function endPointerInteraction(ev, cancel) {
                    if (!activeKey) return;
                    try { activeKey.releasePointerCapture && activeKey.releasePointerCapture(ev && ev.pointerId); } catch(e){}
                    activeKey.classList.remove('active');

                    if (!repeatStarted && !cancel) {
                        if (ev && typeof ev.clientX === 'number' && typeof ev.clientY === 'number') {
                            const under = document.elementFromPoint(ev.clientX, ev.clientY);
                            if (!under || !under.closest || !under.closest('.vk-key')) {
                                clearRepeat();
                                activeKey = null;
                                return;
                            }
                        }
                        activeKey.dispatchEvent(new MouseEvent('click', { bubbles: true, cancelable: true }));
                    }

                    clearRepeat();
                    activeKey = null;
                }

                keyboard.addEventListener('pointerup', (ev) => endPointerInteraction(ev, false));
                keyboard.addEventListener('pointercancel', (ev) => endPointerInteraction(ev, true));

                keyboard.addEventListener('pointermove', (ev) => {
                    if (!activeKey) return;
                    const rect = activeKey.getBoundingClientRect();
                    const pad = VK_CONFIG.touchPadding;
                    if (ev.clientX < rect.left - pad || ev.clientX > rect.right + pad || 
                        ev.clientY < rect.top - pad || ev.clientY > rect.bottom + pad) {
                        activeKey.classList.remove('active');
                        clearRepeat();
                    } else {
                        activeKey.classList.add('active');
                    }
                });

                keyboard.addEventListener('contextmenu', (e) => e.preventDefault());
            })();

            // ============================================================
            // HARDWARE KEYBOARD SUPPORT
            // ============================================================
            (function() {
                let activeInput = null;

                document.addEventListener('focusin', (e) => {
                    if (e.target && e.target.matches && e.target.matches(VK_CONFIG.selector)) {
                        activeInput = e.target;
                    }
                });

                function insertAtCursor(el, text) {
                    if (!el) return;
                    if (typeof el.selectionStart === 'number') {
                        const start = el.selectionStart;
                        const end = el.selectionEnd;
                        const value = el.value || '';
                        el.value = value.slice(0, start) + text + value.slice(end);
                        const pos = start + text.length;
                        el.selectionStart = el.selectionEnd = pos;
                        try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
                    } else {
                        el.value = (el.value || '') + text;
                        try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
                    }
                    try { el.focus(); } catch(e){}
                }

                function performBackspace(el) {
                    if (!el) return;
                    if (typeof el.selectionStart === 'number') {
                        const start = el.selectionStart;
                        const end = el.selectionEnd;
                        if (start === end && start > 0) {
                            const value = el.value || '';
                            el.value = value.slice(0, start - 1) + value.slice(end);
                            el.selectionStart = el.selectionEnd = start - 1;
                        } else if (start !== end) {
                            const value = el.value || '';
                            el.value = value.slice(0, start) + value.slice(end);
                            el.selectionStart = el.selectionEnd = start;
                        }
                        try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
                    } else {
                        el.value = (el.value || '').slice(0, -1);
                        try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
                    }
                    try { el.focus(); } catch(e){}
                }

                document.addEventListener('keydown', (ev) => {
                    if (!activeInput) return;
                    if (ev.metaKey || ev.ctrlKey || ev.altKey) return;

                    if (ev.key.length === 1) {
                        ev.preventDefault();
                        insertAtCursor(activeInput, ev.key);
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (ev.key === 'Backspace') {
                        ev.preventDefault();
                        performBackspace(activeInput);
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (ev.key === 'Enter') {
                        ev.preventDefault();
                        const goBtn = document.getElementById('Open_Verification_Window');
                        if (goBtn && activeInput && activeInput.id === 'Printed_Text') {
                            goBtn.click();
                        } else {
                            insertAtCursor(activeInput, '\n');
                        }
                        try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                        return;
                    }

                    if (ev.key === 'ArrowLeft') {
                        try {
                            const pos = activeInput.selectionStart || 0;
                            activeInput.selectionStart = activeInput.selectionEnd = Math.max(0, pos - 1);
                        } catch(e){}
                        return;
                    }

                    if (ev.key === 'ArrowRight') {
                        try {
                            const pos = activeInput.selectionStart || 0;
                            activeInput.selectionStart = activeInput.selectionEnd = Math.min((activeInput.value || '').length, pos + 1);
                        } catch(e){}
                        return;
                    }
                });
            })();

            // ============================================================
            // INITIALIZATION
            // ============================================================
            (function() {
                document.addEventListener('DOMContentLoaded', () => {
                    const vk = document.getElementById('VirtualKeyboard');
                    if (!vk) return;

                    vk.style.display = 'none';
                    vk.setAttribute('aria-hidden', 'true');

                    const primary = document.getElementById('Printed_Text') || document.querySelector('input.Field');
                    if (primary) {
                        setTimeout(() => {
                            try { primary.focus(); } catch(e){}
                        }, 120);
                    }

                    const openVerBtn = document.getElementById('Open_Verification_Window');
                    if (openVerBtn) {
                        openVerBtn.addEventListener('click', () => {
                            vk.style.display = 'none';
                            vk.setAttribute('aria-hidden','true');
                        });
                    }

                    window.addEventListener('resize', () => {
                        const af = document.activeElement;
                        if (af && af.matches && af.matches(VK_CONFIG.selector)) {
                            vk.style.display = 'block';
                            vk.setAttribute('aria-hidden', 'false');
                        }
                    });

                    window.activateVirtualKeyboardFor = (el) => {
                        if (!el) return;
                        try { el.focus(); } catch (e) {}
                        vk.style.display = 'block';
                        vk.setAttribute('aria-hidden', 'false');
                    };

                    window.deactivateVirtualKeyboard = () => {
                        vk.style.display = 'none';
                        vk.setAttribute('aria-hidden', 'true');
                    };
                });
            })();

    // ============================================================================
    // NATIVE KEYBOARD CONTROL
    // ============================================================================

    (function() {
        const selector = 'input.Field, #Printed_Text, #Hash_Name, #Password, textarea.Field';
        const inputs = Array.from(document.querySelectorAll(selector));
        if (!inputs.length) return;

        inputs.forEach(el => {
            try {
                el.setAttribute('inputmode', 'none');
                el.readOnly = true;
                el.setAttribute('aria-readonly', 'true');
            } catch (e) {}

            el.addEventListener('touchstart', (ev) => {
                ev.preventDefault();
                try { el.focus(); } catch(e) {}
            }, { passive: false });

            el.addEventListener('mousedown', () => {
                try { el.focus(); } catch(e) {}
            });
        });

        window._nativeKeyboardControl = {
            disable() {
                document.querySelectorAll(selector).forEach(el => {
                    try { 
                        el.setAttribute('inputmode','none'); 
                        el.readOnly = true; 
                        el.setAttribute('aria-readonly','true'); 
                    } catch(e){}
                });
            },
            enable() {
                document.querySelectorAll(selector).forEach(el => {
                    try { 
                        el.removeAttribute('inputmode'); 
                        el.readOnly = false; 
                        el.removeAttribute('aria-readonly'); 
                    } catch(e){}
                });
            }
        };
    })();

    // ============================================================================
    // VIRTUAL KEYBOARD - CORE FUNCTIONALITY
    // ============================================================================

    (function() {
        const selector = 'input.Field, #Printed_Text, #Hash_Name, #Password, textarea.Field';
        const keyboard = document.getElementById('VirtualKeyboard');
        if (!keyboard) return;

        let activeInput = null;
        keyboard.setAttribute('aria-hidden','true');
        keyboard.style.display = 'none';

        // Helper functions
        function dispatchInput(el) {
            try { el.dispatchEvent(new Event('input', { bubbles: true })); } catch(e){}
        }

        function insertAtCursor(el, text) {
            if (!el) return;
            if (typeof el.selectionStart === 'number') {
                const start = el.selectionStart;
                const end = el.selectionEnd;
                const value = el.value || '';
                el.value = value.slice(0, start) + text + value.slice(end);
                const pos = start + text.length;
                el.selectionStart = el.selectionEnd = pos;
                dispatchInput(el);
            } else {
                el.value = (el.value || '') + text;
                dispatchInput(el);
            }
            try { el.focus(); } catch(e){}
        }

        function performBackspace(el) {
            if (!el) return;
            if (typeof el.selectionStart === 'number') {
                const start = el.selectionStart;
                const end = el.selectionEnd;
                if (start === end && start > 0) {
                    const value = el.value || '';
                    el.value = value.slice(0, start - 1) + value.slice(end);
                    el.selectionStart = el.selectionEnd = start - 1;
                } else if (start !== end) {
                    const value = el.value || '';
                    el.value = value.slice(0, start) + value.slice(end);
                    el.selectionStart = el.selectionEnd = start;
                }
                dispatchInput(el);
            } else {
                el.value = (el.value || '').slice(0, -1);
                dispatchInput(el);
            }
            try { el.focus(); } catch(e){}
        }

        function showKeyboardFor(el) {
            if (!el) return;
            activeInput = el;
            try { el.focus(); } catch(e){}
            keyboard.style.display = 'block';
            keyboard.setAttribute('aria-hidden','false');
        }

        function hideKeyboard() {
            keyboard.style.display = 'none';
            keyboard.setAttribute('aria-hidden','true');
            activeInput = null;
        }

        // Input preparation
        function prepareInputs() {
            const els = Array.from(document.querySelectorAll(selector));
            els.forEach(el => {
                try {
                    el.setAttribute('inputmode', 'none');
                    el.readOnly = true;
                    el.setAttribute('aria-readonly','true');
                } catch(e){}

                el.addEventListener('touchstart', (ev) => {
                    ev.preventDefault();
                    try { el.focus(); } catch(e){}
                }, { passive: false });

                el.addEventListener('mousedown', (ev) => {
                    try { el.focus(); } catch(e){}
                });

                el.addEventListener('focus', () => {
                    activeInput = el;
                    keyboard.style.display = 'block';
                    keyboard.setAttribute('aria-hidden','false');
                    try {
                        const len = (el.value || '').length;
                        el.selectionStart = el.selectionEnd = len;
                    } catch(e){}
                });

                el.addEventListener('blur', () => {
                    setTimeout(() => {
                        const af = document.activeElement;
                        if (!af) { hideKeyboard(); return; }
                        if (af.closest && (af.closest(selector) || af.closest('#VirtualKeyboard'))) return;
                        hideKeyboard();
                    }, 50);
                });
            });
        }

        // Event handlers
        document.addEventListener('click', (e) => {
            const el = e.target;
            if (el.closest && (el.closest(selector) || el.closest('#VirtualKeyboard'))) return;
            hideKeyboard();
        });

        document.addEventListener('touchstart', (e) => {
            const el = e.target;
            if (el.closest && (el.closest(selector) || el.closest('#VirtualKeyboard'))) return;
            setTimeout(hideKeyboard, 50);
        }, { passive: true });

        // Hardware keyboard support
        document.addEventListener('keydown', (ev) => {
            if (!activeInput) return;
            if (ev.metaKey || ev.ctrlKey || ev.altKey) return;

            if (ev.key.length === 1) {
                ev.preventDefault();
                insertAtCursor(activeInput, ev.key);
                try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                return;
            }

            if (ev.key === 'Backspace') {
                ev.preventDefault();
                performBackspace(activeInput);
                try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                return;
            }

            if (ev.key === 'Enter') {
                ev.preventDefault();
                const goBtn = document.getElementById('Open_Verification_Window');
                if (goBtn && activeInput && activeInput.id === 'Printed_Text') {
                    goBtn.click();
                } else {
                    insertAtCursor(activeInput, '\n');
                }
                try { if (typeof updateSHAField === 'function') updateSHAField(); } catch(e){}
                return;
            }

            if (ev.key === 'ArrowLeft') {
                try {
                    const pos = activeInput.selectionStart || 0;
                    activeInput.selectionStart = activeInput.selectionEnd = Math.max(0, pos - 1);
                } catch(e){}
                return;
            }

            if (ev.key === 'ArrowRight') {
                try {
                    const pos = activeInput.selectionStart || 0;
                    activeInput.selectionStart = activeInput.selectionEnd = Math.min((activeInput.value || '').length, pos + 1);
                } catch(e){}
                return;
            }
        });

        // Mutation observer for dynamic inputs
        const mo = new MutationObserver(() => prepareInputs());
        mo.observe(document.body, { childList: true, subtree: true });

        prepareInputs();

        // Public API
        window._virtualKeyboard = {
            showFor(el) { showKeyboardFor(el || document.querySelector(selector)); },
            show() { keyboard.style.display = 'block'; keyboard.setAttribute('aria-hidden','false'); },
            hide() { hideKeyboard(); },
            toggle() { keyboard.style.display = (keyboard.style.display === 'none' || keyboard.style.display === '') ? 'block' : 'none'; }
        };
    })();
    </script>
</div>







<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="CSS/UI.css">

    <style>
        body {
            background-color: rgb(43, 43, 43);
            overflow: hidden;
            width: 100dvw;
            height: 100dvh;
            display: flex;
            justify-content: center;
        }

        /* ============================================================================ */
        /* HOME MAIN */
        /* ============================================================================ */

        .Top_Bar {
            position: absolute;
            top: 10px;
            width: calc(100% - 20px);
            height: 30px;
            background-color: var(--UI-Buttons-Fields-Color-1);
            backdrop-filter: var(--Back_drop);
            border-radius: var(--Border-Radius);
            z-index: 1;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            text-indent: 10px;
            display: none;
        }

        .Top_Bar > p {
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_1);
        }
        
        .Top_Bar > .Close {
            position: absolute;
            right: 10px;
        }

        .Display_Top_Menu_Button {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .Clock {
            position: absolute;
            top: 70px;
            right: 10px;
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_2);
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        .Side_Bar {
            position: absolute;
            left: 10px;
            top: 250px;
            width: 30px;
            height: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

    </style>
</head>
<body>
    
    <!-- ============================================================================ -->
    <!-- SOUND PROFILE -->
    <!-- ============================================================================ -->

    <audio src="/Sounds/Audio/Morning_Signal.mp3"></audio>
    <audio src="/Sounds/Audio/mixkit-digital-clock-digital-alarm-buzzer-992.wav"></audio>
    <audio src="/Sounds/Audio/mixkit-warning-alarm-buzzer-991.wav"></audio>

    <!-- ============================================================================ -->
    <!-- TOP BAR -->
    <!-- ============================================================================ -->

    <div class="Display_Top_Menu_Button" style="position: absolute; top: 10px; left: 10px;">
        <button class="Icon_Button" id="Top_Menu_Button"><img src="/Images/Icons/apps_24dp_1F1F1F.svg"></button>
    </div>

    <div class="Top_Bar">
        <p>Apps</p>
        <p>Government</p>
        <p>Market</p>
        <p>Jobs</p>
        <p>Military</p>
        <p>More</p>
        <div class="Close">
            <button class="Close_Button"></button>
        </div>
    </div>


    <script id="Top_Bar Script">

        // Display Top Bar when Top Menu Button is clicked
        document.getElementById('Top_Menu_Button').addEventListener('click', function() {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            topBar.style.display = 'flex';
            topBar.style.transform = 'scaleX(0)';
            topBar.style.opacity = '0';
            topBar.style.transformOrigin = 'left';
            topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
            
            setTimeout(() => {
                topBar.style.transform = 'scaleX(1)';
                topBar.style.opacity = '1';
                topMenuButton.style.display = 'none';
            }, 10);
        });

        // Hide Top Bar when Close Button is clicked
        document.querySelector('.Close_Button').addEventListener('click', function() {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
            topBar.style.transform = 'scaleX(0)';
            topBar.style.opacity = '0';
            
            setTimeout(() => {
                topBar.style.display = 'none';
                topMenuButton.style.display = 'flex';
            }, 300);
        });

        // Close Top Bar when clicking outside
        document.addEventListener('click', function(event) {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            // Check if click is outside top bar and top menu button
            if (!topBar.contains(event.target) && !topMenuButton.contains(event.target)) {
            if (topBar.style.display === 'flex') {
                topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
                topBar.style.transform = 'scaleX(0)';
                topBar.style.opacity = '0';
                
                setTimeout(() => {
                topBar.style.display = 'none';
                topMenuButton.style.display = 'flex';
                }, 300);
            }
            }
        });
    </script>

    <!-- ============================================================================ -->
    <!-- SETTINGS BUTTON -->
    <!-- ============================================================================ -->

    <div class="Display_Settings_Button" style="position: absolute; top: 10px; right: 10px;">
        <button class="Icon_Button" id="Settings_Button"><img src="/Images/Icons/settings_24dp_1F1F1F.svg"></button>
    </div>

    <!-- SETTINGS DROPDOWN MENU -->
    <style>
        .Settings_Dropdown {
            position: absolute;
            top: 50px;
            right: 10px;
            width: 180px;
            background: var(--UI-Buttons-Fields-Color-1);
            backdrop-filter: var(--Back_drop);
            border-radius: var(--Border-Radius);
            box-shadow: 0 6px 18px rgba(0,0,0,.45);
            display: none;
            flex-direction: column;
            padding: 6px 0;
            transform: scale(.85);
            transform-origin: top right;
            opacity: 0;
            transition: transform .25s cubic-bezier(0,1,0,1), opacity .25s cubic-bezier(0,1,0,1);
            z-index: 999;
        }
        .Settings_Dropdown.open {
            display: flex;
            transform: scale(1);
            opacity: 1;
        }
        .Settings_Dropdown button {
            width: 100%;
            background: none;
            border: none;
            text-align: left;
            padding: 8px 14px;
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_1);
            cursor: pointer;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .Settings_Dropdown button:hover,
        .Settings_Dropdown button:focus {
            background: var(--UI-Buttons-Fields-Color-2);
            outline: none;
        }
        .Settings_Dropdown hr {
            border: none;
            height: 1px;
            background: rgba(255,255,255,.08);
            margin: 4px 0;
        }
    </style>

    <div class="Settings_Dropdown" id="Settings_Menu" role="menu" aria-label="Settings Menu">
        <button role="menuitem" data-action="profile">Profile</button>
        <button role="menuitem" data-action="preferences">Preferences</button>
        <button id="Open_Themes_Market" role="menuitem" data-action="themes">Theme Market</button>
        <hr>
        <button role="menuitem" data-action="help">Help</button>
        <button role="menuitem" data-action="about">About</button>
        <hr>
        <button role="menuitem" data-action="logout">Logout</button>
    </div>

    <script>
    (function(){
        const btn = document.getElementById('Settings_Button');
        const menu = document.getElementById('Settings_Menu');
        let closeTimeout = null;

        function openMenu() {
            menu.classList.add('open');
            btn.setAttribute('aria-expanded','true');
            setTimeout(()=> {
                const first = menu.querySelector('button');
                first && first.focus();
            },10);
        }

        function closeMenu() {
            if (!menu.classList.contains('open')) return;
            menu.classList.remove('open');
            btn.setAttribute('aria-expanded','false');
            closeTimeout = setTimeout(()=> { if(!menu.classList.contains('open')) menu.style.display='none'; },250);
        }

        btn.setAttribute('aria-haspopup','true');
        btn.setAttribute('aria-expanded','false');

        btn.addEventListener('click', e => {
            e.stopPropagation();
            if (closeTimeout) { clearTimeout(closeTimeout); closeTimeout=null; }
            if (!menu.classList.contains('open')) {
                menu.style.display='flex';
                requestAnimationFrame(openMenu);
            } else {
                closeMenu();
            }
        });

        document.addEventListener('click', e => {
            if (!menu.contains(e.target) && e.target !== btn) closeMenu();
        });

        document.addEventListener('keydown', e => {
            if (!menu.classList.contains('open')) return;
            const items = Array.from(menu.querySelectorAll('button'));
            const idx = items.indexOf(document.activeElement);
            if (e.key === 'Escape') {
                closeMenu();
                btn.focus();
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                const next = items[(idx + 1) % items.length];
                next && next.focus();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                const prev = items[(idx - 1 + items.length) % items.length];
                prev && prev.focus();
            } else if (e.key === 'Home') {
                e.preventDefault();
                items[0] && items[0].focus();
            } else if (e.key === 'End') {
                e.preventDefault();
                items[items.length-1] && items[items.length-1].focus();
            }
        });

        menu.addEventListener('click', e => {
            const btnItem = e.target.closest('button[data-action]');
            if (!btnItem) return;
            const action = btnItem.getAttribute('data-action');
            // Placeholder handlers
            switch(action){
                case 'profile': console.log('Open profile'); break;
                case 'preferences': console.log('Open preferences'); break;
                case 'theme': console.log('Open theme'); break;
                case 'help': console.log('Open help'); break;
                case 'about': console.log('Open about'); break;
                case 'logout': console.log('Logout'); break;
            }
            closeMenu();
        });
    })();
    </script>

    <!-- ============================================================================ -->
    <!-- THEMES MARKET -->
    <!-- ============================================================================ -->

    <div class="Theme_Market">
        <div class="Window" id="Theme_Market_Window" style="display: none;">
            <div class="Window_Header">
                <p class="Title">Theme Market</p>
                <button class="Close_Button"></button>
            </div>
            <div class="Content">
                <div class="Title">
                    <p class="Theme_Market_Title" style="font-size: var(--Main_Text_5); color: var(--Main_Text_Color_1);">Theme Market</p>
                    <p class="Theme_Market_Title" style="font-size: var(--Main_Text_1); color: var(--Main_Text_Color_1);">An open source theme repository</p>
                </div>
                <div class="Theme_Count">
                    <p class="Theme_Count">2 Themes on the market</p>
                </div>
                <div class="Top_Themes">
                    <div class="Theme_Container">
                        <p class="Theme_Name">Light Mode</p>
                        <div class="Color_Pallet">
                            <span class="Color" style="background-color: #ffffff;"></span>
                            <span class="Color" style="background-color: #f5f5f5;"></span>
                            <span class="Color" style="background-color: #e0e0e0;"></span>
                            <span class="Color" style="background-color: #d0d0d0;"></span>
                            <span class="Color" style="background-color: #b0b0b0;"></span>
                        </div>
                        <button class="Intall_Theme">View</button>
                    </div>
                </div>
                <div class="Create_Raw_File_Search">
                    <button class="Create_Theme_File_Button" id="Open_Create_Theme_File_Window">Create theme file</button>
                    <button class="Theme_Search" id="Open_ThemeSearch_Window">Search theme</button>
                </div>

                <div class="Theme_Market_Content">
                    <div class="Catagory_List">
                        <span>Light Themes</span>
                        <span>Dark Themes</span>
                        <span>Colorful Themes</span>
                        <span>Minimal Themes</span>
                        <span>High Contrast</span>
                        <span>Pastel Themes</span>
                        <span>Neon Themes</span>
                        <span>Nature Themes</span>
                        <span>Retro Themes</span>
                    </div>
                    <!-- Category Windows -->
                    <div class="Theme_Catagory_Windows" style="width:100%;height:100%;position:relative;">
                        <div class="Theme_Library_Catagory" data-catagory="Light Themes" style="display:block; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Light Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Dark Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Dark Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Colorful Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Colorful Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Minimal Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Minimal Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="High Contrast" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- High Contrast Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Pastel Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Pastel Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Neon Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Neon Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Nature Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;">
                            <!-- Nature Themes go here -->
                        </div>
                        <div class="Theme_Library_Catagory" data-catagory="Retro Themes" style="display:none; position:absolute; top:0; left:0; width:100%; height:100%;"></div>
                            <!-- Retro Themes go here -->
                        </div>
                    </div>
                    <script>
                        // Category switching logic
                        (function() {
                            const catList = document.querySelectorAll('#Theme_Market_Window .Catagory_List span');
                            const catWindows = document.querySelectorAll('#Theme_Market_Window .Theme_Library_Catagory');
                            catList.forEach(span => {
                                span.addEventListener('click', function() {
                                    const cat = span.textContent.replace(/^\[|\]$/g, '').trim();
                                    catWindows.forEach(win => {
                                        win.style.display = (win.getAttribute('data-catagory') === cat) ? 'block' : 'none';
                                    });
                                });
                            });
                        })();
                    </script>
                    <div class="Theme_Library">
                        <div class="Theme_Container">
                            <p class="Theme_Name">Light Mode</p>
                            <div class="Color_Pallet">
                                <span class="Color" style="background-color: #ffffff;"></span>
                                <span class="Color" style="background-color: #f5f5f5;"></span>
                                <span class="Color" style="background-color: #e0e0e0;"></span>
                                <span class="Color" style="background-color: #d0d0d0;"></span>
                                <span class="Color" style="background-color: #b0b0b0;"></span>
                            </div>
                            <button class="Install_Theme">Install</button>
                        </div>   
                    </div>
                </div>
                <div class="Window" id="Create_Theme_File_Window" style="width:320px; height:480px; display: none;">
                    <div class="Window_Header">
                        <p class="Title">Theme Creator</p>
                        <button class="Close_Button"></button>
                    </div>
                    <div class="Content">
                        <p class="Title" style=" font-size: var(--Main_Text);">Theme Creator</p>
                        <a class="Creator_Account" href="" style=" font-size: var(--Main_Text);">Account: John Doe</a>
                        
                        <div class="Name_Of_Theme">
                            <input type="text" placeholder="Theme name">
                        </div>
                        <div class="Theme_Parameters">
                            <div class="UI_Parameters">
                                <p class="Title" style="font-size: var(--Main_Text); color: var(--Main_Text_Color_1);">UI</p>
                                <div class="Color_Parameter">
                                    <label for="Main_UI" id="Color_Main_UI" style="font-size: var(--Main_Text); color: var(--Main_Text_Color_1);">Main UI 1:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Main_UI-1" name="Main_UI" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Main_UI" id="Color_Main_UI" style="font-size: var(--Main_Text);">Main UI 2:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Main_UI-2" name="Main_UI" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Windows" id="Color_Windows" style="font-size: var(--Main_Text);">Windows:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Windows" name="Windows" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Headers" id="Color_Headers" style="font-size: var(--Main_Text);">Headers:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Headers" name="Headers" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Background" id="Color_Background" style="font-size: var(--Main_Text);">Background:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Background" name="Background" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Text_Color" id="Color_Text_Color" style="font-size: var(--Main_Text);">Text Color:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Text_Color" name="Text_Color" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Brackets" id="Color_Brackets" style="font-size: var(--Main_Text);">Brackets:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Brackets" name="Brackets" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Sliders" id="Color_Sliders" style="font-size: var(--Main_Text);">Sliders:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Sliders" name="Sliders" value="#ffffff">
                                </div>
                            </div>
                            <div class="Keyboard_Parameters">
                                <p class="Title" style="font-size: var(--Main_Text); color: var(--Main_Text_Color_1);">Keyboard</p>
                                <div class="Color_Parameter">
                                    <label for="Keyboard" id="Color_Keyboard" style="font-size: var(--Main_Text);">Keyboard:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Keyboard" name="Keyboard" value="#ffffff">
                                </div>
                                <div class="Color_Parameter">
                                    <label for="Keys" id="Color_Keys" style="font-size: var(--Main_Text);">Keys:</label>
                                    <input type="color" class="Color_Parameter_setting" id="Color_Parameter_Keys" name="Keys" value="#ffffff">
                                </div>
                                <div class="Font_Size">
                                    <label for="Font_Size" id="Font_Size" style="color: var(--Main_Text_Color_1);">Font Size:</label>
                                    <input type="number" class="Font_Size_setting" id="Font_Size_Parameter" name="Font_Size" value="9">
                                </div>
                            </div>
                        </div>
                        <div class="Save_Theme">
                            <button class="Save_Theme_Button" style="background-color: var(--UI-Buttons-Fields-Color-2);">Save Theme</button>
                        </div>
                    </div>
                </div>

                <div class="Window" id="Parameter_Color_Picker" style="width:320px; height:200px; display: none;">
                    <div class="Window_Header">
                        <p class="Title">Window  with header</p>
                        <button class="Close_Button"></button>
                    </div>
                    <div class="Content">
                        <div style="padding: 12px; display: flex; flex-direction: column; gap: 10px; width: 100%; box-sizing: border-box;">
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div id="cp-preview" style="width: 30px; height: 30px; background: #ffffff;"></div>
                                <input id="cp-hex" type="text" inputmode="none" aria-label="Hex color" style="flex: 1; height: 30px; color: var(--Main_Text_Color_1);">
                            </div>

                            <div style="display: flex; gap: 10px; align-items: center;">
                                <canvas id="cp-wheel" width="200" height="200" style="width: 100px; height: 100px;"></canvas>
                                <div style="display: flex; flex-direction: column; gap: 10px; flex: 1;">
                                    <div style="display: flex; flex-direction: column;">
                                        <label style="font-size: var(--Main_Text); color: var(--Main_Text_Color_2); padding-bottom: 10px;">Brightness</label>
                                        <input id="cp-v" type="range" min="0" max="100" value="100" style="width: 100%;">
                                    </div>
                                    <div style="position: absolute; bottom: 10px; width: calc(100% - 130px); display: flex; gap: 10px; align-items: center;">
                                        <button id="cp-apply" style="width: 100%; height: 30px; background: var(--UI-Buttons-Fields-Color-1); color: var(--Main_Text_Color_1); cursor: pointer;">Apply</button>
                                        <button id="cp-cancel" style="width: 100%; height: 30px; background: var(--UI-Buttons-Fields-Color-2);  color: var(--Main_Text_Color_1); cursor: pointer;">Cancel</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <script>
                        (function(){
                            const picker = document.getElementById('Parameter_Color_Picker');
                            if (!picker) return;

                            const canvas = picker.querySelector('#cp-wheel');
                            const preview = picker.querySelector('#cp-preview');
                            const hexInput = picker.querySelector('#cp-hex');
                            const vRange = picker.querySelector('#cp-v');
                            const applyBtn = picker.querySelector('#cp-apply');
                            const cancelBtn = picker.querySelector('#cp-cancel');
                            const closeBtn = picker.querySelector('.Close_Button');

                            let ctx = canvas.getContext('2d');
                            const W = canvas.width, H = canvas.height;
                            const cx = W/2, cy = H/2, radius = Math.min(W,H)/2 - 1;

                            // state in HSV
                            let hue = 0;      // 0..360
                            let sat = 0;      // 0..1
                            let val = 1;      // 0..1
                            let isPointerDown = false;
                            let targetInput = null;

                            function hsvToRgb(h,s,v){
                                const c = v * s;
                                const x = c * (1 - Math.abs(((h/60) % 2) - 1));
                                const m = v - c;
                                let r=0,g=0,b=0;
                                if (h < 60) { r=c; g=x; b=0; }
                                else if (h < 120) { r=x; g=c; b=0; }
                                else if (h < 180) { r=0; g=c; b=x; }
                                else if (h < 240) { r=0; g=x; b=c; }
                                else if (h < 300) { r=x; g=0; b=c; }
                                else { r=c; g=0; b=x; }
                                return { r: Math.round((r+m)*255), g: Math.round((g+m)*255), b: Math.round((b+m)*255) };
                            }

                            function rgbToHex(r,g,b){
                                return '#' + [r,g,b].map(n=>n.toString(16).padStart(2,'0')).join('');
                            }

                            function hexToRgb(hex){
                                hex = (hex||'').replace('#','').trim();
                                if (hex.length === 3) hex = hex.split('').map(c=>c+c).join('');
                                if (!/^[0-9a-f]{6}$/i.test(hex)) return null;
                                return { r: parseInt(hex.substr(0,2),16), g: parseInt(hex.substr(2,2),16), b: parseInt(hex.substr(4,2),16) };
                            }

                            // draw color wheel by iterating pixels (reasonable for 220x220)
                            function drawWheel(){
                                const img = ctx.createImageData(W, H);
                                const data = img.data;
                                for (let y=0; y<H; y++){
                                    for (let x=0; x<W; x++){
                                        const dx = x - cx, dy = y - cy;
                                        const d = Math.sqrt(dx*dx + dy*dy);
                                        const idx = (y*W + x)*4;
                                        if (d <= radius){
                                            // polar coords
                                            let a = Math.atan2(dy, dx); // -PI..PI
                                            let deg = (a * 180/Math.PI + 360) % 360;
                                            let rnorm = d / radius; // 0..1 => saturation
                                            const hv = hsvToRgb(deg, rnorm, 1);
                                            data[idx]   = hv.r;
                                            data[idx+1] = hv.g;
                                            data[idx+2] = hv.b;
                                            data[idx+3] = 255;
                                        } else {
                                            // transparent outside circle
                                            data[idx] = data[idx+1] = data[idx+2] = 0;
                                            data[idx+3] = 0;
                                        }
                                    }
                                }
                                ctx.putImageData(img, 0, 0);

                                // apply value (darken) overlay
                                if (val < 1){
                                    ctx.fillStyle = `rgba(0,0,0,${1 - val})`;
                                    ctx.beginPath();
                                    ctx.arc(cx, cy, radius, 0, Math.PI*2);
                                    ctx.fill();
                                }

                                // draw selector marker
                                const selX = cx + Math.cos(hue * Math.PI / 180) * (sat * radius);
                                const selY = cy + Math.sin(hue * Math.PI / 180) * (sat * radius);
                                ctx.strokeStyle = 'rgba(255,255,255,0.95)';
                                ctx.lineWidth = 2;
                                ctx.beginPath();
                                ctx.arc(selX, selY, 8, 0, Math.PI*2);
                                ctx.stroke();
                                ctx.strokeStyle = 'rgba(0,0,0,0.6)';
                                ctx.lineWidth = 1;
                                ctx.beginPath();
                                ctx.arc(selX, selY, 8, 0, Math.PI*2);
                                ctx.stroke();
                            }

                            function setUIFromHex(hex){
                                const rgb = hexToRgb(hex);
                                if (!rgb) return;
                                // convert rgb -> hsv
                                const r = rgb.r / 255, g = rgb.g / 255, b = rgb.b / 255;
                                const mx = Math.max(r,g,b), mn = Math.min(r,g,b);
                                const d = mx - mn;
                                let h = 0;
                                if (d === 0) h = 0;
                                else if (mx === r) h = ((g - b) / d) % 6;
                                else if (mx === g) h = (b - r) / d + 2;
                                else h = (r - g) / d + 4;
                                h = (h * 60 + 360) % 360;
                                const s = mx === 0 ? 0 : d / mx;
                                const v = mx;
                                hue = h;
                                sat = s;
                                val = v;
                                vRange.value = Math.round(val * 100);
                                hexInput.value = ('#' + hex.replace('#','')).toLowerCase();
                                preview.style.background = rgbToHex(Math.round(r*255), Math.round(g*255), Math.round(b*255));
                                drawWheel();
                            }

                            function updateFromHSV(applyToTarget){
                                const rgb = hsvToRgb(hue, sat, val);
                                const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
                                preview.style.background = hex;
                                hexInput.value = hex.toLowerCase();
                                if (applyToTarget && targetInput) {
                                    try {
                                        targetInput.value = hex;
                                        targetInput.dispatchEvent(new Event('input', { bubbles: true }));
                                    } catch(e){}
                                }
                            }

                            function getPointerHSVFromEvent(e){
                                const rect = canvas.getBoundingClientRect();
                                const clientX = (e.clientX !== undefined) ? e.clientX : (e.touches && e.touches[0] && e.touches[0].clientX);
                                const clientY = (e.clientY !== undefined) ? e.clientY : (e.touches && e.touches[0] && e.touches[0].clientY);
                                const x = clientX - rect.left;
                                const y = clientY - rect.top;
                                const dx = x - cx, dy = y - cy;
                                const d = Math.sqrt(dx*dx + dy*dy);
                                if (d > radius) return null;
                                let a = Math.atan2(dy, dx);
                                let deg = (a * 180/Math.PI + 360) % 360;
                                const s = Math.min(1, Math.max(0, d / radius));
                                return { h: deg, s };
                            }

                            // pointer handlers
                            function pointerDown(e){
                                isPointerDown = true;
                                const hv = getPointerHSVFromEvent(e);
                                if (!hv) return;
                                hue = hv.h;
                                sat = hv.s;
                                updateFromHSV(false);
                                drawWheel();
                                e.preventDefault();
                            }
                            function pointerMove(e){
                                if (!isPointerDown) return;
                                const hv = getPointerHSVFromEvent(e);
                                if (!hv) return;
                                hue = hv.h;
                                sat = hv.s;
                                updateFromHSV(false);
                                drawWheel();
                                e.preventDefault();
                            }
                            function pointerUp(e){
                                if (!isPointerDown) return;
                                isPointerDown = false;
                                updateFromHSV(true);
                                drawWheel();
                            }

                            canvas.addEventListener('pointerdown', pointerDown);
                            window.addEventListener('pointermove', pointerMove);
                            window.addEventListener('pointerup', pointerUp);
                            canvas.addEventListener('touchstart', pointerDown, {passive:false});
                            canvas.addEventListener('touchmove', pointerMove, {passive:false});
                            canvas.addEventListener('touchend', pointerUp);

                            vRange.addEventListener('input', () => {
                                val = Math.max(0, Math.min(1, vRange.value / 100));
                                updateFromHSV(false);
                                drawWheel();
                            });
                            vRange.addEventListener('change', () => {
                                val = Math.max(0, Math.min(1, vRange.value / 100));
                                updateFromHSV(true);
                                drawWheel();
                            });

                            hexInput.addEventListener('input', () => {
                                const valHex = hexInput.value.trim();
                                const rgb = hexToRgb(valHex);
                                if (rgb) {
                                    setUIFromHex('#' + valHex.replace('#',''));
                                }
                            });

                            applyBtn.addEventListener('click', () => {
                                updateFromHSV(true);
                                if (closeBtn) closeBtn.click();
                            });
                            cancelBtn.addEventListener('click', () => {
                                if (closeBtn) closeBtn.click();
                            });

                            hexInput.addEventListener('keydown', (e) => {
                                if (e.key === 'Enter') { e.preventDefault(); applyBtn.click(); }
                                if (e.key === 'Escape') { e.preventDefault(); if (closeBtn) closeBtn.click(); }
                            });

                            // Heuristic to find the input that triggered the picker based on picker position
                            function findTargetInputByPosition(){
                                const rect = picker.getBoundingClientRect();
                                const inputs = Array.from(document.querySelectorAll('.Color_Parameter_setting,input[type="color"].Color_Parameter_setting'));
                                let best = null; let bestScore = Infinity;
                                inputs.forEach(inp=>{
                                    try{
                                        const r = inp.getBoundingClientRect();
                                        const score = Math.abs(r.top - rect.top) + Math.abs(r.right - rect.left);
                                        if (score < bestScore) { bestScore = score; best = inp; }
                                    }catch(e){}
                                });
                                return best;
                            }

                            // Observe when picker becomes visible so we can initialize for the correct input
                            const obs = new MutationObserver(() => {
                                const visible = getComputedStyle(picker).display !== 'none';
                                if (visible) {
                                    setTimeout(() => {
                                        targetInput = findTargetInputByPosition();
                                        const initial = (targetInput && targetInput.value) ? String(targetInput.value).trim() : '#ffffff';
                                        const hex = initial.startsWith('#') ? initial : ('#'+initial);
                                        const rgb = hexToRgb(hex);
                                        if (rgb) {
                                            setUIFromHex(hex);
                                        } else {
                                            // default
                                            hue = 0; sat = 0; val = 1;
                                            vRange.value = 100;
                                            updateFromHSV(false);
                                            drawWheel();
                                        }
                                    }, 10);
                                } else {
                                    targetInput = null;
                                }
                            });
                            obs.observe(picker, { attributes:true, attributeFilter:['style'] });

                            // initial draw
                            drawWheel();

                            // expose helper
                            window.openParameterColorPickerFor = function(el){ if (el instanceof Element) {
                                try { targetInput = el; setUIFromHex((el.value && el.value.startsWith('#')) ? el.value : ('#' + (el.value||'ffffff'))); } catch(e){}
                                if (getComputedStyle(picker).display === 'none') picker.style.display = 'flex';
                                drawWheel();
                            } };
                        })();

                        //Get defaut theme parameters and apply to inputs

                        (function(){
                            // fallbacks that were previously used
                            const defaultThemeParameters = {
                                'Color_Parameter_Main_UI-1': '#ffffff',
                                'Color_Parameter_Main_UI-2': '#f0f0f0',
                                'Color_Parameter_Windows': '#e0e0e0',
                                'Color_Parameter_Headers': '#d0d0d0',
                                'Color_Parameter_Background': '#c0c0c0',
                                'Color_Parameter_Keyboard': '#b0b0b0',
                                'Color_Parameter_Keys': '#a0a0a0',
                                'Color_Parameter_Text_Color': '#111111',
                                'Color_Parameter_Brackets': '#ffcc00',
                                'Color_Parameter_Sliders': '#888888',
                                'Font_Size_Parameter': '9'
                            };

                            // best-effort mapping from input id => CSS variable on :root
                            const varMap = {
                                'Color_Parameter_Main_UI-1': '--UI-Buttons-Fields-Color-1',
                                'Color_Parameter_Main_UI-2': '--UI-Buttons-Fields-Color-2',
                                'Color_Parameter_Windows':    '--Main_Window_Color-1',
                                'Color_Parameter_Headers':    '--Main_Window_Header_Color-1',
                                'Color_Parameter_Background': '--Background',
                                'Color_Parameter_Keyboard':   '--VirtualKeyboard_Background',
                                'Color_Parameter_Keys':       '--VirtualKeyboard_Keys',
                                'Color_Parameter_Text_Color': '--Main_Text_Color_1',
                                'Color_Parameter_Brackets':   '--Active_Brackets_Span',
                                'Color_Parameter_Sliders':    '--Slider_Color',
                                'Font_Size_Parameter':        '--Main_Text'
                            };

                            const rootStyles = getComputedStyle(document.documentElement);

                            function rgbStringToHex(s){
                                const m = s.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)/i);
                                if(!m) return null;
                                const r = parseInt(m[1],10), g = parseInt(m[2],10), b = parseInt(m[3],10);
                                return '#' + [r,g,b].map(n => n.toString(16).padStart(2,'0')).join('');
                            }

                            function normalizeCssColor(value){
                                if(!value) return null;
                                value = String(value).trim();
                                if(!value) return null;
                                // handle rgb/rgba
                                if (/^rgba?\(/i.test(value)) {
                                    const hex = rgbStringToHex(value);
                                    if (hex) return hex;
                                }
                                // handle var(--something) resolved to something already by getPropertyValue
                                // ensure hex starts with #
                                if (/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(value)) return value.toLowerCase();
                                // try plain hex without #
                                if (/^[0-9a-f]{3,6}$/i.test(value)) return '#' + value.toLowerCase();
                                return null;
                            }

                            Object.keys(varMap).forEach(id => {
                                const el = document.getElementById(id);
                                const cssVar = varMap[id];
                                if (!el) return;

                                let applied = false;
                                if (cssVar) {
                                    let cssVal = rootStyles.getPropertyValue(cssVar).trim();
                                    if (cssVal) {
                                        if (id === 'Font_Size_Parameter') {
                                            // try to extract a number (px/rem) -> numeric value
                                            const mPx = cssVal.match(/([\d.]+)px/);
                                            if (mPx) {
                                                el.value = Math.round(parseFloat(mPx[1]));
                                                applied = true;
                                            } else {
                                                const num = parseFloat(cssVal);
                                                if (!isNaN(num)) { el.value = num; applied = true; }
                                            }
                                        } else {
                                            const color = normalizeCssColor(cssVal);
                                            if (color) { el.value = color; applied = true; }
                                        }
                                    }
                                }

                                // fallback: try to probe common variables if mapped one missing
                                if (!applied) {
                                    // scan :root variables for likely candidates
                                    const vars = Array.from(document.styleSheets || []).reduce((acc, sheet) => {
                                        try {
                                            const rules = sheet.cssRules || [];
                                            for (const r of rules) {
                                                if (r.selectorText && r.selectorText.toLowerCase().includes(':root')) {
                                                    acc.push(r.style);
                                                }
                                            }
                                        } catch(e){}
                                        return acc;
                                    }, []);

                                    if (!applied && vars.length) {
                                        for (const style of vars) {
                                            for (const prop of style) {
                                                try {
                                                    if (!prop.startsWith('--')) continue;
                                                    // heuristic: match parts of input id to var name
                                                    const idLow = id.toLowerCase();
                                                    const propLow = prop.toLowerCase();
                                                    if (propLow.includes('ui') && idLow.includes('main_ui')) {
                                                        const c = normalizeCssColor(rootStyles.getPropertyValue(prop));
                                                        if (c) { el.value = c; applied = true; break; }
                                                    }
                                                    if (propLow.includes('background') && idLow.includes('background')) {
                                                        const c = normalizeCssColor(rootStyles.getPropertyValue(prop));
                                                        if (c) { el.value = c; applied = true; break; }
                                                    }
                                                    if (propLow.includes('text') && (idLow.includes('text') || idLow.includes('color'))) {
                                                        const c = normalizeCssColor(rootStyles.getPropertyValue(prop));
                                                        if (c) { el.value = c; applied = true; break; }
                                                    }
                                                    if (propLow.includes('bracket') || propLow.includes('brackets') || propLow.includes('active_brackets')) {
                                                        if (idLow.includes('bracket') || idLow.includes('brackets')) {
                                                            const c = normalizeCssColor(rootStyles.getPropertyValue(prop));
                                                            if (c) { el.value = c; applied = true; break; }
                                                        }
                                                    }
                                                    if (propLow.includes('slider') || propLow.includes('sliders')) {
                                                        if (idLow.includes('slider') || idLow.includes('sliders')) {
                                                            const c = normalizeCssColor(rootStyles.getPropertyValue(prop));
                                                            if (c) { el.value = c; applied = true; break; }
                                                        }
                                                    }
                                                } catch(e){}
                                            }
                                            if (applied) break;
                                        }
                                    }
                                }

                                // if still not applied set previously used default
                                if (!applied) {
                                    el.value = defaultThemeParameters[id] || el.value || '';
                                }

                                // notify UI bindings
                                el.dispatchEvent(new Event('input', { bubbles: true }));
                            });
                        })();

                        //Get Theme Parameters and apply to inputs

                        (function(){
                            // helper: compute whether white or black text contrasts better on hex background
                            function getContrastTextColor(hex){
                                if(!hex) return '#000';
                                hex = hex.replace('#','');
                                if(hex.length===3) hex = hex.split('').map(c=>c+c).join('');
                                const r = parseInt(hex.substr(0,2),16);
                                const g = parseInt(hex.substr(2,2),16);
                                const b = parseInt(hex.substr(4,2),16);
                                // relative luminance (WCAG-ish)
                                const [R,G,B] = [r,g,b].map(v=>{
                                    v /= 255;
                                    return (v <= 0.03928) ? v/12.92 : Math.pow((v+0.055)/1.055, 2.4);
                                });
                                const lum = 0.2126*R + 0.7152*G + 0.0722*B;
                                return (lum > 0.5) ? '#000' : '#fff';
                            }

                            function updateSwatchFor(input){
                                try {
                                    const val = String(input.value || '').trim();
                                    if (!val) {
                                        input.style.background = '';
                                        input.style.color = '';
                                        return;
                                    }
                                    // set background and text color for readability
                                    input.style.background = val;
                                    input.style.color = getContrastTextColor(val);
                                    // Some browsers render native swatch; ensure padding so color visible
                                    input.style.paddingLeft = '6px';
                                } catch(e){}
                            }

                            // initialize existing inputs and add listeners
                            function bindColorInputs(root=document){
                                const inputs = Array.from(root.querySelectorAll('.Color_Parameter_setting'));
                                inputs.forEach(inp=>{
                                    updateSwatchFor(inp);
                                    // update swatch when value changes programmatically or via picker
                                    inp.addEventListener('input', ()=> updateSwatchFor(inp));
                                    // open custom parameter color picker as fallback (pointer handling already exists elsewhere)
                                    inp.addEventListener('click', (ev)=>{
                                        ev.stopPropagation();
                                        // prefer the exposed helper if available
                                        if (typeof window.openParameterColorPickerFor === 'function') {
                                            window.openParameterColorPickerFor(inp);
                                        }
                                    });
                                });
                            }

                            // initial bind
                            bindColorInputs();

                            // observe DOM changes to bind any dynamically created inputs
                            const mo = new MutationObserver(mr => {
                                for (const r of mr) {
                                    if (r.addedNodes && r.addedNodes.length) {
                                        bindColorInputs(r.target || document);
                                    }
                                }
                            });
                            mo.observe(document.body, { childList: true, subtree: true });

                            // When the Parameter_Color_Picker applies a color, it dispatches 'input' on targetInput
                            // but to be safe also listen for cp-apply clicks to update the active target swatch immediately
                            const applyBtn = document.getElementById('cp-apply');
                            if (applyBtn) {
                                applyBtn.addEventListener('click', () => {
                                    // find focused or heuristic target and update swatch
                                    const candidate = document.querySelector('.Color_Parameter_setting:focus') || (window._lastParameterColorTarget || null);
                                    if (candidate) updateSwatchFor(candidate);
                                    // also update all in case target was set programmatically
                                    document.querySelectorAll('.Color_Parameter_setting').forEach(updateSwatchFor);
                                });
                            }

                            // keep a weak heuristic when openParameterColorPickerFor is called
                            const originalOpenHelper = window.openParameterColorPickerFor;
                            window.openParameterColorPickerFor = function(el){
                                try { window._lastParameterColorTarget = el instanceof Element ? el : null; } catch(e){}
                                if (typeof originalOpenHelper === 'function') originalOpenHelper(el);
                            };
                        })();

                        // Change colors for selected theme parameter inputs

                        (function(){
                            const map = {
                                'Color_Parameter_Main_UI-1': '--UI-Buttons-Fields-Color-1',
                                'Color_Parameter_Main_UI-2': '--UI-Buttons-Fields-Color-2',
                                'Color_Parameter_Windows':    '--Main_Window_Color-1',
                                'Color_Parameter_Headers':    '--Main_Window_Header_Color-1',
                                'Color_Parameter_Background': '--Background',
                                'Color_Parameter_Text_Color': '--Main_Text_Color_1',
                                'Color_Parameter_Brackets':   '--Active_Brackets_Span',
                                'Color_Parameter_Sliders':    '--Slider_Color',
                                'Color_Parameter_Keyboard':   '--VirtualKeyboard_Background',
                                'Color_Parameter_Keys':       '--VirtualKeyboard_Keys'
                            };

                            function normalizeHex(val){
                                if (!val) return null;
                                let s = String(val).trim().replace(/^#/, '');
                                if (!/^[0-9a-f]{3}$|^[0-9a-f]{6}$/i.test(s)) return null;
                                if (s.length === 3) s = s.split('').map(c => c + c).join('');
                                return '#' + s.toLowerCase();
                            }

                            function applyVar(varName, hex){
                                if (!varName || !hex) return;
                                document.documentElement.style.setProperty(varName, hex);
                            }

                            function findElementsById(id){
                                // handle duplicate ids by using attribute selector
                                return Array.from(document.querySelectorAll('[id]')).filter(el => el.id === id);
                            }

                            // initialize from inputs (first valid)
                            Object.keys(map).forEach(id => {
                                const els = findElementsById(id);
                                for (const el of els) {
                                    const h = normalizeHex(el.value);
                                    if (h) { applyVar(map[id], h); break; }
                                }
                            });

                            // bind listeners for each mapped input
                            Object.keys(map).forEach(id => {
                                const varName = map[id];
                                const els = findElementsById(id);
                                if (!els.length) return;

                                function handler(e){
                                    const src = e && e.target ? e.target : this;
                                    const hex = normalizeHex(src.value);
                                    if (hex) applyVar(varName, hex);
                                }

                                els.forEach(el => {
                                    el.addEventListener('input', handler, { passive: true });
                                    el.addEventListener('change', handler, { passive: true });
                                });
                            });

                            // react when custom color picker apply is clicked
                            const cpApply = document.getElementById('cp-apply');
                            if (cpApply) {
                                cpApply.addEventListener('click', () => {
                                    // prefer focused color input
                                    const focused = document.querySelector('.Color_Parameter_setting:focus');
                                    if (focused && focused.id && map[focused.id]) {
                                        const h = normalizeHex(focused.value);
                                        if (h) applyVar(map[focused.id], h);
                                        return;
                                    }
                                    // fallback: try heuristic _lastParameterColorTarget set elsewhere
                                    const last = window._lastParameterColorTarget;
                                    if (last && last.id && map[last.id]) {
                                        const h = normalizeHex(last.value);
                                        if (h) applyVar(map[last.id], h);
                                        return;
                                    }
                                    // as final fallback update all mapped inputs that have valid values
                                    Object.keys(map).forEach(id => {
                                        const els = findElementsById(id);
                                        for (const el of els) {
                                            const h = normalizeHex(el.value);
                                            if (h) { applyVar(map[id], h); break; }
                                        }
                                    });
                                }, { passive: true });
                            }
                        })();

                        //Set font size for font size parameter input
                        (function(){
                            const input = document.getElementById('Font_Size_Parameter');
                            if (!input) return;

                            function applyFontSize(size){
                                if (!size) return;
                                const num = parseFloat(size);
                                if (isNaN(num) || num <= 0) return;
                                document.documentElement.style.setProperty('--Main_Text', num + 'px');
                            }

                            // initialize
                            applyFontSize(input.value);

                            // bind listener
                            input.addEventListener('input', () => {
                                applyFontSize(input.value);
                            });
                            input.addEventListener('change', () => {
                                applyFontSize(input.value);
                            });
                        })();

                        </script>
                    </div>
                </div>

                <script>
                (function(){
                    const picker = document.getElementById('Parameter_Color_Picker');
                    if (!picker) return;
                    let activeInput = null;

                    function showPickerFor(input){
                        activeInput = input;
                        // compute position near input
                        const rect = input.getBoundingClientRect();
                        const bodyRect = document.body.getBoundingClientRect();
                        picker.style.position = 'absolute';

                        // prefer to place to the right, fallback below if not enough space
                        const preferredLeft = rect.right + 8;
                        const preferredTop = rect.top;
                        picker.style.display = 'flex';
                        picker.style.transform = 'scale(0)';
                        picker.style.opacity = '0';
                        picker.style.transformOrigin = 'top left';
                        picker.style.transition = 'transform .18s cubic-bezier(0,1,0,1), opacity .18s';

                        // measure after display so offsetWidth/Height are available
                        requestAnimationFrame(() => {
                            const pw = picker.offsetWidth || 200;
                            const ph = picker.offsetHeight || 200;
                            let left = preferredLeft;
                            let top = preferredTop;

                            if (left + pw > bodyRect.width) left = rect.left; // move to left side of input
                            if (left + pw > bodyRect.width) left = Math.max(8, bodyRect.width - pw - 8); // clamp
                            if (top + ph > bodyRect.height) top = Math.max(8, bodyRect.height - ph - 8);

                            picker.style.left = left + 'px';
                            picker.style.top = top + 'px';

                            requestAnimationFrame(() => {
                                picker.style.transform = 'scale(1)';
                                picker.style.opacity = '1';
                            });
                        });
                    }

                    function hidePicker(){
                        if (getComputedStyle(picker).display !== 'flex') return;
                        picker.style.transform = 'scale(0)';
                        picker.style.opacity = '0';
                        setTimeout(()=> { picker.style.display = 'none'; activeInput = null; }, 200);
                    }

                    // Capture pointerdown so we run before other listeners that block the native picker
                    document.addEventListener('pointerdown', function(e){
                        const target = e.target;
                        const input = target.closest ? target.closest('.Color_Parameter_setting, input[type="color"].Color_Parameter_setting') : (target.classList && target.classList.contains('Color_Parameter_setting') ? target : null);
                        if (!input) return;
                        e.preventDefault();
                        e.stopPropagation();
                        showPickerFor(input);
                    }, { capture: true });

                    // Prevent clicks inside picker from closing it
                    picker.addEventListener('pointerdown', function(e){ e.stopPropagation(); });

                    // close button in picker header (if present)
                    const closeBtn = picker.querySelector('.Close_Button');
                    if (closeBtn) closeBtn.addEventListener('click', function(e){ e.stopPropagation(); hidePicker(); });

                    // click outside closes
                    document.addEventListener('pointerdown', function(){
                        hidePicker();
                    });

                    // expose a hook if you want to transfer a color back to the input later
                    window.openParameterColorPickerFor = function(el){ if (el instanceof Element) showPickerFor(el); };
                })();
                </script>

            </div>
        </div>

        <Style>
            #Theme_Market_Window {
                position: absolute;
                top: 0px;
                left: 0px;
                width: 100dvw;
                height: 100dvh;
                z-index: 10;
            }

            #Theme_Market_Window > .Content > .Title {
                position: absolute;
                top: 20px;
                left: 20px;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            #Theme_Market_Window > .Content > .Theme_Count {
                position: absolute;
                top: 20px;
                right: 10px;
                font-size: var(--Main_Text);
                color: var(--Main_Text_Color_1);
            }

            #Theme_Market_Window > .Content > .Top_Themes {
                position: absolute;
                top: 100px;
                width: calc(100% - 20px);
                height: 100px;
                display: flex;
                flex-direction: row;
                gap: 10px;
                overflow-x: auto;
                justify-content: start;
                align-items: center;
            }

            #Theme_Market_Window > .Content > .Top_Themes > .Theme_Container {
                position: relative;
                width: 140px;
                height: 100%;
                background-color: var(--UI-Buttons-Fields-Color-3);
                flex-shrink: 0;
                font-size: var(--Main_Text);
                color: var(--Main_Text_Color_1);
                display: flex;
                justify-content: center;
            }

            #Theme_Market_Window > .Content > .Top_Themes > .Theme_Container > p {
                position: absolute;
                top: 10px;
                width: 100%;
                text-align: center;
            }

            #Theme_Market_Window > .Content > .Top_Themes > .Theme_Container > .Color_Pallet {
                position: absolute;
                top: 30px;
                width: calc(100% - 20px);
                height: 30px;
                display: flex;
                flex-direction: row;
            }

            #Theme_Market_Window > .Content > .Top_Themes > .Theme_Container > .Color_Pallet > span {
                width: 100%;
                height: 100%;
            }

            #Theme_Market_Window > .Content > .Top_Themes > .Theme_Container > button {
                position: absolute;
                bottom: 10px;
                width: calc(100% - 20px);
                height: 20px;

            }

            #Theme_Market_Window > .Content > .Create_Raw_File_Search {
                position: absolute;
                top: 210px;
                width: calc(100% - 20px);
                display: flex;
                flex-direction: row;
                gap: 10px;
            }

            #Theme_Market_Window > .Content > .Create_Raw_File_Search > button {
                width: 100%;
                height: 30px;
                background-color: var(--UI-Buttons-Fields-Color-3);
                color: var(--Main_Text_Color_1);
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content {
                position: absolute;
                top: 250px;
                width: calc(100% - 20px);
                height: calc(100% - 260px);
                background-color: var(--UI-Buttons-Fields-Color-2);
                color: var(--Main_Text_Color_1);
                display: flex;
                flex-direction: row;
                gap: 10px;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Catagory_List {
                width: 200px;
                height: 100%;
                text-indent: 10px;
                display: flex;
                flex-direction: column;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Catagory_List > span {
                font-size: var(--Main_Text);
                width: 100%;
                height: 30px;
                display: flex;
                align-items: center;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library {
                width: 100%;
                height: 100%;
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                grid-template-rows: repeat(6, 1fr);
                gap: 10px 10px; /* x gap = 10px, y gap = 10px */
                overflow-y: auto;
                padding: 10px;
                align-content: start;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library > .Theme_Container {
                position: relative;
                width: 100%;
                height: 100px;
                background-color: var(--UI-Buttons-Fields-Color-3);
                font-size: var(--Main_Text);
                color: var(--Main_Text_Color_1);
                display: flex;
                justify-content: center;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library > .Theme_Container > p {
                position: absolute;
                top: 10px;
                width: 100%;
                text-align: center;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library > .Theme_Container > .Color_Pallet {
                position: absolute;
                top: 30px;
                width: calc(100% - 20px);
                height: 30px;
                display: flex;
                flex-direction: row;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library > .Theme_Container > .Color_Pallet > span {
                width: 100%;
                height: 100%;
            }

            #Theme_Market_Window > .Content > .Theme_Market_Content > .Theme_Library > .Theme_Container > button {
                position: absolute;
                bottom: 10px;
                width: calc(100% - 20px);
                height: 20px;
            }

            /*Create Theme File Window Styles*/

            #Create_Theme_File_Window > .Content > .Title {
                position: absolute;
                top: 10px;
                left: 10px;
                font-size: var(--Main_Text_1);
                color: var(--Main_Text_Color_1)
            }

            #Create_Theme_File_Window > .Content > .Creator_Account {
                position: absolute;
                top: 10px;
                right: 10px;
                font-size: var(--Main_Text_1);
                color: var(--Main_Text_Color_1)
            }

            #Create_Theme_File_Window > .Content > .Name_Of_Theme {
                position: absolute;
                top: 40px;
                width: calc(100% - 20px);
                height: 30px;
            }

            #Create_Theme_File_Window > .Content > .Name_Of_Theme > input {
                width: 100%;
                height: 30px;
            }

            #Create_Theme_File_Window > .Content > .Name_Of_Theme > input::placeholder {
                color: var(--Main_Text_Color_1);
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters {
                position: absolute;
                top: 90px;
                width: calc(100% - 20px);
                height: calc(100% - 140px);
                display: flex;
                flex-direction: row;
                gap: 50px;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .UI_Parameters {
                position: relative;
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .UI_Parameters > .Color_Parameter {
                width: 100%;
                display: flex;
                flex-direction: row;            
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .UI_Parameters > .Color_Parameter > label {
                color: var(--Main_Text_Color_1);
            }
            
            #Create_Theme_File_Window > .Content > .Theme_Parameters > .UI_Parameters > .Color_Parameter > input {
                position: absolute;
                right: 0px;
                width: 15px;
                height: 15px;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters {
                position: relative;
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters > .Color_Parameter {
                width: 100%;
                display: flex;
                flex-direction: row;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters > .Color_Parameter > label {
                color: var(--Main_Text_Color_1);
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters > .Color_Parameter > input {
                position: absolute;
                right: 0px;
                width: 15px;
                height: 15px;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters > .Font_Size {
                position: relative;
            }

            #Create_Theme_File_Window > .Content > .Theme_Parameters > .Keyboard_Parameters > .Font_Size > .Font_Size_setting {
                position: absolute;
                top: 30px;
                right: 0px;
                width: 100%;
                height: 30px;
            }

            #Create_Theme_File_Window > .Content > .Save_Theme {
                position: absolute;
                bottom: 10px;
                width: calc(100% - 20px);
            }

            #Create_Theme_File_Window > .Content > .Save_Theme > button {
                width: 100%;
                height: 30px;
                background-color: var(--UI-Buttons-Fields-Color-3);
            }
        </Style>
        <script>
            //Disable chrome color picker

            (function () {
                // hide chrome swatch visuals (best-effort)
                const s = document.createElement('style');
                s.textContent = `
                    input[type="color"]::-webkit-color-swatch-wrapper { display: none !important; }
                    input[type="color"]::-webkit-color-swatch { display: none !important; }
                `;
                document.head.appendChild(s);

                // Prevent native color picker from opening
                const inputs = Array.from(document.querySelectorAll('input[type="color"]'));
                inputs.forEach(input => {
                    input.setAttribute('readonly', 'readonly');

                    // Block mouse/touch/keyboard activation that would open the native picker
                    ['click', 'mousedown', 'mouseup', 'focus', 'keydown', 'touchstart'].forEach(ev =>
                        input.addEventListener(ev, function (e) {
                            e.preventDefault();
                            e.stopImmediatePropagation();
                            // keep visual focus if needed but never open native UI
                            if (ev === 'focus') this.blur();
                        }, { passive: false })
                    );
                });
            })();

            // Open Create Theme File Window
            
            (function(){
                // ensure Create Theme File window is placed at top:10px left:10px when opened
                document.addEventListener('click', function(e){
                    const trigger = e.target && (e.target.id === 'Open_Create_Theme_File_Window' || (e.target.closest && e.target.closest('#Open_Create_Theme_File_Window')));
                    if (!trigger) return;
                    const cw = document.getElementById('Create_Theme_File_Window');
                    if (!cw) return;
                    cw.style.position = 'absolute';
                    cw.style.left = '10px';
                    cw.style.top = '10px';
                }, true);
                const openBtn = document.getElementById('Open_Create_Theme_File_Window');
                const createWin = document.getElementById('Create_Theme_File_Window');
                if (!openBtn || !createWin) return;
                const closeBtn = createWin.querySelector('.Close_Button');

                function openCreateWindow() {
                    createWin.style.display = 'flex';
                    createWin.style.transform = 'scale(0)';
                    createWin.style.opacity = '0';
                    createWin.style.transformOrigin = 'top left';
                    createWin.style.transition = 'transform .25s cubic-bezier(0,1,0,1), opacity .25s cubic-bezier(0,1,0,1)';
                    requestAnimationFrame(() => {
                        createWin.style.transform = 'scale(1)';
                        createWin.style.opacity = '1';
                    });
                }

                function closeCreateWindow() {
                    createWin.style.transition = 'transform .25s cubic-bezier(0,1,0,1), opacity .2s ease-in-out';
                    createWin.style.transform = 'scale(0)';
                    createWin.style.opacity = '0';
                    setTimeout(() => { createWin.style.display = 'none'; }, 250);
                }

                openBtn.addEventListener('click', function(e){
                    e.stopPropagation();
                    openCreateWindow();
                });

                if (closeBtn) {
                    closeBtn.addEventListener('click', function(e){
                        e.stopPropagation();
                        closeCreateWindow();
                    });
                }

                // keep clicks inside the window from bubbling to global handlers that close windows
                createWin.addEventListener('click', function(e){ e.stopPropagation(); });
            })();

            //Theme Market Window

            (function(){
                const themesBtn = document.getElementById('Open_Themes_Market');
                const themeWin = document.getElementById('Theme_Market_Window');
                const closeBtn = themeWin.querySelector('.Close_Button');

                function cancelSettingsDropdown() {
                    const settingsMenu = document.getElementById('Settings_Menu');
                    const settingsBtn = document.getElementById('Settings_Button');
                    if (!settingsMenu) return;
                    if (getComputedStyle(themeWin).display === 'flex') {
                        settingsMenu.classList.remove('open');
                        settingsMenu.style.display = 'none';
                        settingsBtn && settingsBtn.setAttribute('aria-expanded','false');
                    }
                }

                function positionThemeWindow() {
                    themeWin.style.position = 'absolute';
                    themeWin.style.top = '0px';
                    themeWin.style.left = '0px';
                    themeWin.style.right = 'auto';
                }

                function openThemeWindow() {
                    positionThemeWindow();
                    if (themeWin.style.display !== 'flex') {
                        themeWin.style.display = 'flex';
                        themeWin.style.transform = 'scale(0)';
                        themeWin.style.opacity = '0';
                        themeWin.style.transformOrigin = 'top left';
                        themeWin.style.transition = 'transform .3s cubic-bezier(0,1,0,1), opacity .3s cubic-bezier(0,1,0,1)';
                        requestAnimationFrame(()=>{
                            themeWin.style.transform = 'scale(1)';
                            themeWin.style.opacity = '1';
                        });
                    }
                    cancelSettingsDropdown();
                }

                function closeThemeWindow() {
                    themeWin.style.transition = 'transform .3s cubic-bezier(0,1,0,1), opacity .3s ease-in-out';
                    themeWin.style.transform = 'scale(0)';
                    themeWin.style.opacity = '0';
                    setTimeout(()=>{ themeWin.style.display = 'none'; },300);
                }

                themesBtn.addEventListener('click', e => {
                    e.stopPropagation();
                    openThemeWindow();
                });

                closeBtn.addEventListener('click', e => {
                    e.stopPropagation();
                    closeThemeWindow();
                });

                document.addEventListener('click', e => {
                    if (themeWin.style.display === 'flex' &&
                        !themeWin.contains(e.target) &&
                        e.target !== themesBtn) {
                        closeThemeWindow();
                    }
                });

                // MutationObserver to cancel dropdown whenever theme window becomes visible
                const observer = new MutationObserver(() => cancelSettingsDropdown());
                observer.observe(themeWin, { attributes: true, attributeFilter: ['style'] });

                if (themeWin.style.display === 'flex') {
                    positionThemeWindow();
                    cancelSettingsDropdown();
                }

                window.addEventListener('resize', () => {
                    if (themeWin.style.display === 'flex') positionThemeWindow();
                });
            })();

            //Active Span in Catagory List
            (function(){
                const categorySpans = document.querySelectorAll('#Theme_Market_Window .Catagory_List span');
                
                categorySpans.forEach(span => {
                    // no transition applied (remove smooth transition)
                    span.addEventListener('click', function() {
                        // Remove active state from all spans
                        categorySpans.forEach(s => {
                            s.style.color = 'var(--Main_Text_Color_1)';
                            s.style.transform = 'translateX(0)';
                            const text = s.textContent.replace(/^\[|\]$/g, '').trim();
                            s.textContent = text;
                        });
                        
                        // Add active state to clicked span: indent text to x+5px (translateX(5px))
                        this.style.color = 'var(--Active_Brackets_Span)';
                        this.style.transform = 'translateX(5px)';
                        const text = this.textContent.replace(/^\[|\]$/g, '').trim();
                        this.textContent = `[${text}]`;
                    });
                });
            })();

            document.addEventListener('click', function(event) {
                const categorySpans = document.querySelectorAll('#Theme_Market_Window .Catagory_List span');
                categorySpans.forEach(span => {
                    if (!span.contains(event.target)) {
                        span.style.color = 'var(--Main_Text_Color_1)';
                        span.style.transform = 'translateX(0)';
                        const text = span.textContent.replace(/^\[|\]$/g, '').trim();
                        span.textContent = text;
                    }
                });
            });

            //Get theme count
            
            (function() {
                // Get the number of .Theme_Container elements inside .Theme_Library
                const themeLibrary = document.querySelector('#Theme_Market_Window .Theme_Library');
                const themeCount = themeLibrary ? themeLibrary.querySelectorAll('.Theme_Container').length : 0;
                // Update the .Theme_Count element
                const themeCountElem = document.querySelector('#Theme_Market_Window .Theme_Count p');
                if (themeCountElem) {
                    themeCountElem.textContent = `${themeCount} Theme${themeCount === 1 ? '' : 's'} on the market`;
                }
            })();

            

        </script>
    </div>

    <!-- ============================================================================ -->
    <!-- CLOCK SCRIPT -->
    <!-- ============================================================================ -->

    <div class="Clock">
        <p class="Clock_Time">10:10:10:10 pm</p>
        <p class="Clock_Date">Monday: 10-10-9999</p>
    </div>
    <script id="Clock Script">


        // Clock - Update every second
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const milliseconds = now.getMilliseconds().toString().padStart(3, '0');
            const ampm = hours >= 12 ? 'pm' : 'am';
            
            hours = hours % 12;
            hours = hours ? hours : 12; // 0 should be 12
            
            const timeString = `${hours}:${minutes}:${seconds}:${milliseconds} ${ampm}`;
            document.querySelector('.Clock_Time').textContent = timeString;
        }

        updateClock();
        setInterval(updateClock, 10); // Update every 10ms for smooth milliseconds display

        // Date - Update every second
        function updateDate() {
            const now = new Date();
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayOfWeek = daysOfWeek[now.getDay()];
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const year = now.getFullYear();
            
            const dateString = `${dayOfWeek}: ${month}-${day}-${year}`;
            document.querySelector('.Clock_Date').textContent = dateString;
        }

        updateDate();
        setInterval(updateDate, 1000);
        
    </script>

    <!-- ============================================================================ -->
    <!-- SIDE BAR -->
    <!-- ============================================================================ -->

    <div class="Side_Bar">
        <button class="Icon_Button" id="Side_Bar_Notifications"><img src="/Images/Icons/notifications_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Messages"><img src="/Images/Icons/chat_bubble_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Mail"><img src="/Images/Icons/mail_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Upload"d><img src="/Images/Icons/upload_24dp_1F1F1F_FILL1_wght400_GRAD0_opsz24.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Wallet"><img src="/Images/Icons/currency_bitcoin_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_ID"><img src="/Images/Icons/id_card_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Tool"><img src="/Images/Icons/handyman_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt=""></button>
    </div>



    <!-- ============================================================================ -->
    <!-- NOTIFICATIONS WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Notifications_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_Notifications_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Notifications_Window Script">

        document.getElementById('Side_Bar_Notifications').addEventListener('click', function() {
            const notificationsWindow = document.getElementById('Notifications_Window');
            notificationsWindow.style.display = 'flex';
            notificationsWindow.style.transform = 'scale(0)';
            notificationsWindow.style.opacity = '0';
            notificationsWindow.style.transformOrigin = 'top left';
            notificationsWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            notificationsWindow.style.transform = 'scale(1)';
            notificationsWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Notifications_Window').addEventListener('click', function() {
            const notificationsWindow = document.getElementById('Notifications_Window');
            notificationsWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            notificationsWindow.style.transform = 'scale(0)';
            notificationsWindow.style.opacity = '0';
            
            setTimeout(() => {
            notificationsWindow.style.display = 'none';
            }, 300);
        });

        // Parent Notifications Window to Side Bar Notifications button
        const notificationsWindow = document.getElementById('Notifications_Window');
        const sideBarNotifications = document.getElementById('Side_Bar_Notifications');
        
        function positionNotificationsWindow() {
            const buttonRect = sideBarNotifications.getBoundingClientRect();
            notificationsWindow.style.position = 'absolute';
            notificationsWindow.style.left = (buttonRect.right + 10) + 'px';
            notificationsWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Notifications').addEventListener('click', function() {
            positionNotificationsWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- MESSAGES WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Messages_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_Messages_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Messages_Window Script">

        document.getElementById('Side_Bar_Messages').addEventListener('click', function() {
            const messagesWindow = document.getElementById('Messages_Window');
            messagesWindow.style.display = 'flex';
            messagesWindow.style.transform = 'scale(0)';
            messagesWindow.style.opacity = '0';
            messagesWindow.style.transformOrigin = 'top left';
            messagesWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            messagesWindow.style.transform = 'scale(1)';
            messagesWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Messages_Window').addEventListener('click', function() {
            const messagesWindow = document.getElementById('Messages_Window');
            messagesWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            messagesWindow.style.transform = 'scale(0)';
            messagesWindow.style.opacity = '0';
            
            setTimeout(() => {
            messagesWindow.style.display = 'none';
            }, 300);
        });

        // Parent Messages Window to Side Bar Messages button
        const messagesWindow = document.getElementById('Messages_Window');
        const sideBarMessages = document.getElementById('Side_Bar_Messages');
        
        function positionMessagesWindow() {
            const buttonRect = sideBarMessages.getBoundingClientRect();
            messagesWindow.style.position = 'absolute';
            messagesWindow.style.left = (buttonRect.right + 10) + 'px';
            messagesWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Messages').addEventListener('click', function() {
            positionMessagesWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- MAIL WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Mail_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_Mail_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Mail_Window Script">

        document.getElementById('Side_Bar_Mail').addEventListener('click', function() {
            const mailWindow = document.getElementById('Mail_Window');
            mailWindow.style.display = 'flex';
            mailWindow.style.transform = 'scale(0)';
            mailWindow.style.opacity = '0';
            mailWindow.style.transformOrigin = 'top left';
            mailWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            mailWindow.style.transform = 'scale(1)';
            mailWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Mail_Window').addEventListener('click', function() {
            const mailWindow = document.getElementById('Mail_Window');
            mailWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            mailWindow.style.transform = 'scale(0)';
            mailWindow.style.opacity = '0';
            
            setTimeout(() => {
            mailWindow.style.display = 'none';
            }, 300);
        });

        // Parent Mail Window to Side Bar Mail button
        const mailWindow = document.getElementById('Mail_Window');
        const sideBarMail = document.getElementById('Side_Bar_Mail');
        
        function positionMailWindow() {
            const buttonRect = sideBarMail.getBoundingClientRect();
            mailWindow.style.position = 'absolute';
            mailWindow.style.left = (buttonRect.right + 10) + 'px';
            mailWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Mail').addEventListener('click', function() {
            positionMailWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- UPLOAD WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Upload_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_Upload_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Upload_Window Script">

        document.getElementById('Side_Bar_Upload').addEventListener('click', function() {
            const uploadWindow = document.getElementById('Upload_Window');
            uploadWindow.style.display = 'flex';
            uploadWindow.style.transform = 'scale(0)';
            uploadWindow.style.opacity = '0';
            uploadWindow.style.transformOrigin = 'top left';
            uploadWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            uploadWindow.style.transform = 'scale(1)';
            uploadWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Upload_Window').addEventListener('click', function() {
            const uploadWindow = document.getElementById('Upload_Window');
            uploadWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            uploadWindow.style.transform = 'scale(0)';
            uploadWindow.style.opacity = '0';
            
            setTimeout(() => {
            uploadWindow.style.display = 'none';
            }, 300);
        });

        // Parent Upload Window to Side Bar Upload button
        const uploadWindow = document.getElementById('Upload_Window');
        const sideBarUpload = document.getElementById('Side_Bar_Upload');
        
        function positionUploadWindow() {
            const buttonRect = sideBarUpload.getBoundingClientRect();
            uploadWindow.style.position = 'absolute';
            uploadWindow.style.left = (buttonRect.right + 10) + 'px';
            uploadWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Upload').addEventListener('click', function() {
            positionUploadWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- WALLET WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Wallet_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_Wallet_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Wallet_Window Script">

        document.getElementById('Side_Bar_Wallet').addEventListener('click', function() {
            const walletWindow = document.getElementById('Wallet_Window');
            walletWindow.style.display = 'flex';
            walletWindow.style.transform = 'scale(0)';
            walletWindow.style.opacity = '0';
            walletWindow.style.transformOrigin = 'top left';
            walletWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            walletWindow.style.transform = 'scale(1)';
            walletWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Wallet_Window').addEventListener('click', function() {
            const walletWindow = document.getElementById('Wallet_Window');
            walletWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            walletWindow.style.transform = 'scale(0)';
            walletWindow.style.opacity = '0';
            
            setTimeout(() => {
            walletWindow.style.display = 'none';
            }, 300);
        });

        // Parent Wallet Window to Side Bar Wallet button
        const walletWindow = document.getElementById('Wallet_Window');
        const sideBarWallet = document.getElementById('Side_Bar_Wallet');
        
        function positionWalletWindow() {
            const buttonRect = sideBarWallet.getBoundingClientRect();
            walletWindow.style.position = 'absolute';
            walletWindow.style.left = (buttonRect.right + 10) + 'px';
            walletWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Wallet').addEventListener('click', function() {
            positionWalletWindow();
        });
    </script>

    <!-- ============================================================================ -->
    <!-- ID WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="ID_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window  with header</p>
            <button class="Close_Button" id="Close_ID_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="ID_Window Script">

        document.getElementById('Side_Bar_ID').addEventListener('click', function() {
            const idWindow = document.getElementById('ID_Window');
            idWindow.style.display = 'flex';
            idWindow.style.transform = 'scale(0)';
            idWindow.style.opacity = '0';
            idWindow.style.transformOrigin = 'top left';
            idWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            idWindow.style.transform = 'scale(1)';
            idWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_ID_Window').addEventListener('click', function() {
            const idWindow = document.getElementById('ID_Window');
            idWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            idWindow.style.transform = 'scale(0)';
            idWindow.style.opacity = '0';
            
            setTimeout(() => {
            idWindow.style.display = 'none';
            }, 300);
        });

        // Parent ID Window to Side Bar ID button
        const idWindow = document.getElementById('ID_Window');
        const sideBarID = document.getElementById('Side_Bar_ID');
        
        function positionIDWindow() {
            const buttonRect = sideBarID.getBoundingClientRect();
            idWindow.style.position = 'absolute';
            idWindow.style.left = (buttonRect.right + 10) + 'px';
            idWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_ID').addEventListener('click', function() {
            positionIDWindow();
        });
    </script>

    <!-- ============================================================================ -->
    <!-- TOOL WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Tool_Window" style="width:300px; height:200px; display: none;">
        <div class="Window_Header">
            <p class="Title">Tools</p>
            <button class="Close_Button" id="Close_Tool_Window"></button>
        </div>
        <div class="Content">
            <div class="Tools">
                <button id="Open_Alarm_Clock_Tool" style="width: 100%; height: 30px;">Alarm Clock</button>
                <button id="Open_Calculator_Tool" style="width: 100%; height: 30px;">Calculator</button>
                <button style="width: 100%; height: 30px;"></button>
                <button style="width: 100%; height: 30px;"></button>
                <button style="width: 100%; height: 30px;"></button>
            </div>
        </div>
    </div>
    <div class="Sub_Windows">

        <style>
            #Tool_Window > .Content > .Tools {
                width: calc(100% - 20px);
                height: calc(100% - 20px);
                display: flex;
                flex-direction: column;
                overflow-y: auto;
            }

            /* List items (supports either .Tool_Container divs or plain buttons) */
            #Tool_Window > .Content > .Tools > .Tool_Container,
            #Tool_Window > .Content > .Tools > button {
                width: 100%;
                height: 30px;
                background-color: var(--UI-Buttons-Fields-Color-2);
                color: var(--Main_Text_Color_1);
                font-size: var(--Main_Text);
                border-radius: var(--Border-Radius_Button);
                display: flex;
                align-items: center;
                text-indent: 10px;
                border: none;
                text-align: left;
                cursor: pointer;
            }

            #Tool_Window > .Content > .Tools > .Tool_Container:hover,
            #Tool_Window > .Content > .Tools > button:hover {
                background-color: var(--Normal_Button);
            }
        </style>

        <!-- ============================================================================ -->
        <!-- ALARM CLOCK WINDOW -->
        <!-- ============================================================================ -->

        <div class="Window" id="Alarm_Clock_Window" role="dialog" aria-modal="true" aria-labelledby="Alarm_Clock_Title" style="width:200px; height:350px; display:none;">
            <div class="Window_Header" style="user-select:none; cursor:move;">
                <p class="Title" id="Alarm_Clock_Title">Alarm Clock</p>
                <button class="Close_Button" id="Close_Alarm_Clock_Window" aria-label="Close Alarm Clock"></button>
            </div>
            <div class="Content" style="display:flex; flex-direction:column; gap:10px;">
                <div id="Alarm_Display_Time" style="text-align:center; font-size:30px; color:var(--Main_Text_Color_1);" aria-live="polite">
                    12:00 PM
                </div>
                <div style="width: calc(100% - 20px); display: flex; gap: 10px; align-items: center;">
                    <input type="time" id="Alarm_Time_Input" style="width: 100%; height: 30px; text-indent: 10px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); font-size: var(--Main_Text); outline: none;">
                    <button id="Set_Alarm_Button" style="width: 60px; height: 30px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; outline: none;">Set</button>
                </div>

                <div style="display:flex; flex-direction:column; gap: 10px; width: calc(100% - 20px);">
                    <p style="margin:0; color:var(--Main_Text_Color_1); font-size: var(--Main_Text);">Sound</p>
                    <div style="display:flex; gap: 10px;">
                        <select id="Alarm_Sound_Select" style="flex:1; height:30px; background-color:var(--UI-Buttons-Fields-Color-2); border:none; border-radius:var(--Border-Radius); color:var(--Main_Text_Color_1); text-indent: 10px; font-size:var(--Main_Text); outline: none;">
                            <option value="/Sounds/Audio/Morning_Signal.mp3">Digital Beep</option>
                            <option value="/Sounds/Audio/mixkit-digital-clock-digital-alarm-buzzer-992.wav">Digital Buzzer</option>
                            <option value="/Sounds/Audio/mixkit-warning-alarm-buzzer-991.wav">Warning Buzzer</option>
                        </select>
                        <button id="Preview_Alarm_Sound" class="Icon_Button" style="width: 60px; height: 30px; outline: none;">Play</button>
                    </div>
                </div>
                <input type="hidden" id="Selected_Alarm_Sound" value="/Sounds/Audio/Morning_Signal.mp3">

                <div id="Alarm_List" style="width: calc(100% - 20px); height: 150px; display: flex; flex-direction: column; overflow-y: scroll; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); font-size: var(--Main_Text);">
                    <!-- Alarms will be listed here -->
                </div>
            </div>
        </div>

        <script class="Alarm_Clock_Script">
            (function(){
                const select = document.getElementById('Alarm_Sound_Select');
                const hidden = document.getElementById('Selected_Alarm_Sound');
                const previewBtn = document.getElementById('Preview_Alarm_Sound');
                let previewAudio = new Audio();

                select.addEventListener('change', () => {
                    hidden.value = select.value;
                });

                previewBtn.addEventListener('click', () => {
                    previewAudio.pause();
                    previewAudio = new Audio(select.value);
                    previewAudio.currentTime = 0;
                    previewAudio.play();
                });

                // Attach extra handler to store sound on alarm object (after original listener runs)
                document.getElementById('Set_Alarm_Button').addEventListener('click', () => {
                    if (window.alarms && alarms.length) {
                        const last = alarms[alarms.length - 1];
                        last.sound = hidden.value;
                    }
                });

                // Provide helper to play an alarm sound
                window.playAlarmSound = function(src){
                    try {
                        const a = new Audio(src);
                        a.play().catch(()=>{});
                    } catch(e){}
                };

                // Lightweight poll to ensure alarms with sound play if set
                setInterval(() => {
                    if (!window.alarms) return;
                    const now = new Date();
                    const current = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                    alarms.forEach(alarm => {
                        if (alarm.active === false) return;
                        if (alarm.time === current && alarm.sound && !alarm._playedAtMinute) {
                            playAlarmSound(alarm.sound);
                            alarm._playedAtMinute = current;
                        }
                        if (alarm._playedAtMinute && alarm._playedAtMinute !== current) {
                            delete alarm._playedAtMinute;
                        }
                    });
                }, 1000);
            })();

            (function(){
                // Ensure alarm audio keeps playing when other windows open / focus changes.
                function resumeAllAlarmAudio(){
                    if (!window.alarms) return;
                    window.alarms.forEach(a => {
                        if (a && a._audio instanceof HTMLAudioElement) {
                            try { if (a._audio.paused) a._audio.play().catch(()=>{}); } catch(e){}
                        }
                    });
                }

                // Watch .Window style changes and resume audio when a window is shown
                const windows = Array.from(document.querySelectorAll('.Window'));
                const observer = new MutationObserver(records => {
                    for (const r of records) {
                        if (r.type === 'attributes' && r.attributeName === 'style') {
                            const el = r.target;
                            if (getComputedStyle(el).display === 'flex') resumeAllAlarmAudio();
                        }
                    }
                });
                windows.forEach(w => observer.observe(w, { attributes: true, attributeFilter: ['style'] }));

                // Resume after delegated clicks that may open windows (small delay to allow open logic)
                document.addEventListener('click', () => setTimeout(resumeAllAlarmAudio, 20), true);

                // Resume when tab becomes visible again
                document.addEventListener('visibilitychange', () => { if (!document.hidden) resumeAllAlarmAudio(); });

                // Wrap showAlarmNotification to ensure created audio is configured to continue playing
                if (typeof window.showAlarmNotification === 'function') {
                    const orig = window.showAlarmNotification;
                    window.showAlarmNotification = function(alarm){
                        orig(alarm);
                        if (alarm && alarm._audio instanceof HTMLAudioElement) {
                            try {
                                alarm._audio.loop = true;
                                alarm._audio.preload = 'auto';
                                alarm._audio.crossOrigin = 'anonymous';
                                // attempt immediate resume
                                alarm._audio.play().catch(()=>{});
                            } catch(e){}
                        }
                        resumeAllAlarmAudio();
                    };
                }
            })();
            (function(){
                // Try to keep screen awake and give best-effort fallback (notifications + vibration)
                let wakeLock = null;
                async function acquireWakeLock(){
                    if ('wakeLock' in navigator && !wakeLock) {
                        try {
                            wakeLock = await navigator.wakeLock.request('screen');
                            wakeLock.addEventListener('release', () => { wakeLock = null; });
                        } catch (e) { /* may fail (browser/device) */ }
                    }
                }
                async function releaseWakeLock(){
                    if (wakeLock) {
                        try { await wakeLock.release(); } catch(e) {}
                        wakeLock = null;
                    }
                }

                // Unlock audio autoplay on user gesture (Set button click)
                document.getElementById('Set_Alarm_Button').addEventListener('click', async () => {
                    try {
                        await acquireWakeLock(); // attempt to acquire wake lock during setup
                    } catch(e){}
                    // Play a short muted audio to allow future audio playback without further gestures
                    try {
                        const p = new Audio();
                        p.muted = true;
                        await p.play().catch(()=>{});
                        p.pause();
                    } catch(e){}
                });

                // Enhance alarm behavior: try to acquire wake lock and show a system notification + vibration
                const origShow = window.showAlarmNotification;
                window.showAlarmNotification = function(alarm){
                    try { acquireWakeLock(); } catch(e) {}
                    // Vibrate if available
                    try { navigator.vibrate && navigator.vibrate([300,150,300]); } catch(e){}

                    // Show a persistent system notification when permitted
                    try {
                        if ('Notification' in window) {
                            if (Notification.permission === 'default') Notification.requestPermission();
                            if (Notification.permission === 'granted') {
                                const tag = 'squeeble-alarm-' + (alarm && alarm.id ? alarm.id : Date.now());
                                const notif = new Notification('Alarm', {
                                    body: (alarm && (alarm.displayTime12 || alarm.time)) ? `Alarm  ${alarm.displayTime12 || alarm.time}` : 'Alarm',
                                    tag,
                                    renotify: true,
                                    requireInteraction: true
                                });
                                notif.onclick = () => { try { window.focus(); notif.close(); } catch(e){} };
                            }
                        }
                    } catch(e){}

                    // Call original dialog / audio logic (it already attempts to play and loop audio)
                    try { if (typeof origShow === 'function') origShow(alarm); } catch(e){}

                    // As a last resort try to explicitly start audio for the alarm to overcome throttling
                    try {
                        if (alarm && alarm.sound) {
                            const a = new Audio(alarm.sound);
                            a.loop = true;
                            a.play().catch(()=>{});
                            alarm._audio = a;
                        }
                    } catch(e){}
                };

                // Try to keep wake lock while the page is hidden and there are active alarms
                document.addEventListener('visibilitychange', async () => {
                    try {
                        if (document.hidden) {
                            // if any active alarm scheduled, try to reacquire
                            const hasActive = Array.isArray(window.alarms) && window.alarms.some(a => a && a.active);
                            if (hasActive) await acquireWakeLock();
                        } else {
                            // optional: release shortly after user returns
                            setTimeout(() => { releaseWakeLock(); }, 4000);
                        }
                    } catch(e){}
                });

                // Expose helpers for debugging / manual control
                window.__acquireAlarmWakeLock = acquireWakeLock;
                window.__releaseAlarmWakeLock = releaseWakeLock;
            })();
        </script>

        <!-- ============================================================================ -->
        <!-- TIME PICKER WINDOW -->
        <!-- ============================================================================ -->

        <div class="Window" id="Time_Picker_Window" style="width:250px; height:380px; display: none;">
            <div class="Window_Header">
            <p class="Title">Select Time</p>
            <button class="Close_Button" id="Close_Time_Picker_Window"></button>
            </div>
            <div class="Content" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
            <div style="display:flex; gap:10px; align-items:center;">
                <div style="display:flex; flex-direction: column; gap:8px; align-items:center;">
                <button id="Toggle_24H" class="Icon_Button" style="width:60px; height:34px;">24H</button>
                <button id="Toggle_12H" class="Icon_Button" style="width:60px; height:34px;">12H</button>
                </div>
                <div style="display:flex; gap:10px;">
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <button class="Icon_Button" id="Hour_Up"></button>
                    <div id="Hour_Display" style="width: 60px; height: 60px; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); display: flex; justify-content: center; align-items: center; font-size: 24px; color: var(--Main_Text_Color_1); margin: 5px 0;">12</div>
                    <button class="Icon_Button" id="Hour_Down"></button>
                </div>
                <span style="font-size: 24px; color: var(--Main_Text_Color_1);">:</span>
                <div style="display: flex; flex-direction: column; align-items: center;">
                    <button class="Icon_Button" id="Minute_Up"></button>
                    <div id="Minute_Display" style="width: 60px; height: 60px; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); display: flex; justify-content: center; align-items: center; font-size: 24px; color: var(--Main_Text_Color_1); margin: 5px 0;">00</div>
                    <button class="Icon_Button" id="Minute_Down"></button>
                </div>
                </div>
            </div>
            <div id="AMPM_Container" style="display: flex; gap: 10px;">
                <button id="AM_Button" style="width: 60px; height: 40px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">AM</button>
                <button id="PM_Button" style="width: 60px; height: 40px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">PM</button>
            </div>
            <button id="Confirm_Time_Button" style="position: absolute; bottom: 10px; width: calc(100% - 20px); height: 30px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">Confirm</button>
            </div>
        </div>

        <script class="Time_Picker_Script">
            let pickerHour = 12;
            let pickerMinute = 0;
            let pickerAMPM = 'AM';
            let use24Hour = false;

            function pad(n){ return n.toString().padStart(2,'0'); }

            // Ensure text uses root variable --Main_Text_Color_1
            function applyRootTextColor() {
            const container = document.getElementById('Time_Picker_Window');
            if (!container) return;
            // Apply color to typical text-holding elements inside the picker
            const els = container.querySelectorAll('button,div,span,label,p,input');
            els.forEach(el => {
                if (el instanceof HTMLElement) {
                el.style.color = 'var(--Main_Text_Color_1)';
                }
            });
            }

            function updateDisplays() {
            const ampmContainer = document.getElementById('AMPM_Container');
            const hourDisplay = document.getElementById('Hour_Display');
            const minuteDisplay = document.getElementById('Minute_Display');
            const t24 = document.getElementById('Toggle_24H');
            const t12 = document.getElementById('Toggle_12H');

            if (use24Hour) {
                ampmContainer.style.display = 'none';
                let h = pickerHour;
                if (h < 0) h = 0;
                if (h > 23) h = h % 24;
                hourDisplay.textContent = pad(h);
                t24.style.backgroundColor = 'var(--Normal_Button)';
                t12.style.backgroundColor = 'var(--UI-Buttons-Fields-Color-2)';
            } else {
                ampmContainer.style.display = 'flex';
                let displayHour = pickerHour;
                if (displayHour > 23) displayHour = displayHour % 24;
                if (displayHour === 0) displayHour = 12;
                if (displayHour > 12) displayHour = displayHour % 12 || 12;
                hourDisplay.textContent = pad(displayHour);
                t12.style.backgroundColor = 'var(--Normal_Button)';
                t24.style.backgroundColor = 'var(--UI-Buttons-Fields-Color-2)';
            }
            minuteDisplay.textContent = pad(pickerMinute);
            document.getElementById('AM_Button').style.backgroundColor = pickerAMPM === 'AM' ? 'var(--Normal_Button)' : 'var(--UI-Buttons-Fields-Color-2)';
            document.getElementById('PM_Button').style.backgroundColor = pickerAMPM === 'PM' ? 'var(--Normal_Button)' : 'var(--UI-Buttons-Fields-Color-2)';

            // Re-apply root text color whenever display updates
            applyRootTextColor();
            }

            function setFromInputValue() {
            const val = document.getElementById('Alarm_Time_Input').value;
            const now = new Date();
            if (val && val.includes(':')) {
                const parts = val.split(':');
                let h = parseInt(parts[0],10);
                let m = parseInt(parts[1],10) || 0;
                if (isNaN(h)) h = now.getHours();
                if (isNaN(m)) m = now.getMinutes();
                use24Hour = (h >= 0 && h <= 23);
                if (use24Hour) {
                pickerHour = h;
                pickerMinute = m;
                pickerAMPM = (h >= 12) ? 'PM' : 'AM';
                } else {
                pickerAMPM = h >= 12 ? 'PM' : 'AM';
                let hour12 = h % 12;
                if (hour12 === 0) hour12 = 12;
                pickerHour = hour12;
                pickerMinute = m;
                }
            } else {
                const h = now.getHours();
                const m = now.getMinutes();
                use24Hour = false;
                pickerAMPM = h >= 12 ? 'PM' : 'AM';
                let hour12 = h % 12;
                if (hour12 === 0) hour12 = 12;
                pickerHour = hour12;
                pickerMinute = m;
            }
            updateDisplays();
            }

            document.getElementById('Alarm_Time_Input').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            setFromInputValue();

            const timePickerWindow = document.getElementById('Time_Picker_Window');
            const alarmWindow = document.getElementById('Alarm_Clock_Window');
            const alarmRect = alarmWindow.getBoundingClientRect();

            timePickerWindow.style.position = 'absolute';
            timePickerWindow.style.left = (alarmRect.right + 10) + 'px';
            timePickerWindow.style.top = alarmRect.top + 'px';
            timePickerWindow.style.right = 'auto';
            timePickerWindow.style.transform = 'scale(0)';
            timePickerWindow.style.transformOrigin = 'top left';
            timePickerWindow.style.display = 'flex';
            timePickerWindow.style.opacity = '0';
            timePickerWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';

            // Ensure text color applied before showing
            applyRootTextColor();

            setTimeout(() => {
                timePickerWindow.style.transform = 'scale(1)';
                timePickerWindow.style.opacity = '1';
            }, 10);
            });

            document.getElementById('Close_Time_Picker_Window').addEventListener('click', function() {
            const timePickerWindow = document.getElementById('Time_Picker_Window');
            timePickerWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            timePickerWindow.style.transform = 'scale(0)';
            timePickerWindow.style.opacity = '0';
            setTimeout(() => {
                timePickerWindow.style.display = 'none';
            }, 300);
            });

            document.getElementById('Toggle_24H').addEventListener('click', function() {
            if (!use24Hour) {
                let h = pickerHour % 12;
                if (pickerAMPM === 'PM') h += 12;
                pickerHour = h;
                use24Hour = true;
                updateDisplays();
            }
            });

            document.getElementById('Toggle_12H').addEventListener('click', function() {
            if (use24Hour) {
                let h24 = pickerHour;
                pickerAMPM = h24 >= 12 ? 'PM' : 'AM';
                let h12 = h24 % 12;
                if (h12 === 0) h12 = 12;
                pickerHour = h12;
                use24Hour = false;
                updateDisplays();
            }
            });

            document.getElementById('Hour_Up').addEventListener('click', function() {
            if (use24Hour) {
                pickerHour = (pickerHour + 1) % 24;
            } else {
                pickerHour = pickerHour === 12 ? 1 : pickerHour + 1;
            }
            updateDisplays();
            });

            document.getElementById('Hour_Down').addEventListener('click', function() {
            if (use24Hour) {
                pickerHour = (pickerHour === 0) ? 23 : pickerHour - 1;
            } else {
                pickerHour = pickerHour === 1 ? 12 : pickerHour - 1;
            }
            updateDisplays();
            });

            document.getElementById('Minute_Up').addEventListener('click', function() {
            pickerMinute = (pickerMinute + 1) % 60;
            updateDisplays();
            });

            document.getElementById('Minute_Down').addEventListener('click', function() {
            pickerMinute = pickerMinute === 0 ? 59 : pickerMinute - 1;
            updateDisplays();
            });

            document.getElementById('AM_Button').addEventListener('click', function() {
            pickerAMPM = 'AM';
            updateDisplays();
            });

            document.getElementById('PM_Button').addEventListener('click', function() {
            pickerAMPM = 'PM';
            updateDisplays();
            });

            document.getElementById('Confirm_Time_Button').addEventListener('click', function() {
            let hour24;
            if (use24Hour) {
                hour24 = pickerHour;
            } else {
                hour24 = pickerHour % 12;
                if (pickerAMPM === 'PM') hour24 += 12;
                if (pickerAMPM === 'AM' && pickerHour === 12) hour24 = 0;
            }
            const timeString = `${pad(hour24)}:${pad(pickerMinute)}`;
            document.getElementById('Alarm_Time_Input').value = timeString;
            document.getElementById('Close_Time_Picker_Window').click();
            });

            document.getElementById('Time_Picker_Window').addEventListener('click', function(e){ e.stopPropagation(); });

            // initial apply to ensure colors are correct if picker exists on load
            applyRootTextColor();
        </script>

        <!-- ============================================================================ -->
        <!-- CALCULATOR -->
        <!-- ============================================================================ -->

        <div class="Window" id="Calculator_Window" role="dialog" aria-modal="true" aria-labelledby="Calculator_Title" style="width:auto;min-width:280px;height:auto;min-height:420px;display:none;">
            <div class="Window_Header" style="user-select:none;cursor:move;">
                <p class="Title" id="Calculator_Title">Calculator</p>
                <div style="display:flex; gap:10px;align-items:center;margin-left:auto;margin-right:10px;">
                    <button
                        id="Toggle_Scientific_Calc"
                        style="position: absolute; left: 80px; width: auto; height:auto; padding:0 10px; background:none; border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"
                    >
                        Scientific
                    </button>
                </div>
                <button class="Close_Button" id="Close_Calculator_Window" aria-label="Close Calculator"></button>
            </div>
            <div class="Content" style="display:flex;flex-direction:column;gap:10px;padding:10px;">
                <div
                    id="Calculator_Display"
                    aria-live="polite"
                    style="width:calc(100% - 40px);height:60px;background-color:var(--UI-Buttons-Fields-Color-2);border-radius:var(--Border-Radius);display:flex;align-items:center;justify-content:flex-end;padding:0 10px;font-size:var(--Main_Text-5);color:var(--Main_Text_Color_1);overflow:hidden;text-overflow:ellipsis;"
                >
                    0
                </div>

                <div id="Scientific_Buttons" style="display:none;grid-template-columns:repeat(4,minmax(50px,1fr));gap:8px;width:calc(100% - 20px);">
                    <button class="calc-btn calc-scientific" data-value="sin" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">sin</button>
                    <button class="calc-btn calc-scientific" data-value="cos" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">cos</button>
                    <button class="calc-btn calc-scientific" data-value="tan" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">tan</button>
                    <button class="calc-btn calc-scientific" data-value="sqrt" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"></button>
                    <button class="calc-btn calc-scientific" data-value="log" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">log</button>
                    <button class="calc-btn calc-scientific" data-value="ln" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">ln</button>
                    <button class="calc-btn calc-scientific" data-value="^" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">x</button>
                    <button class="calc-btn calc-scientific" data-value="pi" style="height:40px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"></button>
                </div>

                <div id="Standard_Buttons" style="display:grid;grid-template-columns:repeat(4,minmax(50px,1fr));gap:8px;width:calc(100% - 20px);">
                    <button class="calc-btn" data-value="C" style="grid-column:span 2;height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">C</button>
                    <button class="calc-btn" data-value="DEL" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">DEL</button>
                    <button class="calc-btn calc-operator" data-value="/" style="height:50px;background-color:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"></button>

                    <button class="calc-btn" data-value="7" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">7</button>
                    <button class="calc-btn" data-value="8" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">8</button>
                    <button class="calc-btn" data-value="9" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">9</button>
                    <button class="calc-btn calc-operator" data-value="*" style="height:50px;background-color:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"></button>

                    <button class="calc-btn" data-value="4" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">4</button>
                    <button class="calc-btn" data-value="5" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">5</button>
                    <button class="calc-btn" data-value="6" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">6</button>
                    <button class="calc-btn calc-operator" data-value="-" style="height:50px;background-color:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;"></button>

                    <button class="calc-btn" data-value="1" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">1</button>
                    <button class="calc-btn" data-value="2" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">2</button>
                    <button class="calc-btn" data-value="3" style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">3</button>
                    <button class="calc-btn calc-operator" data-value="+" style="height:50px;background-color:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">+</button>

                    <button class="calc-btn" data-value="0" style="grid-column:span 2;height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">0</button>
                    <button class="calc-btn" data-value="." style="height:50px;background-color:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">.</button>
                    <button class="calc-btn calc-operator" data-value="=" style="height:50px;background-color:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);cursor:pointer;">=</button>
                </div>
            </div>
        </div>

        <script id="Calculator_Window Script">
            document.getElementById('Open_Calculator_Tool').addEventListener('click', function() {
                const calculatorWindow = document.getElementById('Calculator_Window');
                calculatorWindow.style.position = 'absolute';
                calculatorWindow.style.left = '10px';
                calculatorWindow.style.top = '10px';
                calculatorWindow.style.display = 'flex';
                calculatorWindow.style.transform = 'scale(0)';
                calculatorWindow.style.opacity = '0';
                calculatorWindow.style.transformOrigin = 'center';
                calculatorWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                setTimeout(() => {
                    calculatorWindow.style.transform = 'scale(1)';
                    calculatorWindow.style.opacity = '1';
                }, 10);
            });

            document.getElementById('Close_Calculator_Window').addEventListener('click', function() {
                const calculatorWindow = document.getElementById('Calculator_Window');
                calculatorWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                calculatorWindow.style.transform = 'scale(0)';
                calculatorWindow.style.opacity = '0';
                setTimeout(() => {
                    calculatorWindow.style.display = 'none';
                }, 300);
            });

            // Toggle Scientific Mode
            document.getElementById('Toggle_Scientific_Calc').addEventListener('click', function() {
                const scientificButtons = document.getElementById('Scientific_Buttons');
                const calculatorWindow = document.getElementById('Calculator_Window');
                const toggleBtn = document.getElementById('Toggle_Scientific_Calc');

                if (scientificButtons.style.display === 'none' || scientificButtons.style.display === '') {
                    scientificButtons.style.display = 'grid';
                    calculatorWindow.style.height = '540px';
                    toggleBtn.textContent = 'Standard';
                } else {
                    scientificButtons.style.display = 'none';
                    calculatorWindow.style.height = '420px';
                    toggleBtn.textContent = 'Scientific';
                }
            });

            (function() {
                let currentValue = '0';
                let previousValue = '';
                let operation = null;
                let shouldResetDisplay = false;

                const display = document.getElementById('Calculator_Display');
                const buttons = document.querySelectorAll('.calc-btn');

                function updateDisplay() {
                    display.textContent = currentValue;
                }

                function clear() {
                    currentValue = '0';
                    previousValue = '';
                    operation = null;
                    shouldResetDisplay = false;
                    updateDisplay();
                }

                function deleteLast() {
                    if (currentValue.length > 1) {
                        currentValue = currentValue.slice(0, -1);
                    } else {
                        currentValue = '0';
                    }
                    updateDisplay();
                }

                function appendNumber(number) {
                    if (shouldResetDisplay) {
                        currentValue = number;
                        shouldResetDisplay = false;
                    } else {
                        if (currentValue === '0' && number !== '.') {
                            currentValue = number;
                        } else if (number === '.' && currentValue.includes('.')) {
                            return;
                        } else {
                            currentValue += number;
                        }
                    }
                    updateDisplay();
                }

                function setOperation(op) {
                    if (operation !== null) calculate();
                    previousValue = currentValue;
                    operation = op;
                    shouldResetDisplay = true;
                }

                function calculate() {
                    if (operation === null || previousValue === '') return;

                    const prev = parseFloat(previousValue);
                    const current = parseFloat(currentValue);
                    let result = 0;

                    switch (operation) {
                        case '+':
                            result = prev + current;
                            break;
                        case '-':
                            result = prev - current;
                            break;
                        case '*':
                            result = prev * current;
                            break;
                        case '/':
                            result = current !== 0 ? prev / current : 'Error';
                            break;
                    }

                    currentValue = result.toString();
                    operation = null;
                    previousValue = '';
                    shouldResetDisplay = true;
                    updateDisplay();
                }

                function scientificFunction(func) {
                    const current = parseFloat(currentValue);
                    let result = 0;

                    switch (func) {
                        case 'sin':
                            result = Math.sin(current * Math.PI / 180);
                            break;
                        case 'cos':
                            result = Math.cos(current * Math.PI / 180);
                            break;
                        case 'tan':
                            result = Math.tan(current * Math.PI / 180);
                            break;
                        case 'sqrt':
                            result = Math.sqrt(current);
                            break;
                        case 'log':
                            result = Math.log10(current);
                            break;
                        case 'ln':
                            result = Math.log(current);
                            break;
                        case '^':
                            result = Math.pow(current, 2);
                            break;
                        case 'pi':
                            result = Math.PI;
                            break;
                    }

                    currentValue = result.toString();
                    shouldResetDisplay = true;
                    updateDisplay();
                }

                buttons.forEach(button => {
                    button.addEventListener('click', () => {
                        const value = button.getAttribute('data-value');

                        if (value === 'C') {
                            clear();
                        } else if (value === 'DEL') {
                            deleteLast();
                        } else if (value === '=') {
                            calculate();
                        } else if (['+', '-', '*', '/'].includes(value)) {
                            setOperation(value);
                        } else if (['sin', 'cos', 'tan', 'sqrt', 'log', 'ln', '^', 'pi'].includes(value)) {
                            scientificFunction(value);
                        } else {
                            appendNumber(value);
                        }
                    });
                });
            })();
        </script>

        <!-- ============================================================================ -->
        <!-- TOOL WINDOW -->
        <!-- ============================================================================ -->

        <div class="Window" id="Tool_Window" style="width:300px; height:200px; display: none;">
            <div class="Window_Header">
                <p class="Title">Tools</p>
                <button class="Close_Button" id="Close_Tool_Window"></button>
            </div>
            <div class="Content">
                <div class="Tools">
                    <button id="Open_Alarm_Clock_Tool" style="width: 100%; height: 30px;">Alarm Clock</button>
                    <button id="Open_Calculator_Tool" style="width: 100%; height: 30px;">Calculator</button>
                    <button style="width: 100%; height: 30px;"></button>
                    <button style="width: 100%; height: 30px;"></button>
                    <button style="width: 100%; height: 30px;"></button>
                </div>
            </div>
        </div>

        <script id="Tool_Window Script">
            document.getElementById('Side_Bar_Tool').addEventListener('click', function() {
                const toolWindow = document.getElementById('Tool_Window');
                toolWindow.style.display = 'flex';
                toolWindow.style.transform = 'scale(0)';
                toolWindow.style.opacity = '0';
                toolWindow.style.transformOrigin = 'top left';
                toolWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                setTimeout(() => {
                    toolWindow.style.transform = 'scale(1)';
                    toolWindow.style.opacity = '1';
                }, 10);
            });

            document.getElementById('Close_Tool_Window').addEventListener('click', function() {
                const toolWindow = document.getElementById('Tool_Window');
                toolWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                toolWindow.style.transform = 'scale(0)';
                toolWindow.style.opacity = '0';
                setTimeout(() => {
                    toolWindow.style.display = 'none';
                }, 300);
            });

            // Parent Tool Window to Side Bar Tool button
            const toolWindow = document.getElementById('Tool_Window');
            const sideBarTool = document.getElementById('Side_Bar_Tool');

            function positionToolWindow() {
                const buttonRect = sideBarTool.getBoundingClientRect();
                toolWindow.style.position = 'absolute';
                toolWindow.style.left = (buttonRect.right + 10) + 'px';
                toolWindow.style.top = buttonRect.top + 'px';
            }

            // Position window when opened
            document.getElementById('Side_Bar_Tool').addEventListener('click', function() {
                positionToolWindow();
            });

            // Position Alarm Clock Window at top left when opened
            document.getElementById('Open_Alarm_Clock_Tool').addEventListener('click', function() {
                const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
                alarmClockWindow.style.position = 'absolute';
                alarmClockWindow.style.left = '10px';
                alarmClockWindow.style.top = '10px';
            });

            let alarms = [];
            let alarmCheckInterval;

            // Open Alarm Clock Window
            document.getElementById('Open_Alarm_Clock_Tool').addEventListener('click', function() {
                const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
                alarmClockWindow.style.display = 'flex';
                alarmClockWindow.style.transform = 'scale(0)';
                alarmClockWindow.style.opacity = '0';
                alarmClockWindow.style.transformOrigin = 'center';
                alarmClockWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                setTimeout(() => {
                    alarmClockWindow.style.transform = 'scale(1)';
                    alarmClockWindow.style.opacity = '1';
                }, 10);
                // ensure alarms UI rendered when opened
                renderAlarms();
            });

            // Close Alarm Clock Window
            document.getElementById('Close_Alarm_Clock_Window').addEventListener('click', function() {
                const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
                alarmClockWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                alarmClockWindow.style.transform = 'scale(0)';
                alarmClockWindow.style.opacity = '0';
                setTimeout(() => {
                    alarmClockWindow.style.display = 'none';
                }, 300);
            });

            // Update display time and AM/PM styling together
            function updateAlarmDisplayTime() {
                const now = new Date();
                let hours = now.getHours();
                const minutes = now.getMinutes().toString().padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12;

                document.getElementById('Alarm_Display_Time').textContent = `${hours}:${minutes} ${ampm}`;
            }

            function styleAMPM() {
                const displayTime = document.getElementById('Alarm_Display_Time');
                const timeText = displayTime.textContent;
                const ampmMatch = timeText.match(/(AM|PM)/);
                if (ampmMatch) {
                    const timePart = timeText.replace(/(AM|PM)/, '');
                    displayTime.innerHTML = `${timePart}<span style="font-size: var(--Main_Text);">${ampmMatch[0]}</span>`;
                }
            }

            // initialize and poll once per second
            updateAlarmDisplayTime();
            styleAMPM();
            setInterval(() => {
                updateAlarmDisplayTime();
                styleAMPM();
            }, 1000);

            // Set Alarm
            document.getElementById('Set_Alarm_Button').addEventListener('click', function() {
                const timeInput = document.getElementById('Alarm_Time_Input').value;
                if (!timeInput) return;

                const alarm = {
                    id: Date.now(),
                    time: timeInput,
                    active: true
                };

                alarms.push(alarm);
                renderAlarms();
                startAlarmCheck();
            });

            // Render alarms
            function renderAlarms() {
                const alarmList = document.getElementById('Alarm_List');
                alarmList.innerHTML = '';

                const globalSoundSelect = document.getElementById('Alarm_Sound_Select');
                const defaultSound = document.getElementById('Selected_Alarm_Sound')?.value || (globalSoundSelect?.value);

                function getSoundLabel(src) {
                    if (!src) return 'No sound';
                    if (globalSoundSelect) {
                        for (const opt of globalSoundSelect.options) {
                            if (opt.value === src) return opt.textContent;
                        }
                    }
                    return src.split('/').pop().replace(/\.[a-z0-9]+$/i,'');
                }

                alarms.forEach(alarm => {
                    if (!alarm.sound) alarm.sound = defaultSound;
                    const alarmElement = document.createElement('div');
                    alarmElement.style.cssText = 'width:100%;background-color:var(--UI-Buttons-Fields-Color-2);display:flex;flex-direction:column;gap:6px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.08);border-radius:var(--Border-Radius);box-sizing:border-box;';

                    (function formatDisplayTime(){
                        const parts = (alarm.time || '').split(':');
                        if (parts.length === 2) {
                            let h24 = parseInt(parts[0],10);
                            const m = parts[1];
                            if (!isNaN(h24)) {
                                const ampm = h24 >= 12 ? 'PM' : 'AM';
                                let h12 = h24 % 12;
                                if (h12 === 0) h12 = 12;
                                alarm.displayTime12 = h12 + ':' + m + ' ' + ampm;
                            }
                        }
                        if (!alarm.displayTime12) alarm.displayTime12 = alarm.time;
                    })();

                    (function computeRemaining(){
                        const now = new Date();
                        const parts = (alarm.time || '').split(':');
                        if (parts.length === 2) {
                            let h = parseInt(parts[0],10);
                            let m = parseInt(parts[1],10);
                            if (!isNaN(h) && !isNaN(m)) {
                                const target = new Date();
                                target.setHours(h, m, 0, 0);
                                if (target <= now) target.setDate(target.getDate() + 1);
                                const diff = target - now;
                                const hrs = Math.floor(diff / 3600000);
                                const mins = Math.floor((diff % 3600000) / 60000);
                                alarm.remainingLabel = (hrs > 0 ? hrs + 'h ' : '') + mins + 'm remaining';
                            }
                        }
                        if (!alarm.remainingLabel) alarm.remainingLabel = '';
                    })();

                    const soundLabel = getSoundLabel(alarm.sound);

                    alarmElement.innerHTML = `
                        <div style="display:flex;justify-content:space-between;align-items:center;">
                            <span style="color:var(--Main_Text_Color_1);font-size:var(--Main_Text);">${alarm.time}</span>
                            <div style="display:flex;align-items:center;gap:10px;">
                                <button onclick="event.stopPropagation();(function(a){ if(a && a.sound){ const au=new Audio(a.sound); au.currentTime=0; au.play(); }})(alarms.find(x=>x.id===${alarm.id}))" style="background:none;border:none;color:var(--Main_Text_Color_1);cursor:pointer;font-size:var(--Main_Text);">Play</button>
                                <button onclick="event.stopPropagation(); deleteAlarm(${alarm.id})" style="background:none;border:none;color:var(--Main_Text_Color_1);cursor:pointer;font-size:var(--Main_Text);">Delete</button>
                            </div>
                        </div>
                        <div style="display:flex;justify-content:space-between;font-size:var(--Main_Text);color:var(--Main_Text_Color_2);">
                            <span>${alarm.displayTime12 || alarm.time}</span>
                            <span style="opacity:.7;">${alarm.remainingLabel}</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:6px;">
                            <span style="font-size:var(--Main_Text);color:var(--Main_Text_Color_2);">Sound:</span>
                            <span style="font-size:var(--Main_Text);color:var(--Main_Text_Color_1);">${soundLabel}</span>
                        </div>
                    `;

                    alarmList.appendChild(alarmElement);
                });

                // Patch startAlarmCheck once
                if (!window.__alarmSoundPatchApplied && typeof startAlarmCheck === 'function') {
                    window.__alarmSoundPatchApplied = true;
                    const originalStart = startAlarmCheck;
                    startAlarmCheck = function() {
                        if (alarmCheckInterval) return;
                        originalStart();
                    };
                }
            }

            // Advanced alarm action dialog, audio loop and snooze/dismiss handlers
            (function() {
                const SNOOZE_MINUTES_DEFAULT = 5;
                function pad(n){ return n.toString().padStart(2,'0'); }
                function addMinutesToTimeString(timeStr, addMinutes) {
                    const [hStr, mStr] = timeStr.split(':');
                    let h = parseInt(hStr,10);
                    let m = parseInt(mStr,10);
                    if (isNaN(h) || isNaN(m)) return timeStr;
                    m += addMinutes;
                    while (m >= 60) { m -= 60; h = (h + 1) % 24; }
                    return `${pad(h)}:${pad(m)}`;
                }

                window.showAlarmNotification = function(alarm) {
                    if (!alarm) return;

                    // Stop audio for other alarms
                    alarms.forEach(a => {
                        if (a !== alarm && a._audio) {
                            try { a._audio.pause(); a._audio.currentTime = 0; } catch(e){}
                            a._audio = null;
                        }
                    });

                    // Remove existing dialogs
                    const existingContainer = document.getElementById('Alarm_Action_Dialog_Container');
                    if (existingContainer) {
                        existingContainer.querySelectorAll('.Alarm_Action_Dialog').forEach(d => d.remove());
                    }

                    if (alarm._audio) {
                        try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                        alarm._audio = null;
                    }

                    if (alarm.sound) {
                        try {
                            const audio = new Audio(alarm.sound);
                            audio.loop = true;
                            alarm._audio = audio;
                            audio.play().catch(()=>{});
                        } catch(e){}
                    }

                    let container = document.getElementById('Alarm_Action_Dialog_Container');
                    if (!container) {
                        container = document.createElement('div');
                        container.id = 'Alarm_Action_Dialog_Container';
                        container.style.cssText = 'position:fixed;bottom:10px;right:10px;display:flex;flex-direction:column;gap:12px;z-index:10000;';
                        document.body.appendChild(container);
                    }

                    const dialog = document.createElement('div');
                    dialog.className = 'Alarm_Action_Dialog';
                    dialog.setAttribute('role','dialog');
                    dialog.setAttribute('aria-modal','true');
                    dialog.style.cssText = 'width:260px;background:var(--UI-Buttons-Fields-Color-1);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);border-radius:var(--Border-Radius);box-shadow:0 6px 18px rgba(0,0,0,.45);display:flex;flex-direction:column;gap:14px;padding:14px 16px;animation:fadeIn .25s;position:relative;';

                    const header = document.createElement('div');
                    header.style.cssText = 'display:flex;flex-direction:column;gap:4px;';
                    const title = document.createElement('span');
                    title.textContent = 'Alarm';
                    title.style.cssText = 'font-weight:600;letter-spacing:.5px;';
                    const timeLine = document.createElement('span');
                    timeLine.style.opacity = '.8';
                    timeLine.textContent = `Time: ${alarm.time}`;
                    header.appendChild(title);
                    header.appendChild(timeLine);

                    const soundRow = document.createElement('div');
                    soundRow.style.cssText = 'display:flex;justify-content:space-between;font-size:var(--Main_Text);opacity:.75;';
                    soundRow.innerHTML = `<span>Sound</span><span>${(function(){
                        const src = alarm.sound || '';
                        const sel = document.getElementById('Alarm_Sound_Select');
                        if (sel) { for (const opt of sel.options) if (opt.value === src) return opt.textContent; }
                        return src ? src.split('/').pop().replace(/\.[a-z0-9]+$/i,'') : 'Default';
                    })()}</span>`;

                    const actions = document.createElement('div');
                    actions.style.cssText = 'display:flex;gap:10px;';
                    const snoozeBtn = document.createElement('button');
                    snoozeBtn.textContent = `Snooze ${SNOOZE_MINUTES_DEFAULT}m`;
                    snoozeBtn.style.cssText = 'flex:1;height:34px;background:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);cursor:pointer;';
                    const dismissBtn = document.createElement('button');
                    dismissBtn.textContent = 'Dismiss';
                    dismissBtn.style.cssText = 'flex:1;height:34px;background:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);cursor:pointer;';
                    actions.appendChild(snoozeBtn);
                    actions.appendChild(dismissBtn);

                    dialog.appendChild(header);
                    dialog.appendChild(soundRow);
                    dialog.appendChild(actions);
                    container.appendChild(dialog);

                    function removeDialog() {
                        dialog.style.opacity = '0';
                        dialog.style.transform = 'translateY(6px)';
                        dialog.style.transition = 'opacity .25s, transform .25s';
                        setTimeout(()=> dialog.remove(), 250);
                    }

                    snoozeBtn.addEventListener('click', () => {
                        const newTime = addMinutesToTimeString(alarm.time, SNOOZE_MINUTES_DEFAULT);
                        alarm.time = newTime;
                        alarm.active = true;

                        if (alarm._audio) {
                            try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                            alarm._audio = null;
                        }
                        if (alarm._timeoutId) { clearTimeout(alarm._timeoutId); alarm._timeoutId = null; }

                        (function schedule(a){
                            const now = new Date();
                            const parts = a.time.split(':');
                            if (parts.length !== 2) return;
                            const h = parseInt(parts[0],10);
                            const m = parseInt(parts[1],10);
                            if (isNaN(h)||isNaN(m)) return;
                            const target = new Date();
                            target.setHours(h,m,0,0);
                            if (target <= now) target.setDate(target.getDate()+1);
                            const delay = target - now;
                            a._timeoutId = setTimeout(()=> {
                                if (a.active) {
                                    try { 
                                        if (a.sound) {
                                            const audio = new Audio(a.sound);
                                            audio.loop = true;
                                            a._audio = audio;
                                            audio.play().catch(()=>{});
                                        }
                                    } catch(e){}
                                    window.showAlarmNotification(a);
                                }
                            }, delay);
                        })(alarm);

                        if (typeof renderAlarms === 'function') renderAlarms();
                        removeDialog();
                    });

                    dismissBtn.addEventListener('click', () => {
                        alarm.active = false;
                        if (alarm._timeoutId) { clearTimeout(alarm._timeoutId); alarm._timeoutId = null; }
                        if (alarm._audio) {
                            try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                            alarm._audio = null;
                        }
                        if (typeof renderAlarms === 'function') renderAlarms();
                        removeDialog();
                    });
                };
            })();

            window.deleteAlarm = function(id) {
                alarms = alarms.filter(alarm => alarm.id !== id);
                renderAlarms();
                if (alarms.length === 0) {
                    clearInterval(alarmCheckInterval);
                    alarmCheckInterval = null;
                }
            };

            function startAlarmCheck() {
                if (alarmCheckInterval) return;
                alarmCheckInterval = setInterval(() => {
                    const now = new Date();
                    const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                    alarms.forEach(alarm => {
                        if (alarm.active && alarm.time === currentTime) {
                            showAlarmNotification(alarm);
                        }
                    });
                }, 1000);
            }
        </script>
    </div>



    <script id="ESSENTIALS Script">

        // ============================================================================
        // ESSENTIALS
        // ============================================================================

        // ============================================================================
        // START
        // ============================================================================

        // Disable default Android time picker
        document.getElementById('Alarm_Time_Input').addEventListener('focus', function(e) {
            e.target.blur();
            e.preventDefault();
        });

        document.getElementById('Alarm_Time_Input').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
        });

        // Make time input readonly to prevent native picker
        document.getElementById('Alarm_Time_Input').setAttribute('readonly', 'readonly');

        // Override any system alarm dialogs
        window.addEventListener('beforeunload', function(e) {
            delete e['returnValue'];
        });

        // Disable default alarm notifications
        if ('Notification' in window) {
            Notification.requestPermission().then(function(permission) {
                if (permission === 'denied') {
                    console.log('Notification permission denied');
                }
            });
        }

        // Disable pull-to-refresh
        document.body.style.overscrollBehavior = 'none';
        
        // Disable default touch actions (pinch zoom, double-tap zoom)
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
            e.preventDefault();
            }
        }, { passive: false });

        // Disable context menu (long press)
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Disable text selection on long press
        document.body.style.webkitUserSelect = 'none';
        document.body.style.userSelect = 'none';
        document.body.style.webkitTouchCallout = 'none';

        // ============================================================================
        // CLOSING WINDOWS
        // ============================================================================

        // Close windows when clicking outside
        document.addEventListener('click', function(event) {
            const windows = document.querySelectorAll('.Window');
            const sideBarButtons = document.querySelectorAll('.Side_Bar button');
            
            // Check if click is outside all windows and sidebar buttons
            let clickedInsideWindow = false;
            let clickedSideBarButton = false;
            
            windows.forEach(window => {
            if (window.contains(event.target)) {
                clickedInsideWindow = true;
            }
            });
            
            sideBarButtons.forEach(button => {
            if (button.contains(event.target)) {
                clickedSideBarButton = true;
            }
            });
            
            // If click is outside, close all visible windows
            if (!clickedInsideWindow && !clickedSideBarButton) {
            windows.forEach(window => {
                if (window.style.display === 'flex') {
                window.style.display = 'none';
                }
            });
            }
        });
        document.addEventListener('click', function(event) {
            const windows = document.querySelectorAll('.Window');
            const sideBarButtons = document.querySelectorAll('.Side_Bar button');
            
            // Check if click is outside all windows and sidebar buttons
            let clickedInsideWindow = false;
            let clickedSideBarButton = false;
            
            windows.forEach(window => {
                if (window.contains(event.target)) {
                    clickedInsideWindow = true;
                }
            });
            
            sideBarButtons.forEach(button => {
                if (button.contains(event.target)) {
                    clickedSideBarButton = true;
                }
            });
            
            // If click is outside, close all visible windows
            if (!clickedInsideWindow && !clickedSideBarButton) {
                windows.forEach(window => {
                    if (window.style.display === 'flex') {
                        window.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                        window.style.transform = 'scale(0)';
                        window.style.opacity = '0';
                        
                        setTimeout(() => {
                            window.style.display = 'none';
                        }, 300);
                    }
                });
            }
        });

        // ============================================================================
        // WINDOW DRAGGING SYSTEM
        // ============================================================================

        let windowElement = null;
        let isDragging = false;
        let offsetX = 0;
        let offsetY = 0;
        let nextZIndex = 10;
        let animationFrameId = null;
        let targetX = 0;
        let targetY = 0;

        const windows = Array.from(document.querySelectorAll('.Window'));

        // ---- Helper Functions ----

        function snapToGrid(x, y, gridSize = 10) {
            const snappedX = Math.round(x / gridSize) * gridSize;
            const snappedY = Math.round(y / gridSize) * gridSize;
            return { x: snappedX, y: snappedY };
        }

        function clamp(val, min, max) {
            return Math.max(min, Math.min(max, val));
        }

        function lerp(start, end, factor) {
            return start + (end - start) * factor;
        }

        function setWindowPosition(x, y, snap = false) {
            const winRect = windowElement.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            const maxX = bodyRect.width - winRect.width;
            const maxY = bodyRect.height - winRect.height;
            
            if (snap) {
            const snapped = snapToGrid(x, y);
            windowElement.style.transition = 'left 0.2s cubic-bezier(0, 1, 0, 1), top 0.2s cubic-bezier(0, 1, 0, 1)';
            windowElement.style.left = clamp(snapped.x, 0, maxX) + 'px';
            windowElement.style.top = clamp(snapped.y, 0, maxY) + 'px';
            } else {
            windowElement.style.transition = 'none';
            targetX = clamp(x, 0, maxX);
            targetY = clamp(y, 0, maxY);
            }
        }

        function smoothUpdate() {
            if (!isDragging || !windowElement) {
            animationFrameId = null;
            return;
            }

            const currentX = parseFloat(windowElement.style.left) || 0;
            const currentY = parseFloat(windowElement.style.top) || 0;
            
            const newX = lerp(currentX, targetX, 0.3);
            const newY = lerp(currentY, targetY, 0.3);
            
            windowElement.style.left = newX + 'px';
            windowElement.style.top = newY + 'px';

            animationFrameId = requestAnimationFrame(smoothUpdate);
        }

        function bringToFront(el) {
            if (!el) return;
            el.style.zIndex = nextZIndex++;
        }

        // ---- Event Handlers ----

        windows.forEach(win => {
            const header = win.querySelector('.Window_Header');
            if (!header) return;

            header.addEventListener('mousedown', (e) => {
            windowElement = win;
            isDragging = true;
            const rect = windowElement.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            targetX = rect.left;
            targetY = rect.top;
            document.body.style.userSelect = 'none';
            
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(smoothUpdate);
            }
            });

            header.addEventListener('touchstart', (e) => {
            if (e.touches.length !== 1) return;
            windowElement = win;
            isDragging = true;
            const rect = windowElement.getBoundingClientRect();
            offsetX = e.touches[0].clientX - rect.left;
            offsetY = e.touches[0].clientY - rect.top;
            targetX = rect.left;
            targetY = rect.top;
            document.body.style.userSelect = 'none';
            
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(smoothUpdate);
            }
            });

            // Bring to front on interaction
            win.addEventListener('mousedown', () => bringToFront(win));
            win.addEventListener('touchstart', () => bringToFront(win));
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !windowElement) return;
            const x = e.clientX - offsetX;
            const y = e.clientY - offsetY;
            setWindowPosition(x, y, false);
            windowElement.style.position = 'absolute';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging && windowElement) {
            const rect = windowElement.getBoundingClientRect();
            setWindowPosition(rect.left, rect.top, true);
            }
            isDragging = false;
            windowElement = null;
            document.body.style.userSelect = '';
        });

        document.addEventListener('touchmove', (e) => {
            if (!isDragging || !windowElement || e.touches.length !== 1) return;
            const x = e.touches[0].clientX - offsetX;
            const y = e.touches[0].clientY - offsetY;
            setWindowPosition(x, y, false);
            windowElement.style.position = 'absolute';
        });

        document.addEventListener('touchend', () => {
            if (isDragging && windowElement) {
            const rect = windowElement.getBoundingClientRect();
            setWindowPosition(rect.left, rect.top, true);
            }
            isDragging = false;
            windowElement = null;
            document.body.style.userSelect = '';
        });

       


    </script>
</body>
</html>

