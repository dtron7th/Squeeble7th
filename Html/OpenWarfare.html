<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blaack Battles</title>

    <link rel="stylesheet" href="../CSS/UI.css">

</head>
<body>
    <style aria-label="Body_Style">
        body {
            background-color: rgb(0, 0, 0);
            width: 100dvw;
            height: 100dvh;
            display: flex;
            justify-content: center;
        }
    </style>

    <div class="Main">
        <div class="Top_Menu">
            <div class="Menu_Options">
                <a href="/Index.html" class="Menu_Link">Black Battles</a>
                <a href="/Html/Chat.html" class="Menu_Link">Chat</a>
                <a href="/Html/Armies.html" class="Menu_Link">Armies</a>
                <a href="/Html/News.html" class="Menu_Link">News</a>
                <a href="/Html/OpenWarfare.html" class="Menu_Link">Open Warfare</a>
            </div>
            <style>
                .Top_Menu {
                    width: 100dvw;
                    height: 40px;
                    border-bottom: 1px solid var(--Main_Border);
                    display: flex;
                    flex-direction: row;
                    justify-content: center;
                    align-items: center;
                }

                .Menu_Options {
                    display: flex;
                    gap: 50px;
                }

                .Top_Menu > .Menu_Options> a {
                    font-size: var(--Main_Text_1);
                }

            </style>
        </div>
        <section class="OpenWarfare_Page_1">

            <style aria-label="Page_1_Style">
                .OpenWarfare_Page_1 {
                    width: 100dvw;
                    height: 100dvh;
                    scroll-snap-align: start;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                }
            
            </style>

            <div class="CAD_Splash_Screen" style="display: none;">
                <img class="Splash_Screen_Wallpaper" src="/Images/Wallpaper/images.jpg" alt="">
                <img class="Splash_Screen_Logo" src="/Images/Icons/Logo/Black+Battles+Logo+Transparent.png" alt="">

                <div class="Splash_Screen_Progress_Bar">
                    
                    <div id="splash_progress_fill"></div>

                    <style>
                        .Splash_Screen_Progress_Bar {
                            position: absolute;
                            bottom: 10px;
                            
                            width: calc(100% - 20px);
                            height: 10px;
                            background: var(--Progress_Bar_Background);
                            border-radius: 12px;
                            overflow: hidden;
                            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                        }
                        #splash_progress_fill {
                            height: 100%;
                            width: 0%;
                            background: var(--Progress_Bar_Fill);
                            transition: width 0.4s;
                        }
                    </style>

                    <script>
                        // Animate progress bar in sections over ~2 seconds
                        const fill = document.getElementById('splash_progress_fill');
                        let progress = 0;
                        const steps = [20, 45, 70, 100];
                        const delays = [400, 500, 500, 600]; // ms, total ~2s
                        function animateStep(i) {
                            if (i >= steps.length) return;
                            setTimeout(function() {
                                progress = steps[i];
                                fill.style.width = progress + '%';
                                animateStep(i + 1);
                            }, delays[i]);
                        }
                        animateStep(0);
                    </script>
                </div>
                

                <style aria-label="CAD_Splash_Screen_Style">
                    .CAD_Splash_Screen {
                        position: absolute;
                        width: 400px;
                        height: 300px;
                        background-color: aquamarine;
                        border-radius: var(--Border-Radius-3);
                        overflow: hidden;
                        display: flex;
                        justify-content: center;
                    }

                    .CAD_Splash_Screen > .Splash_Screen_Wallpaper {
                        width: 100%;
                        height: 100%;
                        object-fit: cover;
                    }

                    .CAD_Splash_Screen > .Splash_Screen_Title {
                        position: absolute;
                        top: 10px;
                        left: 10px;
                        font-size: var(--Main_Text_4);
                        color: var(--Main_Text_Color);
                        text-shadow: 1px 1px 2px black;
                    }

                    .CAD_Splash_Screen > .Splash_Screen_Logo {
                        position: absolute;
                        width: 150px;
                        height: 150px;
                        top: 0px;
                        left: 0px;
                        object-fit: contain;
                        opacity: 0.8;
                    }


                </style>


            </div>

            <div class="Bottom_Buttons">
                <button class="Create_Drawing">Create Drawing</button>
                <button class="Create_Nation">Create Nation</button>

                
                <style>
                    .Bottom_Buttons {
                        position: absolute;
                        bottom: 10px;
                        width: calc(100% - 20px);
                        display: flex;
                        justify-content: center;
                        gap: 10px;
                    }

                    .Bottom_Buttons > button {
                        width: 100%;
                        height: 30px;
                        
                    }
                </style>

                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        const createDrawingBtn = document.querySelector('.Create_Drawing');
                        const splashScreen = document.querySelector('.CAD_Splash_Screen');
                        const splashProgressFill = document.getElementById('splash_progress_fill');
                        const cadProgram = document.querySelector('.CAD_Program');
                        if (createDrawingBtn && splashScreen && splashProgressFill && cadProgram) {
                            createDrawingBtn.addEventListener('click', function() {
                                splashScreen.style.display = '';
                                // Reset progress bar to start from the beginning
                                splashProgressFill.style.width = '0%';
                                // Animate progress bar again
                                let progress = 0;
                                const steps = [20, 45, 70, 100];
                                const delays = [400, 500, 500, 600];
                                function animateStep(i) {
                                    if (i >= steps.length) return;
                                    setTimeout(function() {
                                        progress = steps[i];
                                        splashProgressFill.style.width = progress + '%';
                                        if (progress === 100) {
                                            // Wait 1 second after progress bar is full, then show CAD program
                                            setTimeout(function() {
                                                splashScreen.style.display = 'none';
                                                cadProgram.style.display = '';
                                            }, 1000);
                                        }
                                        animateStep(i + 1);
                                    }, delays[i]);
                                }
                                animateStep(0);
                            });
                        }
                    });

                    

                </script>
            </div>

        </section>
        <div class="CAD_Program" style="display: none;">
            <script>
                // Landscape orientation behavior removed.
                // CAD will no longer auto-rotate or add landscape classes.
            </script>
            <style>
                .CAD_Program {
                    position: absolute;
                    width: 100dvw;
                    height: 100dvh;
                    top: 0;
                    left: 0;
                    background-color: rgb(120, 172, 35);
                    transition: none;
                }
                /* landscape-orientation rules removed */
            </style>

            <style>
                .CAD_Tools {
                    position: absolute;
                    top: 10px;
                    left: 10px;
                    height: 100%;
                    z-index: 10;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                    justify-content: center;
                    align-items: center;
                }
                .CAD_Tools > button {
                    width: 30px;
                    height: 30px;
                    background-color: var(--UI-Buttons-Fields-Color-3);
                }

                .CAD_Tools > button > img {
                    width: 20px;
                    height: 20px;
                    
                }
            </style>

            <div class="CAD_Tools">
                <button class="CAD_Tools_Pan" onclick="setTool('Pan')"><img src="/Images/Icons/CAD_Program/minimalist CAD pan t.png" alt=""></button>
                <br>
                <button class="CAD_Tools_Line" onclick="setTool('Line')"><img src="/Images/Icons/CAD_Program/minimalist line tool.png" alt=""></button>
                <button class="CAD_Tools_Square" onclick="setTool('Square')"><img src="/Images/Icons/CAD_Program/minimalist CAD square.png" alt=""></button>
                <button class="CAD_Tools_Circle" onclick="setTool('Circle')"><img src="/Images/Icons/CAD_Program/minimalist CAD circle.png" alt=""></button>

            </div>
            <canvas id="cad_canvas" class="CAD_Canvas" tabindex="0"></canvas>
            <style>
                .CAD_Canvas {
                    position: absolute;
                    width: 100dvw;
                    height: 100dvh;
                    top: 0;
                    left: 0;
                    background-color: rgb(14, 35, 53);
                    cursor: crosshair;
                    display: block;
                }
            </style>
            <script>
                // CAD Program Skeleton
                window.addEventListener('DOMContentLoaded', function() {
                    const canvas = document.getElementById('cad_canvas');
                    const ctx = canvas.getContext('2d');
                    let tool = 'pan';
                    let drawing = false;
                    let start = {x:0, y:0};
                    let end = {x:0, y:0};
                    let pan = {x:0, y:0};
                    let offset = {x:0, y:0};
                    let zoom = 1;
                    let shapes = [];
                    let lastPos = {x:0, y:0};
                    function resizeCanvas() {
                        canvas.width = window.innerWidth;
                        canvas.height = window.innerHeight;
                        drawAll();
                    }
                    window.addEventListener('resize', resizeCanvas);
                    resizeCanvas();
                    function setTool(t) {
                        tool = t;
                        document.getElementById('cad_status').textContent = 'Tool: ' + t;
                        if (t === 'clear') {
                            shapes = [];
                            drawAll();
                            tool = 'pan';
                            document.getElementById('cad_status').textContent = 'Tool: pan';
                        }
                    }
                    window.setTool = setTool;
                    function toWorld(x, y) {
                        return {
                            x: (x - offset.x) / zoom,
                            y: (y - offset.y) / zoom
                        };
                    }
                    function toScreen(x, y) {
                        return {
                            x: x * zoom + offset.x,
                            y: y * zoom + offset.y
                        };
                    }
                    function drawAll() {
                        ctx.clearRect(0,0,canvas.width,canvas.height);
                        // Draw grid
                        drawGrid();
                        // Draw shapes
                        for (const s of shapes) {
                            ctx.save();
                            ctx.strokeStyle = s.color || '#000';
                            ctx.lineWidth = 2;
                            if (s.type === 'line') {
                                const a = toScreen(s.a.x, s.a.y);
                                const b = toScreen(s.b.x, s.b.y);
                                ctx.beginPath();
                                ctx.moveTo(a.x, a.y);
                                ctx.lineTo(b.x, b.y);
                                ctx.stroke();
                            } else if (s.type === 'rect') {
                                const a = toScreen(s.a.x, s.a.y);
                                const b = toScreen(s.b.x, s.b.y);
                                ctx.strokeRect(a.x, a.y, b.x - a.x, b.y - a.y);
                            } else if (s.type === 'circle') {
                                const c = toScreen(s.c.x, s.c.y);
                                const r = s.r * zoom;
                                ctx.beginPath();
                                ctx.arc(c.x, c.y, r, 0, Math.PI * 2);
                                ctx.stroke();
                            }
                            ctx.restore();
                        }
                    }
                    function drawGrid() {
                        const gridSpacing = 50 * zoom;
                        ctx.save();
                        ctx.strokeStyle = 'rgba(255,255,255,0.2)';
                        ctx.lineWidth = 1;
                        // vertical lines
                        let startX = offset.x % gridSpacing;
                        for (let x = startX; x < canvas.width; x += gridSpacing) {
                            ctx.beginPath();
                            ctx.moveTo(x, 0);
                            ctx.lineTo(x, canvas.height);
                            ctx.stroke();
                        }
                        // horizontal lines
                        let startY = offset.y % gridSpacing;
                        for (let y = startY; y < canvas.height; y += gridSpacing) {
                            ctx.beginPath();
                            ctx.moveTo(0, y);
                            ctx.lineTo(canvas.width, y);
                            ctx.stroke();
                        }
                        ctx.restore();
                    }
                    canvas.addEventListener('mousedown', (e) => {
                        lastPos = {x: e.clientX, y: e.clientY};
                        if (tool === 'pan') {
                            drawing = true;
                        } else if (tool === 'line' || tool === 'rect' || tool === 'circle' || tool === 'square') {
                            drawing = true;
                            start = toWorld(e.clientX, e.clientY);
                            end = start;
                        }
                    });
                    canvas.addEventListener('mousemove', (e) => {
                        if (!drawing) return;
                        if (tool === 'pan') {
                            offset.x += e.clientX - lastPos.x;
                            offset.y += e.clientY - lastPos.y;
                            lastPos = {x: e.clientX, y: e.clientY};
                            drawAll();
                        } else if (tool === 'line' || tool === 'rect' || tool === 'circle' || tool === 'square') {
                            end = toWorld(e.clientX, e.clientY);
                            drawAll();
                            // Preview
                            ctx.save();
                            ctx.strokeStyle = '#f00';
                            ctx.lineWidth = 2;
                            if (tool === 'line') {
                                const a = toScreen(start.x, start.y);
                                const b = toScreen(end.x, end.y);
                                ctx.beginPath();
                                ctx.moveTo(a.x, a.y);
                                ctx.lineTo(b.x, b.y);
                                ctx.stroke();
                            } else if (tool === 'rect') {
                                const a = toScreen(start.x, start.y);
                                const b = toScreen(end.x, end.y);
                                ctx.strokeRect(a.x, a.y, b.x - a.x, b.y - a.y);
                            } else if (tool === 'square') {
                                // compute square b from start and end (force equal width/height)
                                const dx = end.x - start.x;
                                const dy = end.y - start.y;
                                const size = Math.max(Math.abs(dx), Math.abs(dy));
                                const signX = dx >= 0 ? 1 : -1;
                                const signY = dy >= 0 ? 1 : -1;
                                const bWorld = { x: start.x + signX * size, y: start.y + signY * size };
                                const a = toScreen(start.x, start.y);
                                const b = toScreen(bWorld.x, bWorld.y);
                                ctx.strokeRect(a.x, a.y, b.x - a.x, b.y - a.y);
                            } else if (tool === 'circle') {
                                // circle defined by start (center) and current end (perimeter)
                                const center = toScreen(start.x, start.y);
                                const edge = toScreen(end.x, end.y);
                                const rx = edge.x - center.x;
                                const ry = edge.y - center.y;
                                const r = Math.sqrt(rx*rx + ry*ry);
                                ctx.beginPath();
                                ctx.arc(center.x, center.y, r, 0, Math.PI * 2);
                                ctx.stroke();
                            }
                            ctx.restore();
                        }
                    });
                    canvas.addEventListener('mouseup', (e) => {
                        if (!drawing) return;
                        drawing = false;
                        if (tool === 'line') {
                            shapes.push({type:'line', a: start, b: toWorld(e.clientX, e.clientY)});
                            drawAll();
                        } else if (tool === 'rect') {
                            shapes.push({type:'rect', a: start, b: toWorld(e.clientX, e.clientY)});
                            drawAll();
                        } else if (tool === 'square') {
                            const endWorld = toWorld(e.clientX, e.clientY);
                            const dx = endWorld.x - start.x;
                            const dy = endWorld.y - start.y;
                            const size = Math.max(Math.abs(dx), Math.abs(dy));
                            const signX = dx >= 0 ? 1 : -1;
                            const signY = dy >= 0 ? 1 : -1;
                            const bWorld = { x: start.x + signX * size, y: start.y + signY * size };
                            shapes.push({type:'rect', a: start, b: bWorld});
                            drawAll();
                        } else if (tool === 'circle') {
                            const endWorld = toWorld(e.clientX, e.clientY);
                            const rx = endWorld.x - start.x;
                            const ry = endWorld.y - start.y;
                            const r = Math.sqrt(rx*rx + ry*ry);
                            shapes.push({type:'circle', c: start, r: r});
                            drawAll();
                        }
                    });
                    canvas.addEventListener('mouseleave', () => { drawing = false; });
                    // Zoom with mouse wheel
                    canvas.addEventListener('wheel', (e) => {
                        e.preventDefault();
                        const mouse = toWorld(e.clientX, e.clientY);
                        const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;
                        zoom *= zoomFactor;
                        // Adjust offset so zoom is centered on mouse
                        offset.x = e.clientX - (mouse.x * zoom);
                        offset.y = e.clientY - (mouse.y * zoom);
                        drawAll();
                    }, { passive: false });
                    // Initial tool
                    setTool('pan');
                });
            </script>
        </div>
    </div>
</body>
</html>