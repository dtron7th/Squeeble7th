<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="CSS/UI.css">

    <style>
        body {
            background-color: rgb(43, 43, 43);
            overflow: hidden;
            width: 100dvw;
            height: 100dvh;
            display: flex;
            justify-content: center;
        }

        /* ============================================================================ */
        /* HOME MAIN */
        /* ============================================================================ */

        .Top_Bar {
            position: absolute;
            top: 10px;
            width: calc(100% - 20px);
            height: 30px;
            background-color: var(--UI-Buttons-Fields-Color-1);
            backdrop-filter: var(--Back_drop);
            border-radius: var(--Border-Radius);
            z-index: 1;
            display: flex;
            flex-direction: row;
            align-items: center;
            gap: 20px;
            text-indent: 10px;
            display: none;
        }

        .Top_Bar > p {
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_1);
        }
        
        .Top_Bar > .Close {
            position: absolute;
            right: 10px;
        }

        .Display_Top_Menu_Button {
            position: absolute;
            top: 10px;
            left: 10px;
        }

        .Clock {
            position: absolute;
            top: 70px;
            right: 10px;
            font-size: var(--Main_Text);
            color: var(--Main_Text_Color_2);
            display: flex;
            flex-direction: row;
            gap: 20px;
        }

        .Side_Bar {
            position: absolute;
            left: 10px;
            top: 250px;
            width: 30px;
            height: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

    </style>
</head>
<body>
    
    <!-- ============================================================================ -->
    <!-- SOUND PROFILE -->
    <!-- ============================================================================ -->

    <audio src="/Sounds/Audio/Morning_Signal.mp3"></audio>
    <audio src="/Sounds/Audio/mixkit-digital-clock-digital-alarm-buzzer-992.wav"></audio>
    <audio src="/Sounds/Audio/mixkit-warning-alarm-buzzer-991.wav"></audio>

    <!-- ============================================================================ -->
    <!-- TOP BAR BUTTON -->
    <!-- ============================================================================ -->

    <div class="Display_Top_Menu_Button">
        <button class="Icon_Button" id="Top_Menu_Button"><img src="/Images/Icons/apps_24dp_1F1F1F.svg"></button>
    </div>

    <!-- ============================================================================ -->
    <!-- TOP BAR -->
    <!-- ============================================================================ -->

    <div class="Top_Bar">
        <p>Apps</p>
        <p>Government</p>
        <p>Market</p>
        <p>Jobs</p>
        <p>Military</p>
        <p>More</p>
        <div class="Close">
            <button class="Close_Button"></button>
        </div>
    </div>

    <script id="Top_Bar Script">


        // Display Top Bar when Top Menu Button is clicked
        document.getElementById('Top_Menu_Button').addEventListener('click', function() {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            topBar.style.display = 'flex';
            topBar.style.transform = 'scaleX(0)';
            topBar.style.opacity = '0';
            topBar.style.transformOrigin = 'left';
            topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
            
            setTimeout(() => {
                topBar.style.transform = 'scaleX(1)';
                topBar.style.opacity = '1';
                topMenuButton.style.display = 'none';
            }, 10);
        });

        // Hide Top Bar when Close Button is clicked
        document.querySelector('.Close_Button').addEventListener('click', function() {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
            topBar.style.transform = 'scaleX(0)';
            topBar.style.opacity = '0';
            
            setTimeout(() => {
                topBar.style.display = 'none';
                topMenuButton.style.display = 'flex';
            }, 300);
        });

        // Close Top Bar when clicking outside
        document.addEventListener('click', function(event) {
            const topBar = document.querySelector('.Top_Bar');
            const topMenuButton = document.getElementById('Top_Menu_Button');
            
            // Check if click is outside top bar and top menu button
            if (!topBar.contains(event.target) && !topMenuButton.contains(event.target)) {
            if (topBar.style.display === 'flex') {
                topBar.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s cubic-bezier(0, 1, 0, 1)';
                topBar.style.transform = 'scaleX(0)';
                topBar.style.opacity = '0';
                
                setTimeout(() => {
                topBar.style.display = 'none';
                topMenuButton.style.display = 'flex';
                }, 300);
            }
            }
        });
    </script>

    <!-- ============================================================================ -->
    <!-- CLOCK SCRIPT -->
    <!-- ============================================================================ -->

    <div class="Clock">
        <p class="Clock_Time">10:10:10:10 pm</p>
        <p class="Clock_Date">Monday: 10-10-9999</p>
    </div>
    <script id="Clock Script">


        // Clock - Update every second
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const milliseconds = now.getMilliseconds().toString().padStart(3, '0');
            const ampm = hours >= 12 ? 'pm' : 'am';
            
            hours = hours % 12;
            hours = hours ? hours : 12; // 0 should be 12
            
            const timeString = `${hours}:${minutes}:${seconds}:${milliseconds} ${ampm}`;
            document.querySelector('.Clock_Time').textContent = timeString;
        }

        updateClock();
        setInterval(updateClock, 10); // Update every 10ms for smooth milliseconds display

        // Date - Update every second
        function updateDate() {
            const now = new Date();
            const daysOfWeek = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const dayOfWeek = daysOfWeek[now.getDay()];
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const year = now.getFullYear();
            
            const dateString = `${dayOfWeek}: ${month}-${day}-${year}`;
            document.querySelector('.Clock_Date').textContent = dateString;
        }

        updateDate();
        setInterval(updateDate, 1000);
        
    </script>

    <!-- ============================================================================ -->
    <!-- SIDE BAR -->
    <!-- ============================================================================ -->

    <div class="Side_Bar">
        <button class="Icon_Button" id="Side_Bar_Notifications"><img src="/Images/Icons/notifications_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Messages"><img src="/Images/Icons/chat_bubble_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Mail"><img src="/Images/Icons/mail_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Upload"d><img src="/Images/Icons/upload_24dp_1F1F1F_FILL1_wght400_GRAD0_opsz24.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Wallet"><img src="/Images/Icons/currency_bitcoin_24dp_1F1F1F.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_ID"><img src="/Images/Icons/id_card_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt=""></button>
        <button class="Icon_Button" id="Side_Bar_Tool"><img src="/Images/Icons/handyman_24dp_1F1F1F_FILL0_wght400_GRAD0_opsz24.svg" alt=""></button>
    </div>



    <!-- ============================================================================ -->
    <!-- NOTIFICATIONS WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Notifications_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_Notifications_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Notifications_Window Script">

        document.getElementById('Side_Bar_Notifications').addEventListener('click', function() {
            const notificationsWindow = document.getElementById('Notifications_Window');
            notificationsWindow.style.display = 'flex';
            notificationsWindow.style.transform = 'scale(0)';
            notificationsWindow.style.opacity = '0';
            notificationsWindow.style.transformOrigin = 'top left';
            notificationsWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            notificationsWindow.style.transform = 'scale(1)';
            notificationsWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Notifications_Window').addEventListener('click', function() {
            const notificationsWindow = document.getElementById('Notifications_Window');
            notificationsWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            notificationsWindow.style.transform = 'scale(0)';
            notificationsWindow.style.opacity = '0';
            
            setTimeout(() => {
            notificationsWindow.style.display = 'none';
            }, 300);
        });

        // Parent Notifications Window to Side Bar Notifications button
        const notificationsWindow = document.getElementById('Notifications_Window');
        const sideBarNotifications = document.getElementById('Side_Bar_Notifications');
        
        function positionNotificationsWindow() {
            const buttonRect = sideBarNotifications.getBoundingClientRect();
            notificationsWindow.style.position = 'absolute';
            notificationsWindow.style.left = (buttonRect.right + 10) + 'px';
            notificationsWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Notifications').addEventListener('click', function() {
            positionNotificationsWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- MESSAGES WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Messages_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_Messages_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Messages_Window Script">

        document.getElementById('Side_Bar_Messages').addEventListener('click', function() {
            const messagesWindow = document.getElementById('Messages_Window');
            messagesWindow.style.display = 'flex';
            messagesWindow.style.transform = 'scale(0)';
            messagesWindow.style.opacity = '0';
            messagesWindow.style.transformOrigin = 'top left';
            messagesWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            messagesWindow.style.transform = 'scale(1)';
            messagesWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Messages_Window').addEventListener('click', function() {
            const messagesWindow = document.getElementById('Messages_Window');
            messagesWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            messagesWindow.style.transform = 'scale(0)';
            messagesWindow.style.opacity = '0';
            
            setTimeout(() => {
            messagesWindow.style.display = 'none';
            }, 300);
        });

        // Parent Messages Window to Side Bar Messages button
        const messagesWindow = document.getElementById('Messages_Window');
        const sideBarMessages = document.getElementById('Side_Bar_Messages');
        
        function positionMessagesWindow() {
            const buttonRect = sideBarMessages.getBoundingClientRect();
            messagesWindow.style.position = 'absolute';
            messagesWindow.style.left = (buttonRect.right + 10) + 'px';
            messagesWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Messages').addEventListener('click', function() {
            positionMessagesWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- MAIL WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Mail_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_Mail_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Mail_Window Script">

        document.getElementById('Side_Bar_Mail').addEventListener('click', function() {
            const mailWindow = document.getElementById('Mail_Window');
            mailWindow.style.display = 'flex';
            mailWindow.style.transform = 'scale(0)';
            mailWindow.style.opacity = '0';
            mailWindow.style.transformOrigin = 'top left';
            mailWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            mailWindow.style.transform = 'scale(1)';
            mailWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Mail_Window').addEventListener('click', function() {
            const mailWindow = document.getElementById('Mail_Window');
            mailWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            mailWindow.style.transform = 'scale(0)';
            mailWindow.style.opacity = '0';
            
            setTimeout(() => {
            mailWindow.style.display = 'none';
            }, 300);
        });

        // Parent Mail Window to Side Bar Mail button
        const mailWindow = document.getElementById('Mail_Window');
        const sideBarMail = document.getElementById('Side_Bar_Mail');
        
        function positionMailWindow() {
            const buttonRect = sideBarMail.getBoundingClientRect();
            mailWindow.style.position = 'absolute';
            mailWindow.style.left = (buttonRect.right + 10) + 'px';
            mailWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Mail').addEventListener('click', function() {
            positionMailWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- UPLOAD WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Upload_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_Upload_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Upload_Window Script">

        document.getElementById('Side_Bar_Upload').addEventListener('click', function() {
            const uploadWindow = document.getElementById('Upload_Window');
            uploadWindow.style.display = 'flex';
            uploadWindow.style.transform = 'scale(0)';
            uploadWindow.style.opacity = '0';
            uploadWindow.style.transformOrigin = 'top left';
            uploadWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            uploadWindow.style.transform = 'scale(1)';
            uploadWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Upload_Window').addEventListener('click', function() {
            const uploadWindow = document.getElementById('Upload_Window');
            uploadWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            uploadWindow.style.transform = 'scale(0)';
            uploadWindow.style.opacity = '0';
            
            setTimeout(() => {
            uploadWindow.style.display = 'none';
            }, 300);
        });

        // Parent Upload Window to Side Bar Upload button
        const uploadWindow = document.getElementById('Upload_Window');
        const sideBarUpload = document.getElementById('Side_Bar_Upload');
        
        function positionUploadWindow() {
            const buttonRect = sideBarUpload.getBoundingClientRect();
            uploadWindow.style.position = 'absolute';
            uploadWindow.style.left = (buttonRect.right + 10) + 'px';
            uploadWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Upload').addEventListener('click', function() {
            positionUploadWindow();
        });
    </script>



    <!-- ============================================================================ -->
    <!-- WALLET WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Wallet_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_Wallet_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="Wallet_Window Script">

        document.getElementById('Side_Bar_Wallet').addEventListener('click', function() {
            const walletWindow = document.getElementById('Wallet_Window');
            walletWindow.style.display = 'flex';
            walletWindow.style.transform = 'scale(0)';
            walletWindow.style.opacity = '0';
            walletWindow.style.transformOrigin = 'top left';
            walletWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            walletWindow.style.transform = 'scale(1)';
            walletWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Wallet_Window').addEventListener('click', function() {
            const walletWindow = document.getElementById('Wallet_Window');
            walletWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            walletWindow.style.transform = 'scale(0)';
            walletWindow.style.opacity = '0';
            
            setTimeout(() => {
            walletWindow.style.display = 'none';
            }, 300);
        });

        // Parent Wallet Window to Side Bar Wallet button
        const walletWindow = document.getElementById('Wallet_Window');
        const sideBarWallet = document.getElementById('Side_Bar_Wallet');
        
        function positionWalletWindow() {
            const buttonRect = sideBarWallet.getBoundingClientRect();
            walletWindow.style.position = 'absolute';
            walletWindow.style.left = (buttonRect.right + 10) + 'px';
            walletWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Wallet').addEventListener('click', function() {
            positionWalletWindow();
        });
    </script>

    <!-- ============================================================================ -->
    <!-- ID WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="ID_Window" style="width:200px; height:400px; display: none;">
        <div class="Window_Header">
            <p class="Title">Window — with header</p>
            <button class="Close_Button" id="Close_ID_Window"></button>
        </div>
        <div class="Content">
        </div>
    </div>

    <script id="ID_Window Script">

        document.getElementById('Side_Bar_ID').addEventListener('click', function() {
            const idWindow = document.getElementById('ID_Window');
            idWindow.style.display = 'flex';
            idWindow.style.transform = 'scale(0)';
            idWindow.style.opacity = '0';
            idWindow.style.transformOrigin = 'top left';
            idWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            idWindow.style.transform = 'scale(1)';
            idWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_ID_Window').addEventListener('click', function() {
            const idWindow = document.getElementById('ID_Window');
            idWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            idWindow.style.transform = 'scale(0)';
            idWindow.style.opacity = '0';
            
            setTimeout(() => {
            idWindow.style.display = 'none';
            }, 300);
        });

        // Parent ID Window to Side Bar ID button
        const idWindow = document.getElementById('ID_Window');
        const sideBarID = document.getElementById('Side_Bar_ID');
        
        function positionIDWindow() {
            const buttonRect = sideBarID.getBoundingClientRect();
            idWindow.style.position = 'absolute';
            idWindow.style.left = (buttonRect.right + 10) + 'px';
            idWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_ID').addEventListener('click', function() {
            positionIDWindow();
        });
    </script>

    <!-- ============================================================================ -->
    <!-- TOOL WINDOW -->
    <!-- ============================================================================ -->

    <div class="Window" id="Tool_Window" style="width:300px; height:200px; display: none;">
        <div class="Window_Header">
            <p class="Title">Tools</p>
            <button class="Close_Button" id="Close_Tool_Window"></button>
        </div>
        <div class="Content">
            <div class="Tools">
                <button id="Open_Alarm_Clock_Tool" style="width: 100%; height: 30px;">Alarm Clock</button>
                <button style="width: 100%; height: 30px;">Calculator</button>
                <button style="width: 100%; height: 30px;"></button>
                <button style="width: 100%; height: 30px;"></button>
                <button style="width: 100%; height: 30px;"></button>
            </div>
        </div>
    </div>
    <div class="Sub_Windows">

        <!-- ============================================================================ -->
        <!-- ALARM CLOCK WINDOW -->
        <!-- ============================================================================ -->

        <div class="Window" id="Alarm_Clock_Window" role="dialog" aria-modal="true" aria-labelledby="Alarm_Clock_Title" style="width:200px; height:350px; display:none;">
            <div class="Window_Header" style="user-select:none; cursor:move;">
                <p class="Title" id="Alarm_Clock_Title">Alarm Clock</p>
                <button class="Close_Button" id="Close_Alarm_Clock_Window" aria-label="Close Alarm Clock"></button>
            </div>
            <div class="Content" style="display:flex; flex-direction:column; gap:10px;">
                <div id="Alarm_Display_Time" style="text-align:center; font-size:30px; color:var(--Main_Text_Color_1);" aria-live="polite">
                    12:00 PM
                </div>
                <div style="width: calc(100% - 20px); display: flex; gap: 10px; align-items: center;">
                    <input type="time" id="Alarm_Time_Input" style="width: 100%; height: 30px; text-indent: 10px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); font-size: var(--Main_Text); outline: none;">
                    <button id="Set_Alarm_Button" style="width: 60px; height: 30px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; outline: none;">Set</button>
                </div>

                <div style="display:flex; flex-direction:column; gap: 10px; width: calc(100% - 20px);">
                    <p style="margin:0; color:var(--Main_Text_Color_1); font-size: var(--Main_Text);">Sound</p>
                    <div style="display:flex; gap: 10px;">
                        <select id="Alarm_Sound_Select" style="flex:1; height:30px; background-color:var(--UI-Buttons-Fields-Color-2); border:none; border-radius:var(--Border-Radius); color:var(--Main_Text_Color_1); text-indent: 10px; font-size:var(--Main_Text); outline: none;">
                            <option value="/Sounds/Audio/Morning_Signal.mp3">Digital Beep</option>
                            <option value="/Sounds/Audio/mixkit-digital-clock-digital-alarm-buzzer-992.wav">Digital Buzzer</option>
                            <option value="/Sounds/Audio/mixkit-warning-alarm-buzzer-991.wav">Warning Buzzer</option>
                        </select>
                        <button id="Preview_Alarm_Sound" class="Icon_Button" style="width: 60px; height: 30px; outline: none;">Play</button>
                    </div>
                </div>
                <input type="hidden" id="Selected_Alarm_Sound" value="/Sounds/Audio/Morning_Signal.mp3">

                <div id="Alarm_List" style="width: calc(100% - 20px); height: 150px; display: flex; flex-direction: column; overflow-y: scroll; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); font-size: var(--Main_Text);">
                    <!-- Alarms will be listed here -->
                </div>
            </div>
            <script>
            (function(){
                const select = document.getElementById('Alarm_Sound_Select');
                const hidden = document.getElementById('Selected_Alarm_Sound');
                const previewBtn = document.getElementById('Preview_Alarm_Sound');
                let previewAudio = new Audio();

                select.addEventListener('change', () => {
                hidden.value = select.value;
                });

                previewBtn.addEventListener('click', () => {
                previewAudio.pause();
                previewAudio = new Audio(select.value);
                previewAudio.currentTime = 0;
                previewAudio.play();
                });

                // Attach extra handler to store sound on alarm object (after original listener runs)
                document.getElementById('Set_Alarm_Button').addEventListener('click', () => {
                if (window.alarms && alarms.length) {
                    const last = alarms[alarms.length - 1];
                    last.sound = hidden.value;
                }
                });

                // Optional: play sound when alarm fires (wrap original alert)
                const originalAlert = window.alert;
                window.playAlarmSound = function(src){
                const a = new Audio(src);
                a.play();
                };

                // Poll alarms array to hook when they trigger (lightweight augmentation)
                setInterval(() => {
                if (!window.alarms) return;
                const now = new Date();
                const current = `${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;
                alarms.forEach(alarm => {
                    if (alarm.active === false) return;
                    if (alarm.time === current && alarm.sound && !alarm._playedAtMinute) {
                    playAlarmSound(alarm.sound);
                    alarm._playedAtMinute = current;
                    }
                    if (alarm._playedAtMinute && alarm._playedAtMinute !== current) {
                    delete alarm._playedAtMinute;
                    }
                });
                }, 1000);
            })();

            // Schedule alarms on load and when added

            (function() {
                if (!window.alarms) return;

                function scheduleAlarm(alarm) {
                    if (!alarm || !alarm.time) return;
                    const soundSrc = alarm.sound || document.getElementById('Selected_Alarm_Sound')?.value;
                    if (!soundSrc) return;

                    const now = new Date();
                    const parts = alarm.time.split(':');
                    if (parts.length < 2) return;
                    const h = parseInt(parts[0], 10);
                    const m = parseInt(parts[1], 10);
                    if (isNaN(h) || isNaN(m)) return;

                    const target = new Date();
                    target.setHours(h, m, 0, 0);
                    if (target <= now) target.setDate(target.getDate() + 1);

                    const delay = target - now;
                    if (alarm._timeoutId) clearTimeout(alarm._timeoutId);

                    alarm._timeoutId = setTimeout(() => {
                        if (alarm.active !== false) {
                            try {
                                const audio = new Audio(soundSrc);
                                audio.play().catch(() => {});
                            } catch (e) {}
                        }
                        if (alarm.active) scheduleAlarm(alarm);
                    }, delay);
                }

                // Patch push to auto schedule
                const originalPush = alarms.push.bind(alarms);
                alarms.push = function(...newAlarms) {
                    const r = originalPush(...newAlarms);
                    newAlarms.forEach(scheduleAlarm);
                    return r;
                };

                // Patch deleteAlarm to clear timeout
                if (window.deleteAlarm) {
                    const origDelete = window.deleteAlarm;
                    window.deleteAlarm = function(id) {
                        const alarm = alarms.find(a => a.id === id);
                        if (alarm && alarm._timeoutId) clearTimeout(alarm._timeoutId);
                        origDelete(id);
                    };
                }

                // Schedule existing alarms (if any)
                alarms.forEach(scheduleAlarm);
            })();
            

            </script>
        </div>

        <!-- ============================================================================ -->
        <!-- TIME PICKER WINDOW -->
        <!-- ============================================================================ -->

        <div class="Window" id="Time_Picker_Window" style="width:250px; height:380px; display: none;">
            <div class="Window_Header">
                <p class="Title">Select Time</p>
                <button class="Close_Button" id="Close_Time_Picker_Window"></button>
            </div>
            <div class="Content" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                <div style="display:flex; gap:10px; align-items:center;">
                    <div style="display:flex; flex-direction: column; gap:8px; align-items:center;">
                        <button id="Toggle_24H" class="Icon_Button" style="width:60px; height:34px;">24H</button>
                        <button id="Toggle_12H" class="Icon_Button" style="width:60px; height:34px;">12H</button>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <button class="Icon_Button" id="Hour_Up">▲</button>
                            <div id="Hour_Display" style="width: 60px; height: 60px; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); display: flex; justify-content: center; align-items: center; font-size: 24px; color: var(--Main_Text_Color_1); margin: 5px 0;">12</div>
                            <button class="Icon_Button" id="Hour_Down">▼</button>
                        </div>
                        <span style="font-size: 24px; color: var(--Main_Text_Color_1);">:</span>
                        <div style="display: flex; flex-direction: column; align-items: center;">
                            <button class="Icon_Button" id="Minute_Up">▲</button>
                            <div id="Minute_Display" style="width: 60px; height: 60px; background-color: var(--UI-Buttons-Fields-Color-2); border-radius: var(--Border-Radius); display: flex; justify-content: center; align-items: center; font-size: 24px; color: var(--Main_Text_Color_1); margin: 5px 0;">00</div>
                            <button class="Icon_Button" id="Minute_Down">▼</button>
                        </div>
                    </div>
                </div>
                <div id="AMPM_Container" style="display: flex; gap: 10px;">
                    <button id="AM_Button" style="width: 60px; height: 40px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">AM</button>
                    <button id="PM_Button" style="width: 60px; height: 40px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">PM</button>
                </div>
                <button id="Confirm_Time_Button" style="position: absolute; bottom: 10px; width: calc(100% - 20px); height: 30px; background-color: var(--UI-Buttons-Fields-Color-2); border: none; border-radius: var(--Border-Radius); color: var(--Main_Text_Color_1); cursor: pointer; font-size: var(--Main_Text);">Confirm</button>
            </div>
        </div>

        <script id="Time_Picker_Window Script">
            let pickerHour = 12;
            let pickerMinute = 0;
            let pickerAMPM = 'AM';
            let use24Hour = false;

            function pad(n){ return n.toString().padStart(2,'0'); }

            function updateDisplays() {
                const ampmContainer = document.getElementById('AMPM_Container');
                const hourDisplay = document.getElementById('Hour_Display');
                const minuteDisplay = document.getElementById('Minute_Display');
                const t24 = document.getElementById('Toggle_24H');
                const t12 = document.getElementById('Toggle_12H');

                if (use24Hour) {
                    ampmContainer.style.display = 'none';
                    let h = pickerHour;
                    if (h < 0) h = 0;
                    if (h > 23) h = h % 24;
                    hourDisplay.textContent = pad(h);
                    t24.style.backgroundColor = 'var(--Normal_Button)';
                    t12.style.backgroundColor = 'var(--UI-Buttons-Fields-Color-2)';
                } else {
                    ampmContainer.style.display = 'flex';
                    let displayHour = pickerHour;
                    if (displayHour > 23) displayHour = displayHour % 24;
                    if (displayHour === 0) displayHour = 12;
                    if (displayHour > 12) displayHour = displayHour % 12 || 12;
                    hourDisplay.textContent = pad(displayHour);
                    t12.style.backgroundColor = 'var(--Normal_Button)';
                    t24.style.backgroundColor = 'var(--UI-Buttons-Fields-Color-2)';
                }
                minuteDisplay.textContent = pad(pickerMinute);
                document.getElementById('AM_Button').style.backgroundColor = pickerAMPM === 'AM' ? 'var(--Normal_Button)' : 'var(--UI-Buttons-Fields-Color-2)';
                document.getElementById('PM_Button').style.backgroundColor = pickerAMPM === 'PM' ? 'var(--Normal_Button)' : 'var(--UI-Buttons-Fields-Color-2)';
            }

            function setFromInputValue() {
                const val = document.getElementById('Alarm_Time_Input').value;
                const now = new Date();
                if (val && val.includes(':')) {
                    const parts = val.split(':');
                    let h = parseInt(parts[0],10);
                    let m = parseInt(parts[1],10) || 0;
                    if (isNaN(h)) h = now.getHours();
                    if (isNaN(m)) m = now.getMinutes();
                    use24Hour = (h >= 0 && h <= 23);
                    if (use24Hour) {
                        pickerHour = h;
                        pickerMinute = m;
                        pickerAMPM = (h >= 12) ? 'PM' : 'AM';
                    } else {
                        pickerAMPM = h >= 12 ? 'PM' : 'AM';
                        let hour12 = h % 12;
                        if (hour12 === 0) hour12 = 12;
                        pickerHour = hour12;
                        pickerMinute = m;
                    }
                } else {
                    const h = now.getHours();
                    const m = now.getMinutes();
                    use24Hour = false;
                    pickerAMPM = h >= 12 ? 'PM' : 'AM';
                    let hour12 = h % 12;
                    if (hour12 === 0) hour12 = 12;
                    pickerHour = hour12;
                    pickerMinute = m;
                }
                updateDisplays();
            }

            document.getElementById('Alarm_Time_Input').addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                setFromInputValue();

                const timePickerWindow = document.getElementById('Time_Picker_Window');
                const alarmWindow = document.getElementById('Alarm_Clock_Window');
                const alarmRect = alarmWindow.getBoundingClientRect();

                timePickerWindow.style.position = 'absolute';
                timePickerWindow.style.left = (alarmRect.right + 10) + 'px';
                timePickerWindow.style.top = alarmRect.top + 'px';
                timePickerWindow.style.right = 'auto';
                timePickerWindow.style.transform = 'scale(0)';
                timePickerWindow.style.transformOrigin = 'top left';
                timePickerWindow.style.display = 'flex';
                timePickerWindow.style.opacity = '0';
                timePickerWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';

                setTimeout(() => {
                    timePickerWindow.style.transform = 'scale(1)';
                    timePickerWindow.style.opacity = '1';
                }, 10);
            });

            document.getElementById('Close_Time_Picker_Window').addEventListener('click', function() {
                const timePickerWindow = document.getElementById('Time_Picker_Window');
                timePickerWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                timePickerWindow.style.transform = 'scale(0)';
                timePickerWindow.style.opacity = '0';
                setTimeout(() => {
                    timePickerWindow.style.display = 'none';
                }, 300);
            });

            document.getElementById('Toggle_24H').addEventListener('click', function() {
                if (!use24Hour) {
                    let h = pickerHour % 12;
                    if (pickerAMPM === 'PM') h += 12;
                    pickerHour = h;
                    use24Hour = true;
                    updateDisplays();
                }
            });

            document.getElementById('Toggle_12H').addEventListener('click', function() {
                if (use24Hour) {
                    let h24 = pickerHour;
                    pickerAMPM = h24 >= 12 ? 'PM' : 'AM';
                    let h12 = h24 % 12;
                    if (h12 === 0) h12 = 12;
                    pickerHour = h12;
                    use24Hour = false;
                    updateDisplays();
                }
            });

            document.getElementById('Hour_Up').addEventListener('click', function() {
                if (use24Hour) {
                    pickerHour = (pickerHour + 1) % 24;
                } else {
                    pickerHour = pickerHour === 12 ? 1 : pickerHour + 1;
                }
                updateDisplays();
            });

            document.getElementById('Hour_Down').addEventListener('click', function() {
                if (use24Hour) {
                    pickerHour = (pickerHour === 0) ? 23 : pickerHour - 1;
                } else {
                    pickerHour = pickerHour === 1 ? 12 : pickerHour - 1;
                }
                updateDisplays();
            });

            document.getElementById('Minute_Up').addEventListener('click', function() {
                pickerMinute = (pickerMinute + 1) % 60;
                updateDisplays();
            });

            document.getElementById('Minute_Down').addEventListener('click', function() {
                pickerMinute = pickerMinute === 0 ? 59 : pickerMinute - 1;
                updateDisplays();
            });

            document.getElementById('AM_Button').addEventListener('click', function() {
                pickerAMPM = 'AM';
                updateDisplays();
            });

            document.getElementById('PM_Button').addEventListener('click', function() {
                pickerAMPM = 'PM';
                updateDisplays();
            });

            document.getElementById('Confirm_Time_Button').addEventListener('click', function() {
                let hour24;
                if (use24Hour) {
                    hour24 = pickerHour;
                } else {
                    hour24 = pickerHour % 12;
                    if (pickerAMPM === 'PM') hour24 += 12;
                    if (pickerAMPM === 'AM' && pickerHour === 12) hour24 = 0;
                }
                const timeString = `${pad(hour24)}:${pad(pickerMinute)}`;
                document.getElementById('Alarm_Time_Input').value = timeString;
                document.getElementById('Close_Time_Picker_Window').click();
            });

            document.getElementById('Time_Picker_Window').addEventListener('click', function(e){ e.stopPropagation(); });
        </script>
    </div>

    <style>
        #Tool_Window > .Content > .Tools {
            width: calc(100% - 20px);
            height: calc(100% - 20px);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        /* List items (supports either .Tool_Container divs or plain buttons) */
        #Tool_Window > .Content > .Tools > .Tool_Container,
        #Tool_Window > .Content > .Tools > button {
            width: 100%;
            height: 30px;
            background-color: var(--UI-Buttons-Fields-Color-2);
            color: var(--Main_Text_Color_1);
            font-size: var(--Main_Text);
            border-radius: var(--Border-Radius_Button);
            display: flex;
            align-items: center;
            
            text-indent: 10px;
            border: none;
            text-align: left;
            cursor: pointer;
        }

        #Tool_Window > .Content > .Tools > .Tool_Container:hover,
        #Tool_Window > .Content > .Tools > button:hover {
            background-color: var(--Normal_Button);
        }
    </style>

    <script id="Tool_Window Script">

        document.getElementById('Side_Bar_Tool').addEventListener('click', function() {
            const toolWindow = document.getElementById('Tool_Window');
            toolWindow.style.display = 'flex';
            toolWindow.style.transform = 'scale(0)';
            toolWindow.style.opacity = '0';
            toolWindow.style.transformOrigin = 'top left';
            toolWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
            toolWindow.style.transform = 'scale(1)';
            toolWindow.style.opacity = '1';
            }, 10);
        });

        document.getElementById('Close_Tool_Window').addEventListener('click', function() {
            const toolWindow = document.getElementById('Tool_Window');
            toolWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            toolWindow.style.transform = 'scale(0)';
            toolWindow.style.opacity = '0';
            
            setTimeout(() => {
            toolWindow.style.display = 'none';
            }, 300);
        });

        // Parent Tool Window to Side Bar Tool button
        const toolWindow = document.getElementById('Tool_Window');
        const sideBarTool = document.getElementById('Side_Bar_Tool');
        
        function positionToolWindow() {
            const buttonRect = sideBarTool.getBoundingClientRect();
            toolWindow.style.position = 'absolute';
            toolWindow.style.left = (buttonRect.right + 10) + 'px';
            toolWindow.style.top = buttonRect.top + 'px';
        }
        
        // Position window when opened
        document.getElementById('Side_Bar_Tool').addEventListener('click', function() {
            positionToolWindow();
        });

        //Alarm Clock.///////////////////////////////////////////////////////////////////////////////////

        // Position Alarm Clock Window at top left when opened
        document.getElementById('Open_Alarm_Clock_Tool').addEventListener('click', function() {
            const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
            alarmClockWindow.style.position = 'absolute';
            alarmClockWindow.style.left = '10px';
            alarmClockWindow.style.top = '10px';
        });

        let alarms = [];
        let alarmCheckInterval;

        // Open Alarm Clock Window
        document.getElementById('Open_Alarm_Clock_Tool').addEventListener('click', function() {
            const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
            alarmClockWindow.style.display = 'flex';
            alarmClockWindow.style.transform = 'scale(0)';
            alarmClockWindow.style.opacity = '0';
            alarmClockWindow.style.transformOrigin = 'center';
            alarmClockWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            
            setTimeout(() => {
                alarmClockWindow.style.transform = 'scale(1)';
                alarmClockWindow.style.opacity = '1';
            }, 10);
        });

        // Close Alarm Clock Window
        document.getElementById('Close_Alarm_Clock_Window').addEventListener('click', function() {
            const alarmClockWindow = document.getElementById('Alarm_Clock_Window');
            alarmClockWindow.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
            alarmClockWindow.style.transform = 'scale(0)';
            alarmClockWindow.style.opacity = '0';
            
            setTimeout(() => {
                alarmClockWindow.style.display = 'none';
            }, 300);
        });

        // Update display time
        function updateAlarmDisplayTime() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12;
            
            document.getElementById('Alarm_Display_Time').textContent = `${hours}:${minutes} ${ampm}`;
        }

        setInterval(updateAlarmDisplayTime, 1000);

        // Style the AM/PM text
        function styleAMPM() {
            const displayTime = document.getElementById('Alarm_Display_Time');
            const timeText = displayTime.textContent;
            const ampmMatch = timeText.match(/(AM|PM)/);
            
            if (ampmMatch) {
                const timePart = timeText.replace(/(AM|PM)/, '');
                displayTime.innerHTML = `${timePart}<span style="font-size: var(--Main_Text);">${ampmMatch[0]}</span>`;
            }
        }

        setInterval(() => {
            updateAlarmDisplayTime();
            styleAMPM();
        }, 1000);

        updateAlarmDisplayTime();
        styleAMPM();

        //Open Alarm Clock Window

        // Set Alarm
        document.getElementById('Set_Alarm_Button').addEventListener('click', function() {
            const timeInput = document.getElementById('Alarm_Time_Input').value;
            if (!timeInput) return;
            
            const alarm = {
                id: Date.now(),
                time: timeInput,
                active: true
            };
            
            alarms.push(alarm);
            renderAlarms();
            startAlarmCheck();
        });

        // Render alarms
        function renderAlarms() {
            const alarmList = document.getElementById('Alarm_List');
            alarmList.innerHTML = '';

            const globalSoundSelect = document.getElementById('Alarm_Sound_Select');
            const defaultSound = document.getElementById('Selected_Alarm_Sound')?.value || (globalSoundSelect?.value);

            function getSoundLabel(src) {
            if (!src) return 'No sound';
            if (globalSoundSelect) {
                for (const opt of globalSoundSelect.options) {
                if (opt.value === src) return opt.textContent;
                }
            }
            return src.split('/').pop().replace(/\.[a-z0-9]+$/i,'');
            }

            alarms.forEach(alarm => {
            if (!alarm.sound) alarm.sound = defaultSound;
            const alarmElement = document.createElement('div');
            alarmElement.style.cssText = 'width:100%;background-color:var(--UI-Buttons-Fields-Color-2);display:flex;flex-direction:column;gap:6px;padding:8px 10px;border-bottom:1px solid rgba(255,255,255,0.08);border-radius:var(--Border-Radius);box-sizing:border-box;';

            (function formatDisplayTime(){
                const parts = (alarm.time || '').split(':');
                if (parts.length === 2) {
                let h24 = parseInt(parts[0],10);
                const m = parts[1];
                if (!isNaN(h24)) {
                    const ampm = h24 >= 12 ? 'PM' : 'AM';
                    let h12 = h24 % 12;
                    if (h12 === 0) h12 = 12;
                    alarm.displayTime12 = h12 + ':' + m + ' ' + ampm;
                }
                }
                if (!alarm.displayTime12) alarm.displayTime12 = alarm.time;
            })();

            (function computeRemaining(){
                const now = new Date();
                const parts = (alarm.time || '').split(':');
                if (parts.length === 2) {
                let h = parseInt(parts[0],10);
                let m = parseInt(parts[1],10);
                if (!isNaN(h) && !isNaN(m)) {
                    const target = new Date();
                    target.setHours(h, m, 0, 0);
                    if (target <= now) target.setDate(target.getDate() + 1);
                    const diff = target - now;
                    const hrs = Math.floor(diff / 3600000);
                    const mins = Math.floor((diff % 3600000) / 60000);
                    alarm.remainingLabel = (hrs > 0 ? hrs + 'h ' : '') + mins + 'm remaining';
                }
                }
                if (!alarm.remainingLabel) alarm.remainingLabel = '';
            })();

            const soundLabel = getSoundLabel(alarm.sound);

            alarmElement.innerHTML = `
                <div style="display:flex;justify-content:space-between;align-items:center;">
                <span style="color:var(--Main_Text_Color_1);font-size:var(--Main_Text);">${alarm.time}</span>
                <div style="display:flex;align-items:center;gap:10px;">
                    <button onclick="event.stopPropagation();(function(a){ if(a && a.sound){ const au=new Audio(a.sound); au.currentTime=0; au.play(); }})(alarms.find(x=>x.id===${alarm.id}))" style="background:none;border:none;color:var(--Main_Text_Color_1);cursor:pointer;font-size:var(--Main_Text);">Play</button>
                    <button onclick="event.stopPropagation(); deleteAlarm(${alarm.id})" style="background:none;border:none;color:var(--Main_Text_Color_1);cursor:pointer;font-size:var(--Main_Text);">Delete</button>
                </div>
                </div>
                <div style="display:flex;justify-content:space-between;font-size:var(--Main_Text);color:var(--Main_Text_Color_2);">
                <span>${alarm.displayTime12 || alarm.time}</span>
                <span style="opacity:.7;">${alarm.remainingLabel}</span>
                </div>
                <div style="display:flex;align-items:center;gap:6px;">
                <span style="font-size:var(--Main_Text);color:var(--Main_Text_Color_2);">Sound:</span>
                <span style="font-size:var(--Main_Text);color:var(--Main_Text_Color_1);">${soundLabel}</span>
                </div>
            `;

            alarmList.appendChild(alarmElement);
            });

            if (!window.__alarmSoundPatchApplied && typeof startAlarmCheck === 'function') {
            window.__alarmSoundPatchApplied = true;
            startAlarmCheck = function() {
                if (alarmCheckInterval) return;
                alarmCheckInterval = setInterval(() => {
                const now = new Date();
                const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
                alarms.forEach(alarm => {
                    if (alarm.active && alarm.time === currentTime) {
                    showAlarmNotification(alarm);
                    }
                });
                }, 1000);
            };
            }
        }

        function showAlarmNotification(alarm) {
            let container = document.getElementById('Alarm_Toast_Container');
            if (!container) {
            container = document.createElement('div');
            container.id = 'Alarm_Toast_Container';
            container.style.cssText = 'position:fixed;bottom:10px;right:10px;display:flex;flex-direction:column;gap:10px;z-index:9999;';
            document.body.appendChild(container);
            }
            const toast = document.createElement('div');
            toast.style.cssText = 'min-width:200px;padding:10px 14px;background:var(--UI-Buttons-Fields-Color-1);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);border-radius:var(--Border-Radius);box-shadow:0 4px 12px rgba(0,0,0,.4);display:flex;justify-content:space-between;align-items:center;animation:fadeIn .3s;';
            toast.innerHTML = `<span>Alarm ${alarm.time}</span><button style="background:none;border:none;color:var(--Main_Text_Color_1);cursor:pointer;">×</button>`;
            const closeBtn = toast.querySelector('button');
            closeBtn.onclick = () => {
            toast.style.opacity = '0';
            setTimeout(()=> toast.remove(),300);
            };
            container.appendChild(toast);
        }

        window.deleteAlarm = function(id) {
            alarms = alarms.filter(alarm => alarm.id !== id);
            renderAlarms();
            if (alarms.length === 0) {
            clearInterval(alarmCheckInterval);
            alarmCheckInterval = null;
            }
        };

        function startAlarmCheck() {
            if (alarmCheckInterval) return;
            alarmCheckInterval = setInterval(() => {
            const now = new Date();
            const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            alarms.forEach(alarm => {
                if (alarm.active && alarm.time === currentTime) {
                showAlarmNotification(alarm);
                }
            });
            }, 1000);
        }

        (function() {
            const SNOOZE_MINUTES_DEFAULT = 5;
            function pad(n){ return n.toString().padStart(2,'0'); }
            function addMinutesToTimeString(timeStr, addMinutes) {
            const [hStr, mStr] = timeStr.split(':');
            let h = parseInt(hStr,10);
            let m = parseInt(mStr,10);
            if (isNaN(h) || isNaN(m)) return timeStr;
            m += addMinutes;
            while (m >= 60) { m -= 60; h = (h + 1) % 24; }
            return `${pad(h)}:${pad(m)}`;
            }

            window.showAlarmNotification = function(alarm) {
            if (!alarm) return;

            // Stop audio for all other alarms (single active dialog policy)
            alarms.forEach(a => {
                if (a !== alarm && a._audio) {
                try { a._audio.pause(); a._audio.currentTime = 0; } catch(e){}
                a._audio = null;
                }
            });

            // Remove any existing dialog (single dialog)
            const existingContainer = document.getElementById('Alarm_Action_Dialog_Container');
            if (existingContainer) {
                existingContainer.querySelectorAll('.Alarm_Action_Dialog').forEach(d => d.remove());
            }

            if (alarm._audio) {
                try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                alarm._audio = null;
            }

            if (alarm.sound) {
                try {
                const audio = new Audio(alarm.sound);
                audio.loop = true;
                alarm._audio = audio;
                audio.play().catch(()=>{});
                } catch(e){}
            }

            let container = document.getElementById('Alarm_Action_Dialog_Container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'Alarm_Action_Dialog_Container';
                container.style.cssText = 'position:fixed;bottom:10px;right:10px;display:flex;flex-direction:column;gap:12px;z-index:10000;';
                document.body.appendChild(container);
            }

            const dialog = document.createElement('div');
            dialog.className = 'Alarm_Action_Dialog';
            dialog.setAttribute('role','dialog');
            dialog.setAttribute('aria-modal','true');
            dialog.style.cssText = 'width:260px;background:var(--UI-Buttons-Fields-Color-1);color:var(--Main_Text_Color_1);font-size:var(--Main_Text);border-radius:var(--Border-Radius);box-shadow:0 6px 18px rgba(0,0,0,.45);display:flex;flex-direction:column;gap:14px;padding:14px 16px;animation:fadeIn .25s;position:relative;';

            const header = document.createElement('div');
            header.style.cssText = 'display:flex;flex-direction:column;gap:4px;';
            const title = document.createElement('span');
            title.textContent = 'Alarm';
            title.style.cssText = 'font-weight:600;letter-spacing:.5px;';
            const timeLine = document.createElement('span');
            timeLine.style.opacity = '.8';
            timeLine.textContent = `Time: ${alarm.time}`;
            header.appendChild(title);
            header.appendChild(timeLine);

            const soundRow = document.createElement('div');
            soundRow.style.cssText = 'display:flex;justify-content:space-between;font-size:var(--Main_Text);opacity:.75;';
            soundRow.innerHTML = `<span>Sound</span><span>${(function(){
                const src = alarm.sound || '';
                const sel = document.getElementById('Alarm_Sound_Select');
                if (sel) { for (const opt of sel.options) if (opt.value === src) return opt.textContent; }
                return src ? src.split('/').pop().replace(/\.[a-z0-9]+$/i,'') : 'Default';
            })()}</span>`;

            const actions = document.createElement('div');
            actions.style.cssText = 'display:flex;gap:10px;';
            const snoozeBtn = document.createElement('button');
            snoozeBtn.textContent = `Snooze ${SNOOZE_MINUTES_DEFAULT}m`;
            snoozeBtn.style.cssText = 'flex:1;height:34px;background:var(--UI-Buttons-Fields-Color-2);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);cursor:pointer;';
            const dismissBtn = document.createElement('button');
            dismissBtn.textContent = 'Dismiss';
            dismissBtn.style.cssText = 'flex:1;height:34px;background:var(--Normal_Button);border:none;border-radius:var(--Border-Radius_Button);color:var(--Main_Text_Color_1);cursor:pointer;';
            actions.appendChild(snoozeBtn);
            actions.appendChild(dismissBtn);

            dialog.appendChild(header);
            dialog.appendChild(soundRow);
            dialog.appendChild(actions);
            container.appendChild(dialog);

            function removeDialog() {
                dialog.style.opacity = '0';
                dialog.style.transform = 'translateY(6px)';
                dialog.style.transition = 'opacity .25s, transform .25s';
                setTimeout(()=> dialog.remove(), 250);
            }

            snoozeBtn.addEventListener('click', () => {
                const newTime = addMinutesToTimeString(alarm.time, SNOOZE_MINUTES_DEFAULT);
                alarm.time = newTime;
                alarm.active = true;

                if (alarm._audio) {
                try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                alarm._audio = null;
                }
                if (alarm._timeoutId) { clearTimeout(alarm._timeoutId); alarm._timeoutId = null; }

                (function schedule(a){
                const now = new Date();
                const parts = a.time.split(':');
                if (parts.length !== 2) return;
                const h = parseInt(parts[0],10);
                const m = parseInt(parts[1],10);
                if (isNaN(h)||isNaN(m)) return;
                const target = new Date();
                target.setHours(h,m,0,0);
                if (target <= now) target.setDate(target.getDate()+1);
                const delay = target - now;
                a._timeoutId = setTimeout(()=>{
                    if (a.active) {
                    try { 
                        if (a.sound) {
                        const audio = new Audio(a.sound);
                        audio.loop = true;
                        a._audio = audio;
                        audio.play().catch(()=>{});
                        }
                    } catch(e){}
                    window.showAlarmNotification(a);
                    }
                }, delay);
                })(alarm);

                if (typeof renderAlarms === 'function') renderAlarms();
                removeDialog();
            });

            dismissBtn.addEventListener('click', () => {
                alarm.active = false;
                if (alarm._timeoutId) { clearTimeout(alarm._timeoutId); alarm._timeoutId = null; }
                if (alarm._audio) {
                try { alarm._audio.pause(); alarm._audio.currentTime = 0; } catch(e){}
                alarm._audio = null;
                }
                if (typeof renderAlarms === 'function') renderAlarms();
                removeDialog();
            });
            };
        })();
    </script>



    <script id="ESSENTIALS Script">

        // ============================================================================
        // ESSENTIALS
        // ============================================================================

        // ============================================================================
        // START
        // ============================================================================

        // Disable default Android time picker
        document.getElementById('Alarm_Time_Input').addEventListener('focus', function(e) {
            e.target.blur();
            e.preventDefault();
        });

        document.getElementById('Alarm_Time_Input').addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
        });

        // Make time input readonly to prevent native picker
        document.getElementById('Alarm_Time_Input').setAttribute('readonly', 'readonly');

        // Override any system alarm dialogs
        window.addEventListener('beforeunload', function(e) {
            delete e['returnValue'];
        });

        // Disable default alarm notifications
        if ('Notification' in window) {
            Notification.requestPermission().then(function(permission) {
                if (permission === 'denied') {
                    console.log('Notification permission denied');
                }
            });
        }

        // Disable pull-to-refresh
        document.body.style.overscrollBehavior = 'none';
        
        // Disable default touch actions (pinch zoom, double-tap zoom)
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length > 1) {
            e.preventDefault();
            }
        }, { passive: false });

        // Disable context menu (long press)
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
        });

        // Disable text selection on long press
        document.body.style.webkitUserSelect = 'none';
        document.body.style.userSelect = 'none';
        document.body.style.webkitTouchCallout = 'none';

        // ============================================================================
        // CLOSING WINDOWS
        // ============================================================================

        // Close windows when clicking outside
        document.addEventListener('click', function(event) {
            const windows = document.querySelectorAll('.Window');
            const sideBarButtons = document.querySelectorAll('.Side_Bar button');
            
            // Check if click is outside all windows and sidebar buttons
            let clickedInsideWindow = false;
            let clickedSideBarButton = false;
            
            windows.forEach(window => {
            if (window.contains(event.target)) {
                clickedInsideWindow = true;
            }
            });
            
            sideBarButtons.forEach(button => {
            if (button.contains(event.target)) {
                clickedSideBarButton = true;
            }
            });
            
            // If click is outside, close all visible windows
            if (!clickedInsideWindow && !clickedSideBarButton) {
            windows.forEach(window => {
                if (window.style.display === 'flex') {
                window.style.display = 'none';
                }
            });
            }
        });
        document.addEventListener('click', function(event) {
            const windows = document.querySelectorAll('.Window');
            const sideBarButtons = document.querySelectorAll('.Side_Bar button');
            
            // Check if click is outside all windows and sidebar buttons
            let clickedInsideWindow = false;
            let clickedSideBarButton = false;
            
            windows.forEach(window => {
                if (window.contains(event.target)) {
                    clickedInsideWindow = true;
                }
            });
            
            sideBarButtons.forEach(button => {
                if (button.contains(event.target)) {
                    clickedSideBarButton = true;
                }
            });
            
            // If click is outside, close all visible windows
            if (!clickedInsideWindow && !clickedSideBarButton) {
                windows.forEach(window => {
                    if (window.style.display === 'flex') {
                        window.style.transition = 'transform 0.3s cubic-bezier(0, 1, 0, 1), opacity 0.3s ease-in-out';
                        window.style.transform = 'scale(0)';
                        window.style.opacity = '0';
                        
                        setTimeout(() => {
                            window.style.display = 'none';
                        }, 300);
                    }
                });
            }
        });

        // ============================================================================
        // WINDOW DRAGGING SYSTEM
        // ============================================================================

        let windowElement = null;
        let isDragging = false;
        let offsetX = 0;
        let offsetY = 0;
        let nextZIndex = 10;
        let animationFrameId = null;
        let targetX = 0;
        let targetY = 0;

        const windows = Array.from(document.querySelectorAll('.Window'));

        // ---- Helper Functions ----

        function snapToGrid(x, y, gridSize = 10) {
            const snappedX = Math.round(x / gridSize) * gridSize;
            const snappedY = Math.round(y / gridSize) * gridSize;
            return { x: snappedX, y: snappedY };
        }

        function clamp(val, min, max) {
            return Math.max(min, Math.min(max, val));
        }

        function lerp(start, end, factor) {
            return start + (end - start) * factor;
        }

        function setWindowPosition(x, y, snap = false) {
            const winRect = windowElement.getBoundingClientRect();
            const bodyRect = document.body.getBoundingClientRect();
            const maxX = bodyRect.width - winRect.width;
            const maxY = bodyRect.height - winRect.height;
            
            if (snap) {
            const snapped = snapToGrid(x, y);
            windowElement.style.transition = 'left 0.2s cubic-bezier(0, 1, 0, 1), top 0.2s cubic-bezier(0, 1, 0, 1)';
            windowElement.style.left = clamp(snapped.x, 0, maxX) + 'px';
            windowElement.style.top = clamp(snapped.y, 0, maxY) + 'px';
            } else {
            windowElement.style.transition = 'none';
            targetX = clamp(x, 0, maxX);
            targetY = clamp(y, 0, maxY);
            }
        }

        function smoothUpdate() {
            if (!isDragging || !windowElement) {
            animationFrameId = null;
            return;
            }

            const currentX = parseFloat(windowElement.style.left) || 0;
            const currentY = parseFloat(windowElement.style.top) || 0;
            
            const newX = lerp(currentX, targetX, 0.3);
            const newY = lerp(currentY, targetY, 0.3);
            
            windowElement.style.left = newX + 'px';
            windowElement.style.top = newY + 'px';

            animationFrameId = requestAnimationFrame(smoothUpdate);
        }

        function bringToFront(el) {
            if (!el) return;
            el.style.zIndex = nextZIndex++;
        }

        // ---- Event Handlers ----

        windows.forEach(win => {
            const header = win.querySelector('.Window_Header');
            if (!header) return;

            header.addEventListener('mousedown', (e) => {
            windowElement = win;
            isDragging = true;
            const rect = windowElement.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
            targetX = rect.left;
            targetY = rect.top;
            document.body.style.userSelect = 'none';
            
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(smoothUpdate);
            }
            });

            header.addEventListener('touchstart', (e) => {
            if (e.touches.length !== 1) return;
            windowElement = win;
            isDragging = true;
            const rect = windowElement.getBoundingClientRect();
            offsetX = e.touches[0].clientX - rect.left;
            offsetY = e.touches[0].clientY - rect.top;
            targetX = rect.left;
            targetY = rect.top;
            document.body.style.userSelect = 'none';
            
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(smoothUpdate);
            }
            });

            // Bring to front on interaction
            win.addEventListener('mousedown', () => bringToFront(win));
            win.addEventListener('touchstart', () => bringToFront(win));
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging || !windowElement) return;
            const x = e.clientX - offsetX;
            const y = e.clientY - offsetY;
            setWindowPosition(x, y, false);
            windowElement.style.position = 'absolute';
        });

        document.addEventListener('mouseup', () => {
            if (isDragging && windowElement) {
            const rect = windowElement.getBoundingClientRect();
            setWindowPosition(rect.left, rect.top, true);
            }
            isDragging = false;
            windowElement = null;
            document.body.style.userSelect = '';
        });

        document.addEventListener('touchmove', (e) => {
            if (!isDragging || !windowElement || e.touches.length !== 1) return;
            const x = e.touches[0].clientX - offsetX;
            const y = e.touches[0].clientY - offsetY;
            setWindowPosition(x, y, false);
            windowElement.style.position = 'absolute';
        });

        document.addEventListener('touchend', () => {
            if (isDragging && windowElement) {
            const rect = windowElement.getBoundingClientRect();
            setWindowPosition(rect.left, rect.top, true);
            }
            isDragging = false;
            windowElement = null;
            document.body.style.userSelect = '';
        });

       


    </script>

    
</body>
</html>

